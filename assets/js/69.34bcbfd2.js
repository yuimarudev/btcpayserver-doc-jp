(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{510:function(t,a,s){t.exports=s.p+"assets/img/Gandi3.3773602e.png"},511:function(t,a,s){t.exports=s.p+"assets/img/changedomain.854d7214.png"},512:function(t,a,s){t.exports=s.p+"assets/img/Maintenance2.65b06a5b.png"},974:function(t,a,s){"use strict";s.r(a);var e=s(17),r=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[a("span",{attrs:{id:"after-initial-deployment-i-can-t-register-and-i-don-t-have-a-login-yet"}}),t._v(" "),a("span",{attrs:{id:"are-there-free-hosts-where-i-can-test"}}),t._v(" "),a("span",{attrs:{id:"can-i-connect-to-my-btcpay-bitcoin-p2p-on-port-8333"}}),t._v(" "),a("span",{attrs:{id:"can-i-deploy-btcpay-on-my-existing-vps"}}),t._v(" "),a("span",{attrs:{id:"can-i-run-btcpay-on-my-own-hardware"}}),t._v(" "),a("span",{attrs:{id:"can-i-run-btcpay-on-my-home-computer"}}),t._v(" "),a("span",{attrs:{id:"can-i-start-btcpay-only-when-i-m-expecting-a-payment"}}),t._v(" "),a("span",{attrs:{id:"can-i-use-an-existing-nginx-server-as-a-reverse-proxy-with-ssl-termination"}}),t._v(" "),a("span",{attrs:{id:"can-i-use-bitcoin-knots-instead-of-bitcoin-core"}}),t._v(" "),a("span",{attrs:{id:"cause-3-btcpay-is-expecting-you-to-access-this-website-from"}}),t._v(" "),a("span",{attrs:{id:"cause-4-getting-500-nginx-error-on-a-local-server-https-and-for-http-btcpay-is-expecting-you-to-access-this-website-from"}}),t._v(" "),a("span",{attrs:{id:"general-deployment-faq"}}),t._v(" "),a("span",{attrs:{id:"how-can-i-modify-or-deactivate-environment-variables"}}),t._v(" "),a("span",{attrs:{id:"how-can-i-renew-my-ssl-certificate"}}),t._v(" "),a("span",{attrs:{id:"how-can-i-run-btcpay-on-testnet"}}),t._v(" "),a("span",{attrs:{id:"how-do-i-activate-tor-on-my-btcpay-server"}}),t._v(" "),a("span",{attrs:{id:"how-do-i-completely-uninstall-btcpay-from-a-linux-environment-docker-version"}}),t._v(" "),a("span",{attrs:{id:"how-do-i-disable-tor-on-my-btcpay-server"}}),t._v(" "),a("span",{attrs:{id:"how-much-does-it-cost-to-run-btcpay-server"}}),t._v(" "),a("span",{attrs:{id:"how-to-access-the-onion-address-without-clearnet"}}),t._v(" "),a("span",{attrs:{id:"how-to-change-domain-name-on-my-lunanode-btcpay"}}),t._v(" "),a("span",{attrs:{id:"how-to-change-your-btcpay-server-domain-name"}}),t._v(" "),a("span",{attrs:{id:"how-to-choose-a-proper-deployment-method"}}),t._v(" "),a("span",{attrs:{id:"how-to-deploy-btcpay-server-alongside-existing-bitcoin-node"}}),t._v(" "),a("span",{attrs:{id:"how-to-manually-install-btcpay-on-ubuntu-18-04"}}),t._v(" "),a("span",{attrs:{id:"luna-node-web-deployment-faq"}}),t._v(" "),a("span",{attrs:{id:"manual-deployment"}}),t._v(" "),a("span",{attrs:{id:"setting-up-dns-records"}}),t._v(" "),a("span",{attrs:{id:"web-deployment-faq"}}),t._v(" "),a("span",{attrs:{id:"what-are-the-minimal-requirements-for-btcpay"}}),t._v(" "),a("span",{attrs:{id:"what-is-the-easiest-method-to-deploy-a-self-hosted-btcpay-server"}}),t._v(" "),a("span",{attrs:{id:"why-activate-tor-does-it-mean-that-nobody-knows-who-i-am"}}),t._v(" "),a("span",{attrs:{id:"with-the-docker-deployment-how-to-use-a-different-volume-for-the-data"}})]),t._v(" "),a("h1",{attrs:{id:"デプロイ-faq"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#デプロイ-faq"}},[t._v("#")]),t._v(" デプロイ FAQ")]),t._v(" "),a("p",[t._v("このドキュメントでは、ソフトウェアのインストール前およびインストール中に遭遇する、最も一般的な質問・エラー・問題を扱います。デプロイ方法の詳細な一覧と各手順については、"),a("RouterLink",{attrs:{to:"/Deployment/"}},[t._v("デプロイページ")]),t._v(" を参照してください。")],1),t._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#一般的なデプロイ"}},[t._v("一般的なデプロイ")]),a("ul",[a("li",[a("a",{attrs:{href:"#btcpay-server-の運用にはどれくらい費用がかかりますか？"}},[t._v("BTCPay Server の運用にはどれくらい費用がかかりますか？")])]),a("li",[a("a",{attrs:{href:"#btcpay-の最小要件は何ですか？"}},[t._v("BTCPay の最小要件は何ですか？")])]),a("li",[a("a",{attrs:{href:"#セルフホストの-btcpay-server-をデプロイする最も簡単な方法は何ですか？"}},[t._v("セルフホストの BTCPay Server をデプロイする最も簡単な方法は何ですか？")])]),a("li",[a("a",{attrs:{href:"#適切なデプロイ方法はどう選べばよいですか？"}},[t._v("適切なデプロイ方法はどう選べばよいですか？")])]),a("li",[a("a",{attrs:{href:"#btcpay-を自分のハードウェアで動かせますか？"}},[t._v("BTCPay を自分のハードウェアで動かせますか？")])]),a("li",[a("a",{attrs:{href:"#既存の-vps-に-btcpay-をデプロイできますか？"}},[t._v("既存の VPS に BTCPay をデプロイできますか？")])]),a("li",[a("a",{attrs:{href:"#試せる無料ホストはありますか？"}},[t._v("試せる無料ホストはありますか？")])]),a("li",[a("a",{attrs:{href:"#初回デプロイ後、まだログインがなく登録もできません"}},[t._v("初回デプロイ後、まだログインがなく登録もできません")])]),a("li",[a("a",{attrs:{href:"#btcpay-server-で-tor-を有効化するには？"}},[t._v("BTCPay Server で Tor を有効化するには？")])]),a("li",[a("a",{attrs:{href:"#btcpay-server-で-tor-を無効化するには？"}},[t._v("BTCPay Server で Tor を無効化するには？")])]),a("li",[a("a",{attrs:{href:"#なぜ-tor-を有効化するのですか？-有効化すると誰にも身元が分からなくなりますか？"}},[t._v("なぜ Tor を有効化するのですか？ 有効化すると誰にも身元が分からなくなりますか？")])]),a("li",[a("a",{attrs:{href:"#clearnet-を使わずに-onion-アドレスへアクセスするには？"}},[t._v("clearnet を使わずに .onion アドレスへアクセスするには？")])]),a("li",[a("a",{attrs:{href:"#環境変数を変更または無効化するには？"}},[t._v("環境変数を変更または無効化するには？")])]),a("li",[a("a",{attrs:{href:"#btcpay-を-testnet-で実行するには？"}},[t._v("BTCPay を testnet で実行するには？")])]),a("li",[a("a",{attrs:{href:"#支払いを受ける予定があるときだけ-btcpay-を起動できますか？"}},[t._v("支払いを受ける予定があるときだけ BTCPay を起動できますか？")])]),a("li",[a("a",{attrs:{href:"#ポート-8333-で-btcpay-の-bitcoin-p2p-に接続できますか？"}},[t._v("ポート 8333 で BTCPay の Bitcoin P2P に接続できますか？")])]),a("li",[a("a",{attrs:{href:"#ssl-証明書を更新するには？"}},[t._v("SSL 証明書を更新するには？")])]),a("li",[a("a",{attrs:{href:"#既存の-nginx-サーバーを-ssl-終端付きリバースプロキシとして使えますか？"}},[t._v("既存の Nginx サーバーを SSL 終端付きリバースプロキシとして使えますか？")])]),a("li",[a("a",{attrs:{href:"#bitcoin-core-の代わりに-bitcoin-knots-を使えますか？"}},[t._v("Bitcoin Core の代わりに Bitcoin Knots を使えますか？")])])])]),a("li",[a("a",{attrs:{href:"#btcpay-server-のドメイン名を変更する方法"}},[t._v("BTCPay Server のドメイン名を変更する方法")]),a("ul",[a("li",[a("a",{attrs:{href:"#dns-レコードを設定する"}},[t._v("DNS レコードを設定する")])]),a("li",[a("a",{attrs:{href:"#btcpay-server-の設定でドメイン名を変更する"}},[t._v("BTCPay Server の設定でドメイン名を変更する")])]),a("li",[a("a",{attrs:{href:"#コマンドラインでドメインを変更する"}},[t._v("コマンドラインでドメインを変更する")])])])]),a("li",[a("a",{attrs:{href:"#web-デプロイ"}},[t._v("Web デプロイ")]),a("ul",[a("li",[a("a",{attrs:{href:"#btcpay-を自宅のコンピューターで実行できますか？"}},[t._v("BTCPay を自宅のコンピューターで実行できますか？")])]),a("li",[a("a",{attrs:{href:"#lunanode-web-デプロイ"}},[t._v("LunaNode Web デプロイ")])])])]),a("li",[a("a",{attrs:{href:"#手動デプロイ"}},[t._v("手動デプロイ")]),a("ul",[a("li",[a("a",{attrs:{href:"#linux-環境（docker-版）から-btcpay-を完全にアンインストールするには"}},[t._v("Linux 環境（Docker 版）から BTCPay を完全にアンインストールするには")])]),a("li",[a("a",{attrs:{href:"#既存の-bitcoin-ノードと並行して-btcpay-server-をデプロイするには？"}},[t._v("既存の Bitcoin ノードと並行して BTCPay Server をデプロイするには？")])]),a("li",[a("a",{attrs:{href:"#docker-デプロイで、データ用に別ボリュームを使うには？"}},[t._v("Docker デプロイで、データ用に別ボリュームを使うには？")])]),a("li",[a("a",{attrs:{href:"#503-service-temporarily-unavailable-nginx-が表示される"}},[t._v("503 Service Temporarily Unavailable nginx が表示される")])])])])])]),a("p"),t._v(" "),a("h2",{attrs:{id:"一般的なデプロイ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一般的なデプロイ"}},[t._v("#")]),t._v(" 一般的なデプロイ")]),t._v(" "),a("h3",{attrs:{id:"btcpay-server-の運用にはどれくらい費用がかかりますか？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#btcpay-server-の運用にはどれくらい費用がかかりますか？"}},[t._v("#")]),t._v(" BTCPay Server の運用にはどれくらい費用がかかりますか？")]),t._v(" "),a("p",[t._v("BTCPay は 100% 無料のオープンソースソフトウェアです。私たちが料金を請求することはありません。\nただし、運用するにはホスティングが必要です。自分のローカルサーバーでセルフホストすることも、クラウドホスティングプロバイダーを利用することもできます（多くのユーザーはこちらを選択しています）。上級ユーザーは "),a("RouterLink",{attrs:{to:"/Deployment/Hardware/"}},[t._v("自前ハードウェア")]),t._v(" 上で BTCPay を実行できます。技術的な知識が少ないユーザーは "),a("RouterLink",{attrs:{to:"/Deployment/HardwareAsAService/"}},[t._v("Hardware as a Service オプション")]),t._v(" を利用できます。自分でサーバーをホストしたくない場合は、無料の "),a("RouterLink",{attrs:{to:"/Deployment/ThirdPartyHosting/"}},[t._v("サードパーティホスト")]),t._v(" も利用できます。BTCPay の実行方法については、"),a("RouterLink",{attrs:{to:"/Deployment/"}},[t._v("デプロイページ")]),t._v(" で詳しく確認してください。")],1),t._v(" "),a("h3",{attrs:{id:"btcpay-の最小要件は何ですか？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#btcpay-の最小要件は何ですか？"}},[t._v("#")]),t._v(" BTCPay の最小要件は何ですか？")]),t._v(" "),a("p",[t._v("Bitcoin と Lightning Network ノードを実行する場合の最小要件は次のとおりです。")]),t._v(" "),a("ul",[a("li",[t._v("2GB RAM")]),t._v(" "),a("li",[t._v("80 GB のストレージ（"),a("RouterLink",{attrs:{to:"/Docker/#generated-docker-compose"}},[t._v("pruning を有効化")]),t._v("）")],1),t._v(" "),a("li",[t._v("Docker")])]),t._v(" "),a("h3",{attrs:{id:"セルフホストの-btcpay-server-をデプロイする最も簡単な方法は何ですか？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#セルフホストの-btcpay-server-をデプロイする最も簡単な方法は何ですか？"}},[t._v("#")]),t._v(" セルフホストの BTCPay Server をデプロイする最も簡単な方法は何ですか？")]),t._v(" "),a("p",[t._v("初心者には、セルフホストを希望する場合は "),a("RouterLink",{attrs:{to:"/Deployment/LunaNode/"}},[t._v("Web デプロイ")]),t._v("、または "),a("RouterLink",{attrs:{to:"/Deployment/ThirdPartyHosting/"}},[t._v("サードパーティホスト")]),t._v(" の利用を強く推奨します。")],1),t._v(" "),a("p",[t._v("複数の暗号通貨コインを追加する場合は、それぞれのブロックチェーンサイズに応じてストレージを増やす必要があります。")]),t._v(" "),a("h3",{attrs:{id:"適切なデプロイ方法はどう選べばよいですか？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#適切なデプロイ方法はどう選べばよいですか？"}},[t._v("#")]),t._v(" 適切なデプロイ方法はどう選べばよいですか？")]),t._v(" "),a("p",[t._v("インストール方法の比較については "),a("RouterLink",{attrs:{to:"/Deployment/"}},[t._v("デプロイページ")]),t._v(" を参照し、自分のニーズとスキルレベルに最も合う方法を選択してください。")],1),t._v(" "),a("h3",{attrs:{id:"btcpay-を自分のハードウェアで動かせますか？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#btcpay-を自分のハードウェアで動かせますか？"}},[t._v("#")]),t._v(" BTCPay を自分のハードウェアで動かせますか？")]),t._v(" "),a("p",[t._v("はい、可能です。詳細な手順は "),a("RouterLink",{attrs:{to:"/Deployment/Hardware/"}},[t._v("ハードウェアデプロイページ")]),t._v(" を確認してください。")],1),t._v(" "),a("h3",{attrs:{id:"既存の-vps-に-btcpay-をデプロイできますか？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#既存の-vps-に-btcpay-をデプロイできますか？"}},[t._v("#")]),t._v(" 既存の VPS に BTCPay をデプロイできますか？")]),t._v(" "),a("p",[t._v("はい。BTCPay はドキュメント化されたデプロイ方法に限定されません。最小要件を満たす限り、好みのホスティングソリューションを利用できます。")]),t._v(" "),a("h3",{attrs:{id:"試せる無料ホストはありますか？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#試せる無料ホストはありますか？"}},[t._v("#")]),t._v(" 試せる無料ホストはありますか？")]),t._v(" "),a("p",[t._v("セルフホストの BTCPay では、無制限のユーザーとストアを紐付けられます。一部のコミュニティユーザーは、主にテストや学習目的で他の人が使えるよう、サーバーを公開登録にしています。その多くはコミュニティ主導で無料です。詳細は "),a("RouterLink",{attrs:{to:"/Deployment/ThirdPartyHosting/"}},[t._v("サードパーティホストのドキュメント")]),t._v(" を参照してください。")],1),t._v(" "),a("h3",{attrs:{id:"初回デプロイ後、まだログインがなく登録もできません"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#初回デプロイ後、まだログインがなく登録もできません"}},[t._v("#")]),t._v(" 初回デプロイ後、まだログインがなく登録もできません")]),t._v(" "),a("p",[t._v("BTCPay Server をデプロイしたら、最初にユーザー登録を行う必要があります（サーバー同期中）。この最初のユーザーは自動的にサーバー管理者になります。初回デプロイ後にヘッダーメニューが Login しか表示されず、最初のユーザー登録ができない場合は、すでに別の誰かが管理者として登録した可能性があります。発生確率は高くありませんが（そのユーザーがあなたの BTCPay ドメイン名を知り監視している必要があります）、SSH の秘密鍵にアクセスされた可能性があるため、セキュリティ上の理由で新しいサーバーを再デプロイしてください。")]),t._v(" "),a("h3",{attrs:{id:"btcpay-server-で-tor-を有効化するには？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#btcpay-server-で-tor-を有効化するには？"}},[t._v("#")]),t._v(" BTCPay Server で Tor を有効化するには？")]),t._v(" "),a("p",[t._v("Docker デプロイでは Tor はデフォルトで有効です。")]),t._v(" "),a("h3",{attrs:{id:"btcpay-server-で-tor-を無効化するには？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#btcpay-server-で-tor-を無効化するには？"}},[t._v("#")]),t._v(" BTCPay Server で Tor を無効化するには？")]),t._v(" "),a("p",[t._v("非常に簡単です。SSH でインスタンスにログインし、root で次のコマンドを実行してください。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("BTCPAYGEN_EXCLUDE_FRAGMENTS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$BTCPAYGEN_EXCLUDE_FRAGMENTS")]),t._v(';opt-add-tor"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" btcpay-setup.sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),t._v("\n")])])]),a("p",[t._v("その後、サーバーが再起動するまで数分待てば完了です。")]),t._v(" "),a("h3",{attrs:{id:"なぜ-tor-を有効化するのですか？-有効化すると誰にも身元が分からなくなりますか？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#なぜ-tor-を有効化するのですか？-有効化すると誰にも身元が分からなくなりますか？"}},[t._v("#")]),t._v(" なぜ Tor を有効化するのですか？ 有効化すると誰にも身元が分からなくなりますか？")]),t._v(" "),a("p",[t._v("BTCPay Server における Tor は、主にセットアッププロセスを改善する目的で提供されており、自宅やオフィスの自前デバイスでのホスティングに柔軟性をもたらします。")]),t._v(" "),a("p",[t._v("Tor を有効化すると、次の設定手順が不要になり、よりシンプルなプラグアンドプレイで BTCPay を利用できます。")]),t._v(" "),a("ul",[a("li",[t._v("ファイアウォールで複数ポートを開放する")]),t._v(" "),a("li",[t._v("ローカルネットワーク上のデバイスへポート転送するための NAT を設定する")]),t._v(" "),a("li",[t._v("HTTPS 証明書を取得するために DNS エントリを設定する")]),t._v(" "),a("li",[t._v("Lightning 用に固定 IP を用意する")])]),t._v(" "),a("p",[t._v("これらは通常 VPS で BTCPay をホストする場合は問題になりにくいですが、自宅やオフィスのネットワーク環境では、非技術ユーザーには難しいことがあります。")]),t._v(" "),a("p",[t._v("Tor はこれらの問題を一度に解決します。必要なのはデバイスをローカルネットワークにつなぐだけです。特に POS アプリケーションで有用です。")]),t._v(" "),a("p",[t._v("ただし、完全なプライバシーとセキュリティを求めるなら、"),a("strong",[t._v("BTCPay で Tor を有効化するだけでは不十分です。")])]),t._v(" "),a("p",[t._v("Tor は開発者にとって非常に扱いが難しいソフトウェアで、わずかなミスでも匿名性が損なわれる可能性があります。BTCPay はより複雑なサービスへ進化し、プラグインも増え続けているため、すべての通信を Tor 経由にしようとしても、平文データの漏えいが絶対に起こらないとは保証できません。")]),t._v(" "),a("p",[t._v("私たちは、セキュリティがない状態よりも、あるいは不完全だと分かっているセキュリティよりも、「安全だと思い込むこと」のほうが危険だと考えています。そのため、Tor を有効化しても、他者があなたのインスタンス Web サイトや Bitcoin / Lightning ノードへ平文で接続すること自体は防げず、"),a("strong",[t._v("匿名にはまったくなりません。")])]),t._v(" "),a("p",[t._v("この背景にある考え方について詳しく知りたい場合は、"),a("a",{attrs:{href:"https://medium.com/@BtcpayServer/about-tor-and-btcpay-server-2ec1e4bd5e51",target:"_blank",rel:"noopener noreferrer"}},[t._v("Medium の記事"),a("OutboundLink")],1),t._v(" を参照してください。")]),t._v(" "),a("h3",{attrs:{id:"clearnet-を使わずに-onion-アドレスへアクセスするには？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#clearnet-を使わずに-onion-アドレスへアクセスするには？"}},[t._v("#")]),t._v(" clearnet を使わずに .onion アドレスへアクセスするには？")]),t._v(" "),a("p",[t._v("clearnet 経由でアクセスして左上の Tor ロゴをクリックしなくても、次のコマンドで BTCPay インスタンスの .onion アドレスを確認できます。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /var/lib/docker/volumes/generated_tor_servicesdir/_data/BTCPayServer/hostname\n")])])]),a("h3",{attrs:{id:"環境変数を変更または無効化するには？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#環境変数を変更または無効化するには？"}},[t._v("#")]),t._v(" 環境変数を変更または無効化するには？")]),t._v(" "),a("p",[t._v("BTCPay では、さまざまなオプションが環境変数で有効化されています。これらのオプションは、"),a("code",[t._v('export {environment variable}="{value}"')]),t._v(" で新しい値をエクスポートし、その後 "),a("code",[t._v(". ./btcpay-setup.sh -i")]),t._v(" を再実行することで、コマンドラインから変更または削除できます。")]),t._v(" "),a("p",[t._v("例えば、BTCPay サーバーの Tor を無効化したい場合は次のとおりです。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Login as root")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("su")]),t._v(" -\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Go to the root/btcpayserver-docker directory")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /root/btcpayserver-docker\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Print the complete list of options that you are running (for the sake of the demonstration, let's say that besides Tor you have pruning mode activated too)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$BTCPAYGEN_ADDITIONAL_FRAGMENTS")]),t._v("\nopt-save-storage-s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("opt-add-tor\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Export the BTCPAYGEN_ADDITIONAL_FRAGMENTS variable without opt-add-tor")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("BTCPAYGEN_ADDITIONAL_FRAGMENTS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"opt-save-storage-s"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Run btcpay-setup.sh")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" btcpay-setup.sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v("\n")])])]),a("p",[t._v("同様に、環境変数を追加する場合は、"),a("code",[t._v("export")]),t._v(" コマンドは次のようになります。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Enable Tor in addition to your existing environment variables (such as pruning)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("BTCPAYGEN_ADDITIONAL_FRAGMENTS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$BTCPAYGEN_ADDITIONAL_FRAGMENTS")]),t._v(';opt-add-tor"')]),t._v("\n")])])]),a("p",[t._v("どの環境変数を変更すべきか確認したい場合は、"),a("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker#environment-variables",target:"_blank",rel:"noopener noreferrer"}},[t._v("この一覧"),a("OutboundLink")],1),t._v(" を参照してください。")]),t._v(" "),a("h3",{attrs:{id:"btcpay-を-testnet-で実行するには？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#btcpay-を-testnet-で実行するには？"}},[t._v("#")]),t._v(" BTCPay を testnet で実行するには？")]),t._v(" "),a("p",[t._v("上のセクションを踏まえると、デフォルトの "),a("code",[t._v("mainnet")]),t._v(" ではなく "),a("code",[t._v("testnet")]),t._v(" を使う設定は次のとおりです。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Export the NBITCOIN_NETWORK variable switching to testnet")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("NBITCOIN_NETWORK")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"testnet"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Run btcpay-setup.sh for the change to take effect")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" btcpay-setup.sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),t._v("\n")])])]),a("p",[t._v("すべてを自分でデプロイせずに素早く試したい場合は、"),a("RouterLink",{attrs:{to:"/TryItOut/"}},[t._v("試してみる")]),t._v(" セクションを確認してください。\nここには、私たちがホストしている BTCPay の testnet インスタンスへのリンクと説明があります。")],1),t._v(" "),a("h3",{attrs:{id:"支払いを受ける予定があるときだけ-btcpay-を起動できますか？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#支払いを受ける予定があるときだけ-btcpay-を起動できますか？"}},[t._v("#")]),t._v(" 支払いを受ける予定があるときだけ BTCPay を起動できますか？")]),t._v(" "),a("p",[t._v("いいえ。Bitcoin ノードがブロックチェーンと同期してトランザクションを検証できるよう、BTCPay は常時稼働させる必要があります。ときどき起動するだけだと最新ブロックの検証追従に時間がかかり、支払い反映が大幅に遅れます。")]),t._v(" "),a("h3",{attrs:{id:"ポート-8333-で-btcpay-の-bitcoin-p2p-に接続できますか？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ポート-8333-で-btcpay-の-bitcoin-p2p-に接続できますか？"}},[t._v("#")]),t._v(" ポート 8333 で BTCPay の Bitcoin P2P に接続できますか？")]),t._v(" "),a("p",[t._v("BTCPay の Bitcoin Core ノードは、デフォルトでは外部公開されていません。BTCPay の用途では帯域要件を増やすため、通常これはユーザーの利益になりません。また BTCPay はこのポートへの接続をホワイトバインドしているため、公開すると DDoS の潜在的リスクにさらされます。")]),t._v(" "),a("p",[t._v("ただし、Tor 経由ではフルノードへの P2P 接続を公開しています。Tor アドレスは次のコマンドで取得できます。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /var/lib/docker/volumes/generated_tor_servicesdir/_data/BTC-P2P/hostname\n")])])]),a("p",[t._v("または、管理者でログインした BTCPay Server インスタンスの "),a("code",[t._v("Server Settings")]),t._v(" から確認できます。")]),t._v(" "),a("p",[t._v("この Tor hidden service は信頼できない相手と共有しないでください。この hidden service への接続は Bitcoin ノード側でホワイトリストされるため、悪意あるピアがノードを DDoS できる可能性があります。")]),t._v(" "),a("p",[t._v("bitcoind の P2P ポート 8333 を安全性を下げて公開する必要がある場合（例: Bisq、DOJO、Esplora などで P2P が必要な場合）で、Docker デプロイを使用しているなら、追加フラグメント "),a("RouterLink",{attrs:{to:"/Docker/#generated-docker-compose"}},[t._v("opt-unsafe-expose")]),t._v(" を利用できます。")],1),t._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[t._v("警告")]),t._v(" "),a("p",[t._v("信頼できる LAN 上、または特定ホストのみを許可するファイアウォールのホワイトリスト設定と併用する場合にのみ使用してください")])]),t._v(" "),a("h3",{attrs:{id:"ssl-証明書を更新するには？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssl-証明書を更新するには？"}},[t._v("#")]),t._v(" SSL 証明書を更新するには？")]),t._v(" "),a("p",[t._v("BTCPay Server の SSL 証明書が期限切れになった場合、手動で更新できます。Docker デプロイでは、サーバー上の "),a("code",[t._v("letsencrypt-nginx-proxy-companion")]),t._v(" という名前の "),a("RouterLink",{attrs:{to:"/Troubleshooting/#13-restarting-a-service"}},[t._v("コンテナを再起動")]),t._v(" するのが最も簡単です。")],1),t._v(" "),a("h3",{attrs:{id:"既存の-nginx-サーバーを-ssl-終端付きリバースプロキシとして使えますか？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#既存の-nginx-サーバーを-ssl-終端付きリバースプロキシとして使えますか？"}},[t._v("#")]),t._v(" 既存の Nginx サーバーを SSL 終端付きリバースプロキシとして使えますか？")]),t._v(" "),a("p",[t._v("はい、可能です。適切な設定を使用してください。")]),t._v(" "),a("p",[a("code",[t._v("/etc/nginx/sites-available/btcpayserver")]),t._v(" に vhost 用の追加設定ファイルを作成し、"),a("code",[t._v("/etc/nginx/sites-enabled/btcpayserver")]),t._v(" にこのファイルへのシンボリックリンクを作成します。")]),t._v(" "),a("p",[t._v("この vhost ファイルの内容は次のようになります。")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v(" /var/www/html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v(" index.html index.htm index.nginx-debian.html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Put your domain name here")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v(" btcpay.domain.com")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Needed for Let's Encrypt verification")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" ~ /.well-known/acme-challenge")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("allow")]),t._v(" all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Force HTTP to HTTPS")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("301")]),t._v(" https://"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_host")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_uri")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v(" ssl http2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# SSL certificate by Let's Encrypt in this Nginx (not using Let's Encyrpt that came with BTCPay Server Docker)")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_certificate")]),t._v("      /etc/letsencrypt/live/btcpay.domain.com/fullchain.pem")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_certificate_key")]),t._v("  /etc/letsencrypt/live/btcpay.domain.com/privkey.pem")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v(" /var/www/html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v(" index.html index.htm index.nginx-debian.html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Put your domain name here")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v(" btcpay.domain.com")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Route everything to the real BTCPay server")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# URL of BTCPay Server (i.e. a Docker installation with REVERSEPROXY_HTTP_PORT set to 10080)")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" http://127.0.0.1:10080")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\t\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" Host "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_host")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" X-Forwarded-Proto "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$scheme")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" X-Real-IP "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" X-Forwarded-For "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$proxy_add_x_forwarded_for")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# For websockets (used by Ledger hardware wallets)")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" Upgrade "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_upgrade")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Needed for Let's Encrypt verification")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" ~ /.well-known/acme-challenge")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("allow")]),t._v(" all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("p",[t._v("また、メインの Nginx 設定ファイル "),a("code",[t._v("/etc/nginx/nginx.conf")]),t._v(" に次を追加してください。")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ... # Existing stuff")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Needed to allow very long URLs to prevent issues while signing PSBTs")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_names_hash_bucket_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("128")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_buffer_size")]),t._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("128k")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_buffers")]),t._v("              "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("256k")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_busy_buffers_size")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("256k")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("client_header_buffer_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("500k")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("large_client_header_buffers")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("500k")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Needed websocket support (used by Ledger hardware wallets)")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("map")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_upgrade")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$connection_upgrade")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" upgrade")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t''      "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("close")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("次に、"),a("code",[t._v("service nginx configtest")]),t._v(" で Nginx の設定をテストし、"),a("code",[t._v("service nginx reload")]),t._v(" で設定を再読み込みします。")]),t._v(" "),a("p",[t._v("続いて、BTCPayServer 側で HTTPS を処理しないようにする必要があります。BTCPayServer インスタンスで無効化してください。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("BTCPAYGEN_EXCLUDE_FRAGMENTS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$BTCPAYGEN_EXCLUDE_FRAGMENTS")]),t._v(';nginx-https"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" btcpay-setup.sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),t._v("\n")])])]),a("p",[t._v("注意: BTCPay Server のインストールで複数ドメイン（例: "),a("code",[t._v("WOOCOMMERCE_HOST")]),t._v(" や "),a("code",[t._v("BTCPAY_ADDITIONAL_HOSTS")]),t._v("）を使用している場合、各ドメイン名ごとに設定を変更する必要があります。上記の例は "),a("code",[t._v("btcpay.domain.com")]),t._v(" という 1 つのドメインのみを対象にしています。")]),t._v(" "),a("h3",{attrs:{id:"bitcoin-core-の代わりに-bitcoin-knots-を使えますか？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bitcoin-core-の代わりに-bitcoin-knots-を使えますか？"}},[t._v("#")]),t._v(" Bitcoin Core の代わりに Bitcoin Knots を使えますか？")]),t._v(" "),a("p",[t._v("可能です。まずデプロイを最近更新済みであること（"),a("code",[t._v("btcpay-update.sh")]),t._v("）を確認し、次のコマンドを実行してください。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("BTCPAYGEN_EXCLUDE_FRAGMENTS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$BTCPAYGEN_EXCLUDE_FRAGMENTS")]),t._v(';bitcoin"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("BTCPAYGEN_ADDITIONAL_FRAGMENTS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$BTCPAYGEN_ADDITIONAL_FRAGMENTS")]),t._v(';bitcoinknots"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" btcpay-setup.sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),t._v("\n")])])]),a("h2",{attrs:{id:"btcpay-server-のドメイン名を変更する方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#btcpay-server-のドメイン名を変更する方法"}},[t._v("#")]),t._v(" BTCPay Server のドメイン名を変更する方法")]),t._v(" "),a("h3",{attrs:{id:"dns-レコードを設定する"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dns-レコードを設定する"}},[t._v("#")]),t._v(" DNS レコードを設定する")]),t._v(" "),a("p",[t._v("ドメインを購入し、それを BTCPay Server に接続したい場合、\n通常はホスティング事業者にドメイン管理ページがあります。\nそこで "),a("code",[t._v("DNS records")]),t._v(" ページを開き、"),a("code",[t._v("CNAME")]),t._v(" レコードを追加します。")]),t._v(" "),a("p",[t._v("このレコードでは、VPS ホストから提供されたドメインを指すように設定します。\nIP アドレスで設定することもできますが、その場合は "),a("code",[t._v("CNAME record")]),t._v(" ではなく "),a("code",[t._v("A Record")]),t._v(" になります。")]),t._v(" "),a("p",[t._v("これは "),a("a",{attrs:{href:"https://gandi.net/",target:"_blank",rel:"noopener noreferrer"}},[t._v("gandi.net"),a("OutboundLink")],1),t._v(" での表示例です。")]),t._v(" "),a("figure",[a("img",{attrs:{src:s(510),alt:"Gandi3",title:"Gandi3"}})]),t._v(" "),a("h3",{attrs:{id:"btcpay-server-の設定でドメイン名を変更する"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#btcpay-server-の設定でドメイン名を変更する"}},[t._v("#")]),t._v(" BTCPay Server の設定でドメイン名を変更する")]),t._v(" "),a("p",[t._v("BTCPay Server で "),a("code",[t._v("Server Settings")]),t._v(" メニューを開き、"),a("code",[t._v("Maintenance")]),t._v(" タブに進みます。\nここに旧ドメインを新ドメインへ置き換える項目があり、更新には数秒かかる場合があります。")]),t._v(" "),a("figure",[a("img",{attrs:{src:s(511),alt:"Maintenance domain name",title:"Maintenance domain name"}})]),t._v(" "),a("p",[t._v("次に、アドレスバーへ新しいドメインを入力し、動作するか確認してください。")]),t._v(" "),a("figure",[a("img",{attrs:{src:s(512),alt:"Maintenance2",title:"Maintenance2"}})]),t._v(" "),a("h3",{attrs:{id:"コマンドラインでドメインを変更する"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#コマンドラインでドメインを変更する"}},[t._v("#")]),t._v(" コマンドラインでドメインを変更する")]),t._v(" "),a("p",[t._v("SSH 経由でサーバーに接続します。")]),t._v(" "),a("p",[t._v("例:")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ssh")]),t._v(" btcpayserver@myawesomedemobtcpay.westeurope.cloudapp.azure.com\n")])])]),a("p",[t._v("パスワードを入力し、ドメイン名を変更します。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("su")]),t._v(" -\nchangedomain.sh tothemoon.btcpayserver.com\n")])])]),a("p",[t._v("成功です。")]),t._v(" "),a("h2",{attrs:{id:"web-デプロイ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#web-デプロイ"}},[t._v("#")]),t._v(" Web デプロイ")]),t._v(" "),a("p",[t._v("ここでは、BTCPay の Web デプロイに関する一般的な質問と解決策を示します。")]),t._v(" "),a("h3",{attrs:{id:"btcpay-を自宅のコンピューターで実行できますか？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#btcpay-を自宅のコンピューターで実行できますか？"}},[t._v("#")]),t._v(" BTCPay を自宅のコンピューターで実行できますか？")]),t._v(" "),a("p",[t._v("Web サイトをホストする要件と同様に、BTCPay Server インスタンスには Web サーバーが必要です。BTCPay Server をローカル PC で動かすこと自体は可能ですが、最小要件を満たし、サービス中断を避けるため 24 時間 365 日稼働させる必要があります。また、BTCPay Server の支払い関連アクティビティに関して自宅 IP アドレスを公開したくない場合も多いでしょう。これらの理由から、ローカルホスティングはテスト用途には適していますが、本番用途には現実的ではありません。一般的には、これらの問題を解決するために仮想専用サーバー（VPS）が使用されます。")]),t._v(" "),a("h3",{attrs:{id:"lunanode-web-デプロイ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#lunanode-web-デプロイ"}},[t._v("#")]),t._v(" LunaNode Web デプロイ")]),t._v(" "),a("h4",{attrs:{id:"lunanode-の-btcpay-でドメイン名を変更するには？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#lunanode-の-btcpay-でドメイン名を変更するには？"}},[t._v("#")]),t._v(" LunaNode の BTCPay でドメイン名を変更するには？")]),t._v(" "),a("ol",[a("li",[t._v("LunaNode ダッシュボードで、Virtual Machines > Your Virtual Machine > General Tab > External IP を開き、外部 IP をコピーします。")]),t._v(" "),a("li",[t._v("DNS プロバイダーで A レコードを作成し、外部 IP を貼り付けます。")]),t._v(" "),a("li",[t._v("Server Settings > Maintenance > Change Domain を開き、"),a("code",[t._v("http")]),t._v(" や "),a("code",[t._v("https")]),t._v(" のプレフィックスなしで yourdomain.com を貼り付けます。")])]),t._v(" "),a("p",[t._v("追加ドキュメント: "),a("RouterLink",{attrs:{to:"/FAQ/Deployment/#how-to-change-your-btcpay-server-domain-name"}},[t._v("BTCPay Server のドメイン名を変更する方法")]),t._v(")。")],1),t._v(" "),a("h2",{attrs:{id:"手動デプロイ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#手動デプロイ"}},[t._v("#")]),t._v(" 手動デプロイ")]),t._v(" "),a("h4",{attrs:{id:"ubuntu-1804-に-btcpay-を手動インストールするには？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu-1804-に-btcpay-を手動インストールするには？"}},[t._v("#")]),t._v(" Ubuntu 18.04 に BTCPay を手動インストールするには？")]),t._v(" "),a("p",[t._v("この "),a("a",{attrs:{href:"https://freedomnode.com/blog/114/how-to-setup-btc-and-lightning-payment-gateway-with-btcpayserver-on-linux-manual-install",target:"_blank",rel:"noopener noreferrer"}},[t._v("コミュニティガイド"),a("OutboundLink")],1),t._v(" を確認してください。")]),t._v(" "),a("h3",{attrs:{id:"linux-環境（docker-版）から-btcpay-を完全にアンインストールするには"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#linux-環境（docker-版）から-btcpay-を完全にアンインストールするには"}},[t._v("#")]),t._v(" Linux 環境（Docker 版）から BTCPay を完全にアンインストールするには")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker/blob/master/btcpay-teardown.sh",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("btcpay-teardown.sh")]),a("OutboundLink")],1),t._v(" スクリプトを次のように実行します。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("su")]),t._v(" -\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" ./btcpay-teardown.sh\n")])])]),a("p",[t._v("これで、インスタンスから BTCPay Server が完全に削除され、関連する Docker コンテナとボリュームも削除されます。")]),t._v(" "),a("h3",{attrs:{id:"既存の-bitcoin-ノードと並行して-btcpay-server-をデプロイするには？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#既存の-bitcoin-ノードと並行して-btcpay-server-をデプロイするには？"}},[t._v("#")]),t._v(" 既存の Bitcoin ノードと並行して BTCPay Server をデプロイするには？")]),t._v(" "),a("p",[t._v("以下の手順は Docker デプロイ向けです。")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker#full-installation-for-technical-users",target:"_blank",rel:"noopener noreferrer"}},[t._v("btcpayserver-docker"),a("OutboundLink")],1),t._v(" の説明に従って "),a("code",[t._v(". ./btcpay-setup.sh -i")]),t._v(" までセットアップを進める")]),t._v(" "),a("li",[a("code",[t._v("docker-compose-generator/docker-fragments/")]),t._v(" フォルダに "),a("code",[t._v("bitcoin.custom.yml")]),t._v(" を作成する")])]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("btcpayserver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("BTCPAY_CHAINS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'btc'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("BTCPAY_BTCEXPLORERURL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//nbxplorer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("32838/\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nbxplorer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("NBXPLORER_CHAINS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'btc'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("NBXPLORER_BTCRPCURL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//host.docker.internal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("43782/\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("NBXPLORER_BTCRPCUSER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rpc-username'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("NBXPLORER_BTCRPCPASSWORD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rpc-password'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("NBXPLORER_BTCNODEENDPOINT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" host.docker.internal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("39388")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'localBitcoinfolder:/root/.bitcoin'")]),t._v("\n")])])]),a("ul",[a("li",[a("code",[t._v("43782")]),t._v(" を、Bitcoin ノードで設定している RPC ポートに置き換える")]),t._v(" "),a("li",[a("code",[t._v("rpc-username")]),t._v(" を、Bitcoin ノードで設定している RPC ユーザー名に置き換える")]),t._v(" "),a("li",[a("code",[t._v("rpc-password")]),t._v(" を、Bitcoin ノードで設定している RPC パスワードに置き換える")]),t._v(" "),a("li",[a("code",[t._v("39388")]),t._v(" を、Bitcoin ノードで設定している p2p ポートに置き換える")]),t._v(" "),a("li",[a("code",[t._v("localBitcoinfolder")]),t._v(" を、Bitcoin データフォルダのパスに置き換える")])]),t._v(" "),a("p",[t._v("Linux で実行している場合は、"),a("a",{attrs:{href:"https://github.com/docker/for-linux/issues/264",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker の制約"),a("OutboundLink")],1),t._v(" により次も必要です。")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("ip route | grep docker0 | awk '{print $9}'")]),t._v(" を実行する\n"),a("ul",[a("li",[a("code",[t._v("bitcoin.custom.yml")]),t._v(" ファイルの末尾に次を追加し、"),a("code",[t._v("$DOCKER_HOST_IP")]),t._v(" を前のコマンド結果で置き換える")])])])]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("extra_hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'host.docker.internal:$DOCKER_HOST_IP'")]),t._v("\n")])])]),a("ul",[a("li",[a("code",[t._v('export BTCPAYGEN_EXCLUDE_FRAGMENTS="bitcoin"')]),t._v(" を実行する")]),t._v(" "),a("li",[a("code",[t._v('export BTCPAYGEN_ADDITIONAL_FRAGMENTS="$BTCPAYGEN_ADDITIONAL_FRAGMENTS;bitcoin.custom"')]),t._v(" を実行する")]),t._v(" "),a("li",[a("code",[t._v(". ./btcpay-setup.sh -i")]),t._v(" を実行する")])]),t._v(" "),a("p",[t._v("既存の Lightning ノードと並行デプロイする方法を探している場合は、"),a("RouterLink",{attrs:{to:"/FAQ/LightningNetwork/#can-i-use-my-existing-ln-node-with-btcpay"}},[t._v("こちら")]),t._v(" を参照してください。")],1),t._v(" "),a("h3",{attrs:{id:"docker-デプロイで、データ用に別ボリュームを使うには？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-デプロイで、データ用に別ボリュームを使うには？"}},[t._v("#")]),t._v(" Docker デプロイで、データ用に別ボリュームを使うには？")]),t._v(" "),a("p",[t._v("まず、btcpayserver と docker が動作していないことを確認してください。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("su")]),t._v(" -\nbtcpay-down.sh\nsystemctl stop "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v("\n")])])]),a("p",[t._v("次にドライブをフォーマットします。すでに実施済みならこの手順はスキップできます。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Step 1: Unplug the drive")]),t._v("\nlsblk\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Step 2: Plug the drive")]),t._v("\nlsblk\n")])])]),a("p",[t._v("2 回目の "),a("code",[t._v("lsblk")]),t._v(" で、今接続したドライブ（TYPE が "),a("code",[t._v("disk")]),t._v("）が表示されるはずです。\n次のコマンドはこのディスク上のすべてのデータを消去するため、誤りがないよう注意してください。")]),t._v(" "),a("p",[t._v("例として、NAME が "),a("code",[t._v("/dev/sdd")]),t._v(" だとします。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Save the name in a variable")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("DEVICE_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/dev/sdd"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Set the partition name")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("PARTITION_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/dev/sdd1"')]),t._v("\n")])])]),a("p",[t._v("ここからディスクをパーティション分割し、パーティションをフォーマットします。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Partitioning the external drive '),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DEVICE_NAME")]),t._v('..."')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### DANGER ZONE ###")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" o "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create a new empty DOS partition table")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" n "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Add a new partition")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" p "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Primary partition")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Partition number")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# First sector (Accept default: 1)")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Last sector (Accept default: varies)")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" w "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Write changes")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fdisk")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${DEVICE_NAME}")]),t._v("\npartprobe "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${DEVICE_NAME}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" lsblk "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PARTITION_NAME")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&>")]),t._v(" /dev/null"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\nmkfs.ext4 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-F")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PARTITION_NAME")]),t._v('"')]),t._v("\n")])])]),a("p",[t._v("次に、このパーティションを Linux ファイルシステムへマウントします。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Mounting the partition")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MOUNT_DIR")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/mnt/external"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MOUNT_DIR")]),t._v('"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mount")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" defaults,noatime "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PARTITION_NAME")]),t._v('"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MOUNT_DIR")]),t._v('"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Make sure the partition exists at the next reboot, we use UUID in case")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the partition name is different in the next reboot")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-qF")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MOUNT_DIR")]),t._v('"')]),t._v(" /etc/fstab"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("UUID")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" blkid "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" UUID "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" value $PARTITION_NAME"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v('"')]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UUID='),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$UUID")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MOUNT_DIR")]),t._v(' ext4 defaults,noatime,nofail 0 2"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" /etc/fstab\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n")])])]),a("p",[t._v("続いて、マウント前に docker が起動しないように設定します。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MOUNT_UNIT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("systemd-escape "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--path")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MOUNT_DIR")]),t._v('"')]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v('.mount"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("docker_service")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/lib/systemd/system/docker.service"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-qF")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"After='),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MOUNT_UNIT")]),t._v('"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$docker_service")]),t._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"s/After=/After='),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MOUNT_UNIT")]),t._v(' /g"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$docker_service")]),t._v('"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n")])])]),a("p",[t._v("次に、先ほどのパーティションへ Docker ボリュームデータをすべて置く場合を想定します。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("DOCKER_VOLUMES")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/lib/docker/volumes"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Copy all the data from our volume to the mount directory (this can take a while)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-r")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DOCKER_VOLUMES")]),t._v('/."')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MOUNT_DIR")]),t._v('"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Make the folder a mountpoint")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-rf")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DOCKER_VOLUMES")]),t._v('"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DOCKER_VOLUMES")]),t._v('"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mount")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--bind")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MOUNT_DIR")]),t._v('"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DOCKER_VOLUMES")]),t._v('"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Make sure the mountpoint is mounted after reboot")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-qF")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DOCKER_VOLUMES")]),t._v('"')]),t._v(" /etc/fstab"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MOUNT_DIR")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DOCKER_VOLUMES")]),t._v(' none bind,nobootwait 0 2"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" /etc/fstab\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n")])])]),a("p",[t._v("最後に docker と btcpayserver を再起動します。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("systemctl start "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v("\nbtcpay-up.sh\n")])])]),a("p",[t._v("注: "),a("code",[t._v("docker volume rm")]),t._v(" 実行時に docker がエラーを出す可能性があるため、シンボリックリンクではなく mount bind を使用しています。")]),t._v(" "),a("h3",{attrs:{id:"503-service-temporarily-unavailable-nginx-が表示される"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#503-service-temporarily-unavailable-nginx-が表示される"}},[t._v("#")]),t._v(" 503 Service Temporarily Unavailable nginx が表示される")]),t._v(" "),a("h4",{attrs:{id:"原因-1-ip-アドレスで-btcpay-にアクセスしている"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#原因-1-ip-アドレスで-btcpay-にアクセスしている"}},[t._v("#")]),t._v(" 原因 1: IP アドレスで BTCPay にアクセスしている")]),t._v(" "),a("p",[t._v("nginx は HTTP リクエストを受け取ると、どのサービスが実際の宛先かを判断する必要があります。"),a("code",[t._v("BTCPAY_HOST")]),t._v(" を "),a("code",[t._v("http://raspberrypi.local/")]),t._v(" に設定している場合、BTCPay Server にはこの URL でしかアクセスできません。別のドメイン名や IP アドレス（例: "),a("code",[t._v("http://192.168.0.2")]),t._v("）でアクセスすると HTTP 503 エラーになります。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("503 Service Temporarily Unavailable\n-----------------------------------\nnginx\n")])])]),a("p",[t._v("この問題は、該当 HTTP リクエストを BTCPay Server にルーティングするよう nginx に指示することで解決できます。\n次のようにセットアップスクリプトを再実行してください。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("su")]),t._v(" -\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("REVERSEPROXY_DEFAULT_HOST")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$BTCPAY_HOST")]),t._v('"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" btcpay-setup.sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),t._v("\n")])])]),a("p",[t._v("これで "),a("code",[t._v("http://192.168.0.2")]),t._v(" へのアクセスも正しく動作するはずです。")]),t._v(" "),a("h4",{attrs:{id:"原因-2-btcpayserver-または-letsencrypt-nginx-proxy-が起動していない"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#原因-2-btcpayserver-または-letsencrypt-nginx-proxy-が起動していない"}},[t._v("#")]),t._v(" 原因 2: btcpayserver または letsencrypt-nginx-proxy が起動していない")]),t._v(" "),a("p",[t._v("確認するには次を実行します。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("less")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-S")]),t._v("\n")])])]),a("p",[a("code",[t._v("less")]),t._v(" を終了するには "),a("code",[t._v("q")]),t._v(" を押します。")]),t._v(" "),a("p",[t._v("出力には次が含まれている必要があります。")]),t._v(" "),a("ul",[a("li",[t._v("btcpayserver/letsencrypt-nginx-proxy-companion")]),t._v(" "),a("li",[t._v("btcpayserver/btcpayserver")])]),t._v(" "),a("p",[t._v("また、ステータスは "),a("code",[t._v("Up")]),t._v(" である必要があります。")]),t._v(" "),a("p",[t._v("Docker コンテナが起動していない場合は、次のようにクラッシュ理由を確認してください。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" logs 6a6b9fd75692 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--tail")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v("\n")])])]),a("p",[t._v("ここで "),a("code",[t._v("6a6b9fd75692")]),t._v(" は問題が起きているコンテナ ID です。")]),t._v(" "),a("h4",{attrs:{id:"原因-3-btcpay-がこの-web-サイトへのアクセス元を想定している"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#原因-3-btcpay-がこの-web-サイトへのアクセス元を想定している"}},[t._v("#")]),t._v(" 原因 3: BTCPay がこの Web サイトへのアクセス元を想定している")]),t._v(" "),a("p",[a("code",[t._v("You access BTCPay Server over an unsecured network")]),t._v(" というエラーが表示されることもあります。")]),t._v(" "),a("p",[t._v("このエラーは、BTCPay Server のバージョン "),a("code",[t._v("1.0.3.73")]),t._v(" 以降でフロントページに表示される場合があります。")]),t._v(" "),a("p",[t._v("これは、同一サーバー上で異なるドメインを扱えるようにするため BTCPay に入った破壊的変更が原因です。")]),t._v(" "),a("p",[t._v("問題が起きるのは、BTCPay Server がインターネットへ直接公開されておらず、代わりにリバースプロキシ（nginx や IIS など）がリクエストを受けて BTCPay Server へ転送している構成です。")]),t._v(" "),a("p",[t._v("残念ながら、リバースプロキシ設定によっては、HTTP HOST ヘッダーが置き換えられているか、または先頭側のプロトコルを示す http ヘッダー "),a("code",[t._v("X-Forwarded-Proto")]),t._v(" を転送していないことがあります。")]),t._v(" "),a("p",[t._v("NGinx を使っている場合、"),a("code",[t._v("/etc/nginx/conf.d/default.conf")]),t._v(" のトップレベルに次が必要です。")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("map")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_x_forwarded_proto")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$proxy_x_forwarded_proto")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_x_forwarded_proto")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  ''      $scheme"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" Host "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_host")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" X-Forwarded-Proto "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$proxy_x_forwarded_proto")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_names_hash_bucket_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("128")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_buffer_size")]),t._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("128k")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_buffers")]),t._v("              "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("256k")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_busy_buffers_size")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("256k")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("client_header_buffer_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("500k")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("large_client_header_buffers")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("500k")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("リバースプロキシが Apache 2 の場合は、次の 2 つの設定が必要です。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('<VirtualHost *:443>\n    RequestHeader set X-Forwarded-Proto "https"\n    ProxyPreserveHost on\n...\n</VirtualHost>\n')])])]),a("p",[t._v("PSBT 署名時の問題を防ぐため、"),a("code",[t._v("apache2.conf")]),t._v(" にも次の設定が必要です。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("LimitRequestLine 500000\nLimitRequestFieldSize 500000\n")])])]),a("h4",{attrs:{id:"原因-4-ローカルサーバーで-https-は-500-nginx-エラー、http-は-btcpay-is-expecting-you-to-access-this-website-from-が出る"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#原因-4-ローカルサーバーで-https-は-500-nginx-エラー、http-は-btcpay-is-expecting-you-to-access-this-website-from-が出る"}},[t._v("#")]),t._v(" 原因 4: ローカルサーバーで https は 500 nginx エラー、http は BTCPay is expecting you to access this website from が出る")]),t._v(" "),a("p",[t._v("ポート 80 と 443 を開放する必要があります。開放後、"),a("code",[t._v("btcpay-restart.sh")]),t._v(" で docker を再起動してください。")]),t._v(" "),a("h4",{attrs:{id:"原因-5-その他"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#原因-5-その他"}},[t._v("#")]),t._v(" 原因 5: その他")]),t._v(" "),a("p",[t._v("5XX HTTP エラーの原因は多数あります。"),a("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker/issues",target:"_blank",rel:"noopener noreferrer"}},[t._v("Issue"),a("OutboundLink")],1),t._v(" を作成し、原因が判明したらこの "),a("RouterLink",{attrs:{to:"/FAQ/Deployment/"}},[t._v("デプロイ FAQ")]),t._v(" ドキュメントへ追記してください。")],1)])}),[],!1,null,null,null);a.default=r.exports}}]);