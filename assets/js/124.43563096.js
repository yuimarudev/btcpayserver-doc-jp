(window.webpackJsonp=window.webpackJsonp||[]).push([[124],{932:function(a,t,s){"use strict";s.r(t);var e=s(17),r=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"ハードウェアデプロイ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ハードウェアデプロイ"}},[a._v("#")]),a._v(" ハードウェアデプロイ")]),a._v(" "),t("p",[a._v("Bitcoin を真に自己主権かつトラストレスに運用するには、"),t("strong",[a._v("自分のハードウェア")]),a._v("とインターネット回線でノードを動かすことを検討してください。\n"),t("strong",[a._v("BTCPay Server は Bitcoin ノードと Lightning ノードの両方を動かす優れた方法です")]),a._v("。\nトランザクションを検証できるだけでなく、ベースレイヤーの Bitcoin 支払いと第2レイヤーの Lightning 支払いを受け取れるようになります。\n以下は、BTCPay Server を自分でインストールしてホストする手順です。")]),a._v(" "),t("p",[a._v("プロセスは基本的に次のとおりです。")]),a._v(" "),t("ol",[t("li",[a._v("ハードウェアを購入して組み立てる。")]),a._v(" "),t("li",[a._v("ベースとなる OS をインストールし、ネットワーク設定を行う。")]),a._v(" "),t("li",[a._v("BTCPayServer-Docker をインストールする。")])]),a._v(" "),t("p",[t("strong",[a._v("BTCPay Server は次のハードウェアでインストールできます")]),a._v("。最終的には、ブロックゼロから同期できる十分な性能を持つ、小型で静かなノードになります。総額はおおよそ $300 です。")]),a._v(" "),t("ol",[t("li",[t("a",{attrs:{href:"https://www.amazon.com/dp/B0C89TQ1YF?ref=nb_sb_ss_w_as-reorder-t1_k0_1_4&amp=&crid=SHKYOXZIRAO0&amp=&sprefix=beel",target:"_blank",rel:"noopener noreferrer"}},[a._v("BeeLink S12 - Mini PC - $169.00"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://www.amazon.com/Western-Digital-SA510-Internal-Solid/dp/B0C14TF467/ref=sr_1_3?crid=2WDY52E7ESSEB&dib=eyJ2IjoiMSJ9.MBxkb5ZIvwjKXOzscB0GUvsbhX1rVhilXNFzID6n0xHORsDBPkIxQhIixVuiLY9I16rlFs5COExAAD8761Do-tzuAnZiutbqN-KM9rAL4zCw94kA_ArCJeR_RTDynZbiXf2Phnahw1Gw2dqXVek3p0dpe6_a_fbJrqx4BRaieoYo0zj1mX6YPGaYZAmF2Vf_Quk1TrkARk6s1_wZ0vFUw7EWdjKJ9hmNLxPWMfADML90A1rXk8gSCcRnwV2jdzN7jCfg2_urfJZ3IWOW5X3iwnP7s-vSec88PGmQ3RhS-Rc.sEURveFhiTAHYwZQdwyJX72hpWL5UgD_3tEPet747oE&dib_tag=se&keywords=2tb+ssd+wd+blue&qid=1710685725&s=electronics&sprefix=2tb+ssd+wd+blue%2Celectronics%2C90&sr=1-3",target:"_blank",rel:"noopener noreferrer"}},[a._v("WD Blue 2TB SSD - $129.00"),t("OutboundLink")],1)])]),a._v(" "),t("p",[a._v("その他に必要なもの:")]),a._v(" "),t("ol",[t("li",[a._v("高速インターネット接続。")]),a._v(" "),t("li",[a._v("固定 IP。")]),a._v(" "),t("li",[a._v("ドメイン名。")]),a._v(" "),t("li",[a._v("ルーターでポートを開放できること（任意。BTCPayServer は TOR や Dynamic DNS 経由でもアクセス可能）。")]),a._v(" "),t("li",[a._v("小型ドライバー。")]),a._v(" "),t("li",[a._v("USB メモリ。")]),a._v(" "),t("li",[a._v("USB キーボード、マウス、モニター（初回インストール時のみ。完了後はヘッドレス運用可能）。")])]),a._v(" "),t("p",[a._v("上記ハードウェアを購入した前提で、組み立て手順は次のとおりです。")]),a._v(" "),t("h3",{attrs:{id:"ドメイン名を設定する"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ドメイン名を設定する"}},[a._v("#")]),a._v(" ドメイン名を設定する")]),a._v(" "),t("p",[a._v('DNS 変更の反映には数時間かかることがあるため、この手順を最初に行ってください。\nドメインレジストラにログインし、ドメインから自宅回線のグローバル IP アドレスに向けて A レコードを設定します。\nサブドメイン（例: btcpay.yourdomain.com）の利用を推奨します。\nグローバル IP アドレスは Google で "whats my ip" と検索すると確認できます。')]),a._v(" "),t("h3",{attrs:{id:"lightning-in-a-box-liab-を組み立てる"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lightning-in-a-box-liab-を組み立てる"}},[a._v("#")]),a._v(" Lightning in a Box (LIAB) を組み立てる")]),a._v(" "),t("ul",[t("li",[a._v("ドライバーで背面カバーを外す。")]),a._v(" "),t("li",[a._v("SSD を挿入する。")]),a._v(" "),t("li",[a._v("付属ケージを使ってドライブを取り付ける。")])]),a._v(" "),t("h3",{attrs:{id:"ubuntu-2204-lts-server-をダウンロードする"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu-2204-lts-server-をダウンロードする"}},[a._v("#")]),a._v(" "),t("a",{attrs:{href:"https://releases.ubuntu.com/jammy/ubuntu-22.04.4-live-server-amd64.iso",target:"_blank",rel:"noopener noreferrer"}},[a._v("Ubuntu 22.04 LTS Server"),t("OutboundLink")],1),a._v(" をダウンロードする")]),a._v(" "),t("h3",{attrs:{id:"balena-etcher-をダウンロードしてインストールする"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#balena-etcher-をダウンロードしてインストールする"}},[a._v("#")]),a._v(" "),t("a",{attrs:{href:"https://etcher.balena.io/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Balena Etcher"),t("OutboundLink")],1),a._v(" をダウンロードしてインストールする")]),a._v(" "),t("p",[a._v("Etcher は OS イメージを SD カードや USB ドライブへ書き込むソフトウェアです。\nここでは Etcher を使って、USB メモリに Ubuntu OS を書き込みます。")]),a._v(" "),t("h3",{attrs:{id:"usb-キーボード、マウス、モニター、usb-メモリを接続する"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#usb-キーボード、マウス、モニター、usb-メモリを接続する"}},[a._v("#")]),a._v(" USB キーボード、マウス、モニター、USB メモリを接続する")]),a._v(" "),t("p",[a._v("電源ボタンを押して LIAB を起動します。"),t("code",[a._v("DEL")]),a._v(" キーを押して BIOS に入り、USB メモリを最優先で起動するようブート順を変更します。\nUbuntu のインストールは比較的シンプルで、手順に沿って進めやすいです。Ubuntu 公式チュートリアル: "),t("a",{attrs:{href:"https://ubuntu.com/tutorials/install-ubuntu-server#1-overview",target:"_blank",rel:"noopener noreferrer"}},[a._v("Install Ubuntu Server"),t("OutboundLink")],1),a._v("。BeeLink S12 には Windows がプリインストールされているため、NVME パーティションを削除してそのドライブへ Ubuntu をインストールする必要があります。")]),a._v(" "),t("p",[a._v('*インストール中にホスト名を "btcpay" に設定し、SSH を有効化してください。')]),a._v(" "),t("h3",{attrs:{id:"ローカルネットワーク上で-liab-に固定-ip-を割り当てる"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ローカルネットワーク上で-liab-に固定-ip-を割り当てる"}},[a._v("#")]),a._v(" ローカルネットワーク上で LIAB に固定 IP を割り当てる")]),a._v(" "),t("p",[a._v("方法はいくつかあり、オンラインに多くの解説があります。比較的シンプルな記事: "),t("a",{attrs:{href:"https://www.linuxtechi.com/static-ip-address-on-ubuntu-server/",target:"_blank",rel:"noopener noreferrer"}},[a._v("How to configure a static IP address on Ubuntu 22.04"),t("OutboundLink")],1),a._v('。ネットワーク内の他デバイスと競合しないよう、LIAB に対して IP "reservation" も設定してください。')]),a._v(" "),t("h3",{attrs:{id:"ルーターにログインし、ポート-80-443-9735-を-liab-のローカル-ip-に転送する（任意。local-や-tor-のみを使う場合は不要）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ルーターにログインし、ポート-80-443-9735-を-liab-のローカル-ip-に転送する（任意。local-や-tor-のみを使う場合は不要）"}},[a._v("#")]),a._v(" ルーターにログインし、ポート 80, 443, 9735 を LIAB のローカル IP に転送する（任意。.local や Tor のみを使う場合は不要）")]),a._v(" "),t("p",[a._v('ルーターごとに手順が異なるため、"Port Forward + ルーターのメーカー名と型番" で検索して確認してください。')]),a._v(" "),t("h3",{attrs:{id:"fail2ban、git、avahi-daemon-をインストールする"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#fail2ban、git、avahi-daemon-をインストールする"}},[a._v("#")]),a._v(" Fail2ban、GIT、Avahi-Daemon をインストールする")]),a._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://github.com/fail2ban/fail2ban/wiki/How-to-install-fail2ban-packages",target:"_blank",rel:"noopener noreferrer"}},[a._v("Fail2ban"),t("OutboundLink")],1),a._v(" は、サーバーへの接続を試み悪意ある挙動を示す IP をブロックします。GIT は github.com 上のリポジトリをクローン・管理するために使います。")]),a._v(" "),t("li",[t("a",{attrs:{href:"https://avahi.org/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Avahi"),t("OutboundLink")],1),a._v(" は、mDNS/DNS-SD プロトコル群を通じてローカルネットワーク上のサービス検出を容易にする仕組みです。\n新しいターミナルを開いて次のコマンドを実行してください。")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" update\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" fail2ban "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v(" avahi-daemon\n")])])]),t("h3",{attrs:{id:"ファイアウォール設定"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ファイアウォール設定"}},[a._v("#")]),a._v(" ファイアウォール設定")]),a._v(" "),t("p",[a._v("ファイアウォールをインストールし、SSH、HTTP、HTTPS、Bitcoin、Lightning を許可します。")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" ufw\nufw default deny incoming\nufw default allow outgoing\n")])])]),t("p",[a._v("次のコマンドは、内部ネットワークからの SSH 接続のみを許可します。")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("ufw allow from "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.0")]),a._v(".0.0/8 to any port "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(" proto tcp\nufw allow from "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("172.16")]),a._v(".0.0/12 to any port "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(" proto tcp\nufw allow from "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".0.0/16 to any port "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(" proto tcp\nufw allow from "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("169.254")]),a._v(".0.0/16 to any port "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(" proto tcp\nufw allow from fc00::/7 to any port "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(" proto tcp\nufw allow from fe80::/10 to any port "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(" proto tcp\nufw allow from ff00::/8 to any port "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(" proto tcp\n")])])]),t("p",[a._v("次のポートはどこからでもアクセス可能にする必要があります（サブネットを指定しない場合のデフォルトは "),t("code",[a._v("any")]),a._v("）。")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("ufw allow "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v("/tcp\nufw allow "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("443")]),a._v("/tcp\nufw allow "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8333")]),a._v("/tcp\nufw allow "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("9735")]),a._v("/tcp\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Enable the firewall")]),a._v("\nufw "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("enable")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Verify the configuration")]),a._v("\nufw status\n")])])]),t("h3",{attrs:{id:"docker-をインストールする"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-をインストールする"}},[a._v("#")]),a._v(" Docker をインストールする")]),a._v(" "),t("div",{staticClass:"language-Bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" apt-transport-https ca-certificates "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" software-properties-common\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-fsSL")]),a._v(" https://download.docker.com/linux/ubuntu/gpg "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" gpg "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dearmor")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" /usr/share/keyrings/docker-archive-keyring.gpg\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"deb [arch='),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("dpkg --print-architecture"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(" signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("lsb_release "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-cs")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(' stable"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("tee")]),a._v(" /etc/apt/sources.list.d/docker.list "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /dev/null\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" update\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt-cache")]),a._v(" policy docker-ce\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" docker-ce\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" systemctl status "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v("\n")])])]),t("h3",{attrs:{id:"ストレージを設定する"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ストレージを設定する"}},[a._v("#")]),a._v(" ストレージを設定する")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("fdisk")]),a._v(" /dev/sda\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# type 'p' to list existing partitions")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# type 'd' to delete currently selected partitions")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# type 'n' to create a new partition")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# type 'w' to write the new partition table and exit fdisk")]),a._v("\nmkfs.ext4 /dev/sda1\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" /mnt/usb\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("UUID")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" blkid "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" UUID "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" value /dev/sda1"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v('"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"UUID='),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$UUID")]),a._v(' /mnt/usb ext4 defaults,noatime,nofail 0 0"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("tee")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-a")]),a._v(" /etc/fstab\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("mount")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-a")]),a._v("\n")])])]),t("h3",{attrs:{id:"docker-ボリューム用のマウントを作成する"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-ボリューム用のマウントを作成する"}},[a._v("#")]),a._v(" Docker ボリューム用のマウントを作成する")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-rf")]),a._v(" /var/lib/docker\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" /var/lib/docker\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("mount")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--bind")]),a._v(" /mnt/usb /var/lib/docker\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/mnt/docker /var/lib/docker none bind,nobootwait 0 2"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">>")]),a._v(" /etc/fstab\nsystemctl restart "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v("\n")])])]),t("h3",{attrs:{id:"btcpay-server-をセットアップする"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#btcpay-server-をセットアップする"}},[a._v("#")]),a._v(" BTCPay Server をセットアップする")]),a._v(" "),t("p",[a._v("GitHub から BTCPay Server をダウンロードします。")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ensure we are in root home")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" fail2ban "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v(" clone https://github.com/btcpayserver/btcpayserver-docker\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" btcpayserver-docker\n")])])]),t("p",[a._v("いくつかの "),t("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker#environment-variables",target:"_blank",rel:"noopener noreferrer"}},[a._v("environment variables"),t("OutboundLink")],1),a._v(" を設定して BTCPay を構成します。")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("BTCPAY_HOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"btcpay.local"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("REVERSEPROXY_DEFAULT_HOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$BTCPAY_HOST")]),a._v('"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("NBITCOIN_NETWORK")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"mainnet"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("BTCPAYGEN_CRYPTO1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"btc"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("BTCPAYGEN_LIGHTNING")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"clightning"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("BTCPAYGEN_REVERSEPROXY")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"nginx"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("BTCPAY_ENABLE_SSH")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true\n")])])]),t("p",[a._v("複数ホスト名を使いたい場合は、任意の "),t("code",[a._v("BTCPAY_ADDITIONAL_HOSTS")]),a._v(" 変数で追加します。")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("BTCPAY_ADDITIONAL_HOSTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"btcpay.YourDomain.com"')]),a._v("\n")])])]),t("p",[a._v("ローカルネットワーク内のみにアクセスを制限したい場合は、"),t("code",[a._v(".local")]),a._v(" ドメインを使う必要がある点に注意してください。")]),a._v(" "),t("p",[a._v("BTCPay のインストールを実行します。")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v(" ./btcpay-setup.sh "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v("\n")])])]),t("p",[a._v("数分で起動するはずです。Web ブラウザで http://btcpay.local を開いてみてください。正しく設定されていれば BTCPay Server のフロントページが表示されます。")]),a._v(" "),t("p",[a._v("次に、Bitcoin ブロックチェーンの "),t("RouterLink",{attrs:{to:"/FAQ/Synchronization/"}},[a._v("sync and full verify")]),a._v(" が完了するまで1日程度待ちます。進捗は BTCPay Server の Web GUI 下部に表示されるポップアップで確認できます。")],1),a._v(" "),t("h3",{attrs:{id:"fastsync（任意）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#fastsync（任意）"}},[a._v("#")]),a._v(" FastSync（任意）")]),a._v(" "),t("p",[t("RouterLink",{attrs:{to:"/Docker/fastsync/"}},[a._v("FastSync")]),a._v(" が何であり、UTXO セットを自分で検証することがなぜ重要なのかを十分理解するため、必ず注意深く読んでください。")],1),a._v(" "),t("p",[a._v("FastSync を使うと、"),t("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker/blob/master/contrib/FastSync/README.md#what-are-the-downsides-of-fast-sync",target:"_blank",rel:"noopener noreferrer"}},[a._v("malicious UTXO set snapshot"),t("OutboundLink")],1),a._v(" が送られた場合に攻撃リスクにさらされます。\n別の信頼できるノードを持っている場合は、"),t("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker/blob/master/contrib/FastSync/README.md#dont-trust-verify",target:"_blank",rel:"noopener noreferrer"}},[a._v("these instructions"),t("OutboundLink")],1),a._v(" に従って FastSync で取得した UTXO セットの妥当性を確認できます。")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Stop BTCPay Server")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /root/btcpayserver/btcpayserver-docker\n./btcpay-down.sh\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Import FastSync UTXO set")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" contrib/FastSync\n./load-utxo-set.sh\n")])])]),t("p",[a._v("FastSync は高速回線で現在およそ30分かかります。\nFastSync 完了後、次のコマンドで BTCPay Server を再起動します。")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("\n./btcpay-up.sh\n")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);