(window.webpackJsonp=window.webpackJsonp||[]).push([[152],{971:function(e,t,r){"use strict";r.r(t);var a=r(17),s=Object(a.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"electrum-personal-server-eps-統合"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#electrum-personal-server-eps-統合"}},[e._v("#")]),e._v(" Electrum Personal Server (EPS) 統合")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/chris-belcher/electrum-personal-server",target:"_blank",rel:"noopener noreferrer"}},[e._v("Electrum Personal Server (EPS)"),t("OutboundLink")],1),e._v(" は、"),t("RouterLink",{attrs:{to:"/ElectrumX/"}},[e._v("ElectrumX")]),e._v(" のような公開 Electrum サーバーの個人向けバージョンです。")],1),e._v(" "),t("p",[t("strong",[e._v("EPS は BTCPay Server に統合できます")]),e._v("。任意の docker フラグメント "),t("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker/blob/master/docker-compose-generator/docker-fragments/opt-add-electrum-ps.yml",target:"_blank",rel:"noopener noreferrer"}},[e._v("opt-add-electrum-ps.yml"),t("OutboundLink")],1),e._v(" を使います。Electrum Wallet 利用時に、自分のトランザクションをプライベートに検証するため、自分のフルノード（BTCPay Server に同梱）を使いたい場合に EPS を利用してください。")]),e._v(" "),t("p",[e._v("公開 Electrum サーバー（例: ElectrumX）との最大の違いは、"),t("strong",[e._v("EPS が自分のウォレットのみを監視するためのもの")]),e._v('である点です。機能させるには、Electrum で使うウォレットの "XPUB"（拡張公開鍵）を EPS に共有する必要があります。これ以外は、エンドユーザー視点では ElectrumX などと同様に動作します。'),t("strong",[e._v("BTCPay への統合は簡単")]),e._v("なので、以下の手順に従ってください。")]),e._v(" "),t("p",[e._v("EPS は "),t("code",[e._v("txindex")]),e._v(" を必要とせず、プルーニングノードでも動作します。")]),e._v(" "),t("h2",{attrs:{id:"tor-サポートについて"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tor-サポートについて"}},[e._v("#")]),e._v(" Tor サポートについて")]),e._v(" "),t("p",[e._v("デフォルトでは、EPS は Tor 経由でアクセス可能です。サーバーに SSH で接続し、次のコマンドで Tor アドレスを取得できます。")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("cat")]),e._v(" /var/lib/docker/volumes/generated_tor_servicesdir/_data/btc-electrum-ps/hostname\n")])])]),t("p",[e._v("BTCPay Server > Server Settings > Services から "),t("code",[e._v("Other TOR hidden services")]),e._v(" の Tor リンクを確認することもできます。")]),e._v(" "),t("p",[e._v("Electrum Wallet を使うマシン側で Tor 経由接続する場合、このチュートリアルでは Tor Browser をローカル実行している前提のため、SOCKS5 ポート "),t("code",[e._v("9150")]),e._v(" を使います。コマンドライン経由で Tor を動かしている場合、ローカル SOCKS5 ポートは "),t("code",[e._v("9050")]),e._v(" です。")]),e._v(" "),t("h2",{attrs:{id:"btcpay-で-electrum-personal-server-eps-を有効化する方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#btcpay-で-electrum-personal-server-eps-を有効化する方法"}},[e._v("#")]),e._v(" BTCPay で Electrum Personal Server (EPS) を有効化する方法:")]),e._v(" "),t("ol",[t("li",[t("p",[t("strong",[e._v("Tor を使わない場合")]),e._v("、EPS は TCP ポート 50002 で Electrum Wallet からアクセスできます。少なくとも自分のネットワーク内で Electrum Wallet を動かす PC や Android デバイスから到達できるようこのポートを開放し、ポートフォワーディングを設定する必要があります。Tor を使うならこの手順は不要です。")])]),e._v(" "),t("li",[t("p",[e._v('EPS は単一ウォレット（単一ユーザー）向けなので、EPS の docker-fragment を有効にする前に、ウォレットの XPUB/YPUB/ZPUB を環境変数として指定する必要があります。Electrum Wallet で "Wallet" メニューから "Information" を開き、値をコピーしてください。次の手順でウォレット XPUB の ENV 変数を設定し、BTCPay ノードで Docker Additional Fragment を有効化します。')])])]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("BTCPAYGEN_ADDITIONAL_FRAGMENTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$BTCPAYGEN_ADDITIONAL_FRAGMENTS")]),e._v(';opt-add-electrum-ps"')]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("EPS_XPUB")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"XPUB_ADD_YOUR_XPUB_YPUB_OR_ZPUB_HERE"')]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v(" btcpay-setup.sh "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-i")]),e._v("\n")])])]),t("ol",{attrs:{start:"3"}},[t("li",[e._v("Bitcoin フルノードと EPS サーバーの同期完了まで待ちます。\nBitcoin Core の同期状態は、BTCPay Server のドメインを開くとトップページで確認できます。あるいはコマンドラインでも確認できます。\n"),t("code",[e._v("docker logs btcpayserver_bitcoind")]),e._v(" - Bitcoin Core のブロックチェーン同期状態（およびノードの全情報、エラー含む）を表示します。\n"),t("code",[e._v("docker logs generated_electrum_ps_1")]),e._v(" - EPS の同期状態を表示します。注意: EPS は Bitcoin フルノードの同期完了後まで同期を開始しません。完了まで表示されるエラーは無視して構いません。")])]),e._v(" "),t("p",[e._v("Bitcoin と EPS の同期が両方完了したら、次の手順に進めます。（注意: 同期未完了の EPS サーバーには Electrum Wallet は接続できません）")]),e._v(" "),t("h2",{attrs:{id:"electrum-wallet-を-eps-に接続する方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#electrum-wallet-を-eps-に接続する方法"}},[e._v("#")]),e._v(" Electrum Wallet を EPS に接続する方法")]),e._v(" "),t("p",[e._v("Electrum Wallet からサーバーを利用する方法は3つあります。")]),e._v(" "),t("ol",[t("li",[e._v("設定ファイルを編集する")]),e._v(" "),t("li",[e._v("コマンドラインで Electrum を起動する")]),e._v(" "),t("li",[e._v("ユーザーインターフェース経由で設定する（非推奨、プライバシー面で不利）")])]),e._v(" "),t("h4",{attrs:{id:"option-1-electrum-wallet-の設定ファイルを直接編集して-eps-サーバーに接続する（gui-を開く前・完全なプライバシーのため推奨）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#option-1-electrum-wallet-の設定ファイルを直接編集して-eps-サーバーに接続する（gui-を開く前・完全なプライバシーのため推奨）"}},[e._v("#")]),e._v(" Option 1: Electrum Wallet の設定ファイルを直接編集して EPS サーバーに接続する（GUI を開く前・完全なプライバシーのため推奨）")]),e._v(" "),t("p",[e._v("設定ファイルを編集して "),t("strong",[e._v("Electrum サーバーを設定")]),e._v("できます。")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://electrum.readthedocs.io/en/latest/faq.html#where-is-my-wallet-file-located",target:"_blank",rel:"noopener noreferrer"}},[e._v("Electrum Wallet folder"),t("OutboundLink")],1),e._v(" で "),t("code",[e._v("config")]),e._v(" ファイルを開き、次のように編集します。")]),e._v(" "),t("ol",[t("li",[t("p",[t("code",[e._v('"auto_connect": true,')]),e._v(" を "),t("code",[e._v('"auto_connect": false,')]),e._v(" に変更します。これにより、Electrum Wallet 起動時に他のサードパーティ Electrum サーバーへ自動接続してブロックヘッダーやトランザクション情報を取得する動作を防げます。")])]),e._v(" "),t("li",[t("p",[t("code",[e._v('"oneserver": false,')]),e._v(" を "),t("code",[e._v('"oneserver": true,')]),e._v(" に変更します。これにより、すべてのデータを1台のサーバーから取得するようになります。")])]),e._v(" "),t("li",[t("p",[t("code",[e._v('"server": "yourserver:50002:s",')]),e._v(" を見つけるか追加し、自分の EPS サーバー IP アドレスに変更します。上の例なら "),t("code",[e._v('"server": "192.168.1.3:50002:s",')]),e._v(" です。Wallet 起動時のデフォルト接続先として自分の IP を固定します。")])])]),e._v(" "),t("p",[e._v("これら3手順は、Electrum Wallet を自分のプライベートサーバー1台にのみ接続固定することで完全なプライバシーを実現するため、強く推奨されます（"),t("a",{attrs:{href:"https://github.com/chris-belcher/electrum-personal-server#how-to",target:"_blank",rel:"noopener noreferrer"}},[e._v("Reference"),t("OutboundLink")],1),e._v("）。")]),e._v(" "),t("ol",{attrs:{start:"4"}},[t("li",[e._v("（"),t("strong",[e._v("Tor を使う場合")]),e._v("）Tor Browser を実行しているなら、設定ファイルに "),t("code",[e._v('"proxy": "socks5:127.0.0.1:9150::",')]),e._v(" を追加して SOCKS5 プロキシとして使用できます。")])]),e._v(" "),t("h4",{attrs:{id:"option-3-コマンドラインで-eps-サーバーに接続する"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#option-3-コマンドラインで-eps-サーバーに接続する"}},[e._v("#")]),e._v(" Option 3: コマンドラインで EPS サーバーに接続する")]),e._v(" "),t("p",[e._v("コマンドラインで "),t("code",[e._v("electrum --oneserver --server yourserver:50002:s")]),e._v(" を実行して Electrum を起動できます。")]),e._v(" "),t("p",[e._v("Tor を使う場合は "),t("code",[e._v("-p socks5:localhost:9150")]),e._v(" を追加します。")]),e._v(" "),t("h4",{attrs:{id:"option-4-electrum-wallet-gui-から-eps-サーバーに接続する（オンライン時に一時的に他の公開-electrum-サーバーへ接続するため非推奨）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#option-4-electrum-wallet-gui-から-eps-サーバーに接続する（オンライン時に一時的に他の公開-electrum-サーバーへ接続するため非推奨）"}},[e._v("#")]),e._v(" Option 4: Electrum Wallet GUI から EPS サーバーに接続する（オンライン時に一時的に他の公開 Electrum サーバーへ接続するため非推奨）")]),e._v(" "),t("ol",[t("li",[e._v("Electrum Wallet を開きます。画面下部の信号アイコン（緑または赤）をクリックすると、Wallet が接続可能な Electrum サーバー一覧の画面が表示されます。通常は "),t("code",[e._v("Select Server Automatically")]),e._v(" がすでにチェックされています。")])]),e._v(" "),t("figure",[t("img",{attrs:{src:"https://user-images.githubusercontent.com/1388507/68437521-8a5eb580-01c1-11ea-9ece-0666353a6742.png",alt:"ElectrumWalletServerList",title:"ElectrumWalletServerList"}})]),e._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[e._v("ここで "),t("code",[e._v("Select Server Automatically")]),e._v(" のチェックを外し、EPS サーバーの IP アドレス・ドメイン・ホスト名を入力できるようにします。以下の例ではローカルネットワークの "),t("code",[e._v("192.168.1.3")]),e._v(" を入力しています（ポートは 50002 のまま）。“close” を押します。")])]),e._v(" "),t("figure",[t("img",{attrs:{src:"https://user-images.githubusercontent.com/1388507/68496320-4e276580-0252-11ea-8caf-facc8a246d70.png",alt:"EnterElectrumServerIP",title:"EnterElectrumServerIP"}})]),e._v(" "),t("ol",{attrs:{start:"4"}},[t("li",[t("p",[e._v("（"),t("strong",[e._v("Tor を使う場合")]),e._v("）proxy に移動し、"),t("code",[e._v("Use Tor Proxy at port 9150")]),e._v(" をクリックします。")])]),e._v(" "),t("li",[t("p",[e._v("ここまでが正しく完了し、ノードが健全で同期済みなら、Wallet 画面右下の信号アイコンが緑になります。これで成功です。")])])]),e._v(" "),t("h3",{attrs:{id:"達成できたことの振り返り"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#達成できたことの振り返り"}},[e._v("#")]),e._v(" 達成できたことの振り返り:")]),e._v(" "),t("p",[e._v("これで、あなた自身の"),t("strong",[e._v("プライベート EPS サーバー")]),e._v("を運用できています。Electrum Wallet 関連データは、他のサードパーティサーバーを経由せず、EPS サーバーと Bitcoin ブロックチェーンの間で直接やり取りされます。少なくともブロックチェーンクエリ、トランザクション、支払い/受け取りアドレスの観点では、完全な Bitcoin 取引プライバシーを達成できます（あなたとブロックチェーン以外に行動を把握できません）。")]),e._v(" "),t("h3",{attrs:{id:"トラブルシューティング"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#トラブルシューティング"}},[e._v("#")]),e._v(" トラブルシューティング:")]),e._v(" "),t("p",[e._v("正しく設定しても、上記手順で赤い信号（どのサーバーにも未接続）が出る場合があります。追加のトラブルシュート情報は、このドキュメントに直接 PR で追加することをおすすめします。")]),e._v(" "),t("ul",[t("li",[e._v("赤い信号が表示されたら、Electrum Wallet を完全終了します。その後 Electrum Wallet folder を開いてください（場所が不明な場合は "),t("a",{attrs:{href:"https://electrum.readthedocs.io/en/latest/faq.html#where-is-my-wallet-file-located",target:"_blank",rel:"noopener noreferrer"}},[e._v("see here"),t("OutboundLink")],1),e._v("）。")])]),e._v(" "),t("p",[e._v("Electrum Wallet folder 内（以下の例は Mac）で "),t("code",[e._v("certs")]),e._v(" ディレクトリを見つけ、接続先サーバーの証明書（この例では "),t("code",[e._v("192.168.1.3")]),e._v("）をゴミ箱へ移動して削除します。")]),e._v(" "),t("figure",[t("img",{attrs:{src:"https://user-images.githubusercontent.com/1388507/68497330-9a73a500-0254-11ea-9349-71bdb3bd9511.png",alt:"Certs",title:"Certs"}})]),e._v(" "),t("p",[e._v("Electrum Wallet を再起動し、"),t("strong",[e._v("EPS server")]),e._v(" に接続します。同期が完了していれば、信号アイコンは緑になり、利用可能な状態になります。")])])}),[],!1,null,null,null);t.default=s.exports}}]);