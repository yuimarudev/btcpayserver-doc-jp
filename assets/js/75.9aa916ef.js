(window.webpackJsonp=window.webpackJsonp||[]).push([[75],{451:function(a,s,t){a.exports=t.p+"assets/img/rpi-imager.9299bfff.png"},452:function(a,s,t){a.exports=t.p+"assets/img/rpi-imager-advanced-settings.8bdd9c34.png"},944:function(a,s,t){"use strict";t.r(s);var r=t(17),e=Object(r.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"raspberry-pi-デプロイ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#raspberry-pi-デプロイ"}},[a._v("#")]),a._v(" Raspberry Pi デプロイ")]),a._v(" "),s("p",[a._v("このドキュメントでは、"),s("strong",[a._v("Raspberry Pi 4 で BTCPay Server を実行する方法")]),a._v("をステップごとに案内します。")]),a._v(" "),s("p",[a._v("現在入手できる低価格のシングルボードコンピューターの中では、"),s("strong",[a._v("Raspberry Pi 4")]),a._v(" が最も優れています。\n以下で説明するパーツをそろえれば、約150ドルで "),s("strong",[a._v("Raspberry Pi 4 を使って自宅で BTCPay Server を運用")]),a._v("できます。")]),a._v(" "),s("p",[a._v("すでに次の仕様の Raspberry Pi 4 をお持ちですか？")]),a._v(" "),s("ul",[s("li",[a._v("4GB メモリ")]),a._v(" "),s("li",[a._v("1TB USB 3.0 SSD")]),a._v(" "),s("li",[a._v("16GB 以上の SD カード")])]),a._v(" "),s("p",[a._v("お持ちであれば、すぐに "),s("a",{attrs:{href:"#quickstart"}},[a._v("quickstart instructions")]),a._v(" に進めます。\nそうでなければ、必要なものは次のとおりです…")]),a._v(" "),s("h2",{attrs:{id:"必要なハードウェア"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#必要なハードウェア"}},[a._v("#")]),a._v(" 必要なハードウェア")]),a._v(" "),s("h3",{attrs:{id:"raspberry-pi-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#raspberry-pi-4"}},[a._v("#")]),a._v(" Raspberry Pi 4")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://www.canakit.com/raspberry-pi-4-4gb.html",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[a._v("4GB RAM")]),a._v(" 搭載 Raspberry Pi 4"),s("OutboundLink")],1),a._v(" (~$65)")]),a._v(" "),s("li",[s("a",{attrs:{href:"https://www.amazon.com/dp/B073K14CVB/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Sandisk 16GB SD Card"),s("OutboundLink")],1),a._v(" (~$10)")])]),a._v(" "),s("p",[a._v("RAM が 1GB や 2GB のモデルで妥協しないでください。"),s("strong",[a._v("4GB RAM")]),a._v(" 版は他の版より見つけにくいことがありますが、数ドルの差で "),s("strong",[a._v("4GB RAM")]),a._v(" を選ぶ価値は十分あります。4GB RAM 版の在庫がある販売店を見つけるために、少し時間をかけて探すことを強くおすすめします。まだ持っていない場合は "),s("strong",[a._v("SD カードリーダー")]),a._v(" も必要です。")]),a._v(" "),s("h3",{attrs:{id:"データ保存オプション"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#データ保存オプション"}},[a._v("#")]),a._v(" データ保存オプション")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://www.amazon.com/dp/B0874XN4D8/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Samsung SSD T7 1TB"),s("OutboundLink")],1),a._v(" (~$100)")]),a._v(" "),s("li",[s("a",{attrs:{href:"https://www.amazon.com/dp/B071KGRXRG/",target:"_blank",rel:"noopener noreferrer"}},[a._v("SanDisk Ultra 3D 1TB"),s("OutboundLink")],1),a._v(" (~$100)")])]),a._v(" "),s("p",[a._v("1TB の SSD があれば、Bitcoin ブロックチェーンの完全なコピーを保持できます。\nまた、"),s("RouterLink",{attrs:{to:"/Docker/#how-i-can-prune-my-nodes"}},[a._v("pruning option")]),a._v(" を使えば、Bitcoin ブロックチェーンの完全コピーがなくても BTCPay Server を利用できます。")],1),a._v(" "),s("h3",{attrs:{id:"電源アダプターのオプション"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#電源アダプターのオプション"}},[a._v("#")]),a._v(" 電源アダプターのオプション")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://shop.pimoroni.com/products/raspberry-pi-official-usb-c-power-supply-us?variant=29391144648787",target:"_blank",rel:"noopener noreferrer"}},[a._v("Official Raspberry Pi 4 USB-C Power Adapter 5.1V/3A for US"),s("OutboundLink")],1),a._v(" ($10)")]),a._v(" "),s("li",[s("a",{attrs:{href:"https://shop.pimoroni.com/products/raspberry-pi-official-usb-c-power-supply-eu?variant=29391130624083",target:"_blank",rel:"noopener noreferrer"}},[a._v("Official Raspberry Pi 4 USB-C Power Adapter 5.1V/3A for EU"),s("OutboundLink")],1),a._v(" ($10)")]),a._v(" "),s("li",[s("a",{attrs:{href:"https://shop.pimoroni.com/products/raspberry-pi-official-usb-c-power-supply-au?variant=29391160737875",target:"_blank",rel:"noopener noreferrer"}},[a._v("Official Raspberry Pi 4 USB-C Power Adapter 5.1V/3A for AU"),s("OutboundLink")],1),a._v(" ($10)")])]),a._v(" "),s("p",[a._v("Amazon の安価な無名アダプターに時間を使ったり、家にある既存のアダプターで問題ないと考えたりしないでください。Raspberry Pi 4 は非公式アダプターで問題が出ることがあり、10ドル程度なら、痛い目を見る前に "),s("strong",[a._v("公式アダプターを購入")]),a._v("するほうが確実です。")]),a._v(" "),s("h3",{attrs:{id:"ケースと冷却オプション"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ケースと冷却オプション"}},[a._v("#")]),a._v(" ケースと冷却オプション")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://www.amazon.com/dp/B07WG4DW52/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Flirc Heatsink Case"),s("OutboundLink")],1),a._v(" (~$15)")]),a._v(" "),s("li",[s("a",{attrs:{href:"https://www.amazon.com/dp/B07VQRYTPR/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Passive cooling aluminum case"),s("OutboundLink")],1),a._v(" (~$15)")])]),a._v(" "),s("p",[a._v("もちろんケースの使用は完全に任意ですが、Raspberry Pi を長期的に保護するために推奨します。\n厳密には冷却機構が必須というわけではありませんが、少なくとも受動冷却は "),s("strong",[a._v("あったほうがよい")]),a._v("です。\nRaspberry PI のコア温度が 70°C に達すると、CPU がサーマルスロットリングされます。")]),a._v(" "),s("h2",{attrs:{id:"quickstart"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#quickstart"}},[a._v("#")]),a._v(" Quickstart")]),a._v(" "),s("p",[a._v("最新の "),s("a",{attrs:{href:"https://www.raspberrypi.com/software/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Raspberry Pi Imager"),s("OutboundLink")],1),a._v(" をダウンロードして起動します。")]),a._v(" "),s("figure",[s("img",{attrs:{src:t(451),alt:"Raspberry Pi Imager",title:"Raspberry Pi Imager"}})]),a._v(" "),s("p",[a._v("次のオプションを選択します。")]),a._v(" "),s("ul",[s("li",[a._v("Operating System: Raspberry Pi OS Lite (64-bit)\n"),s("ul",[s("li",[a._v('"Raspberry Pi OS (Other)" から選択')])])]),a._v(" "),s("li",[a._v("Storage: SD カードを選択")])]),a._v(" "),s("p",[a._v("右下のボタンから Advanced Settings を開きます。")]),a._v(" "),s("figure",[s("img",{attrs:{src:t(452),alt:"Raspberry Pi Imager Advanced Settings",title:"Raspberry Pi Imager Advanced Settings"}})]),a._v(" "),s("p",[a._v("Advanced Settings:")]),a._v(" "),s("ul",[s("li",[a._v("ホスト名を設定します。このガイドでは "),s("code",[a._v("btcpay.local")]),a._v(" を想定します。")]),a._v(" "),s("li",[a._v("SSH を有効化")]),a._v(" "),s("li",[a._v("ユーザー名とパスワードを設定します。このガイドではユーザー名を "),s("code",[a._v("btcpay")]),a._v(" と想定します。")])]),a._v(" "),s("p",[a._v("その他の設定は任意です。無線 LAN を設定する必要はありません。")]),a._v(" "),s("p",[a._v('Advanced Settings を閉じて、"Write" ボタンをクリックします。')]),a._v(" "),s("h3",{attrs:{id:"raspberry-pi-のセットアップ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#raspberry-pi-のセットアップ"}},[a._v("#")]),a._v(" Raspberry Pi のセットアップ")]),a._v(" "),s("p",[a._v("イメージの書き込みが SD カードに完了したら、SD カードを取り外して Raspberry Pi に挿入します。\nRaspberry Pi に SSD とネットワークケーブルを接続します。\n最後に電源ケーブルを接続すると、起動プロセスが始まります。\n起動後、DHCP により IP アドレスが割り当てられるはずです。")]),a._v(" "),s("p",[a._v("Raspberry Pi Imager で設定した認証情報で Raspberry Pi にログインします。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ssh")]),a._v(" btcpay@btcpay.local\n")])])]),s("p",[s("code",[a._v("Are you sure you want to continue connecting?")]),a._v(" と聞かれたら "),s("code",[a._v("yes")]),a._v(" を入力します。")]),a._v(" "),s("p",[s("code",[a._v("btcpay.local")]),a._v(" で Raspberry Pi が見つからない場合は、ルーターにログインして IP アドレスを確認する必要があります。\n私の Raspberry Pi では "),s("code",[a._v("192.168.1.5")]),a._v(" が割り当てられました。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ssh")]),a._v(" btcpay@192.168.1.5\n")])])]),s("p",[s("code",[a._v("root")]),a._v(" ユーザーに切り替えます。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("su")]),a._v(" -\n")])])]),s("p",[a._v("その後、Lightning ノードとして "),s("a",{attrs:{href:"https://github.com/lightningnetwork/lnd",target:"_blank",rel:"noopener noreferrer"}},[a._v("LND"),s("OutboundLink")],1),a._v(" か "),s("a",{attrs:{href:"https://github.com/ElementsProject/lightning",target:"_blank",rel:"noopener noreferrer"}},[a._v("Core Lightning"),s("OutboundLink")],1),a._v(" のどちらかを選べます。")]),a._v(" "),s("p",[s("strong",[a._v("必須:")]),a._v(" 次のどちらかを選択してください…")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Core Lightning")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("BTCPAYGEN_LIGHTNING")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"clightning"')]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# LND")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("BTCPAYGEN_LIGHTNING")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"lnd"')]),a._v("\n")])])]),s("p",[s("strong",[a._v("任意:")]),a._v(" "),s("RouterLink",{attrs:{to:"/Docker/#environment-variables"}},[a._v("additional settings")]),a._v(" も設定できます…")],1),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# optional, this is just an example for runing a pruned node on a public domain")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("BTCPAYGEN_ADDITIONAL_FRAGMENTS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"opt-save-storage"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("BTCPAY_ADDITIONAL_HOSTS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"btcpay.YourDomain.com"')]),a._v("\n")])])]),s("p",[a._v("インストールスクリプトをダウンロードして実行します。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-O")]),a._v(" btcpayserver-install.sh https://raw.githubusercontent.com/btcpayserver/btcpayserver-doc/master/scripts/btcpayserver-rpi4-install.sh\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" +x btcpayserver-install.sh\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v(" btcpayserver-install.sh\n")])])]),s("p",[a._v("初期セットアップが完了したら、別のコンピューターのブラウザーで "),s("code",[a._v("btcpay.local")]),a._v(" にアクセスします。")]),a._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),s("p",[a._v("インストールは完了しており、ノードの同期が開始されているはずです。\nBitcoin フルノードの場合、インストール後の初回ブロックダウンロードにはおおよそ 40 時間かかります。")])]),a._v(" "),s("p",[a._v("参考までに、上記のインストールスクリプトが実行している内容の詳細を以下に示します…")]),a._v(" "),s("h2",{attrs:{id:"詳細なステップバイステップ手順"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#詳細なステップバイステップ手順"}},[a._v("#")]),a._v(" 詳細なステップバイステップ手順")]),a._v(" "),s("p",[a._v("以下は "),s("a",{attrs:{href:"#quickstart"}},[a._v("quickstart instructions")]),a._v(" で示した一般的なセットアップの後に行う手順です。")]),a._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("NOTE")]),a._v(" "),s("p",[a._v("以下の手順では "),s("code",[a._v("root")]),a._v(" ユーザーである必要があります。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("su")]),a._v(" -\n")])])])]),a._v(" "),s("h3",{attrs:{id:"os-パッケージを最新化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#os-パッケージを最新化"}},[a._v("#")]),a._v(" OS パッケージを最新化")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" update "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" upgrade "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" autoremove\n")])])]),s("h3",{attrs:{id:"ストレージ設定"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ストレージ設定"}},[a._v("#")]),a._v(" ストレージ設定")]),a._v(" "),s("p",[a._v("SD カードの消耗を防ぐため、swap を無効化することを推奨します。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("dphys-swapfile swapoff\ndphys-swapfile uninstall\nupdate-rc.d dphys-swapfile remove\nsystemctl disable dphys-swapfile\n")])])]),s("p",[a._v("SSD をパーティション分割します。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("fdisk")]),a._v(" /dev/sda\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# type 'p' to list existing partitions")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# type 'd' to delete currently selected partitions")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# type 'n' to create a new partition")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# type 'w' to write the new partition table and exit fdisk")]),a._v("\n")])])]),s("p",[a._v("SSD 上の新しいパーティションをフォーマットします。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mkfs.ext4 /dev/sda1\n")])])]),s("p",[a._v("起動時に SSD パーティションが自動マウントされるよう設定します。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mkfs.ext4 /dev/sda1\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" /mnt/usb\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("UUID")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" blkid "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" UUID "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" value /dev/sda1"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v('"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"UUID='),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$UUID")]),a._v(' /mnt/usb ext4 defaults,noatime,nofail 0 0"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tee")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-a")]),a._v(" /etc/fstab\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mount")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-a")]),a._v("\n")])])]),s("p",[s("code",[a._v("/etc/fstab")]),a._v(" を編集するついでに、ログ用 RAM ファイルシステムを追加できます（任意）。\nこれも SD カードの早期消耗を防ぐためです。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'none /var/log tmpfs size=10M,noatime 0 0'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">>")]),a._v(" /etc/fstab\n")])])]),s("h3",{attrs:{id:"docker-のインストール"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-のインストール"}},[a._v("#")]),a._v(" Docker のインストール")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" apt-transport-https ca-certificates "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" gnupg lsb-release "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-fsSL")]),a._v(" https://download.docker.com/linux/debian/gpg "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" gpg "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dearmor")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" /usr/share/keyrings/docker-archive-keyring.gpg\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"deb [arch='),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("dpkg --print-architecture"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(" signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/debian \\\n  "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("lsb_release "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-cs")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(' stable"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tee")]),a._v(" /etc/apt/sources.list.d/docker.list "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /dev/null\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" update\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" docker-ce docker-ce-cli containerd.io\n")])])]),s("h3",{attrs:{id:"docker-ボリューム用マウントの作成"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-ボリューム用マウントの作成"}},[a._v("#")]),a._v(" Docker ボリューム用マウントの作成")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-rf")]),a._v(" /var/lib/docker\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" /var/lib/docker\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mount")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--bind")]),a._v(" /mnt/usb /var/lib/docker\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/mnt/usb /var/lib/docker none bind,nobootwait 0 2"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">>")]),a._v(" /etc/fstab\nsystemctl restart "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v("\n")])])]),s("h3",{attrs:{id:"ファイアウォール設定"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ファイアウォール設定"}},[a._v("#")]),a._v(" ファイアウォール設定")]),a._v(" "),s("p",[a._v("ファイアウォールをインストールし、SSH、HTTP、HTTPS、Bitcoin、Lightning を許可します。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" ufw\nufw default deny incoming\nufw default allow outgoing\n")])])]),s("p",[a._v("次のコマンドは、内部ネットワークからの SSH 接続のみを許可します。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("ufw allow from "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.0")]),a._v(".0.0/8 to any port "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(" proto tcp\nufw allow from "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("172.16")]),a._v(".0.0/12 to any port "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(" proto tcp\nufw allow from "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".0.0/16 to any port "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(" proto tcp\nufw allow from "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("169.254")]),a._v(".0.0/16 to any port "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(" proto tcp\nufw allow from fc00::/7 to any port "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(" proto tcp\nufw allow from fe80::/10 to any port "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(" proto tcp\nufw allow from ff00::/8 to any port "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(" proto tcp\n")])])]),s("p",[a._v("次のポートはどこからでもアクセス可能にする必要があります（サブネットを指定しない場合、既定は "),s("code",[a._v("any")]),a._v(" です）。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("ufw allow "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v("/tcp\nufw allow "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("443")]),a._v("/tcp\nufw allow "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8333")]),a._v("/tcp\nufw allow "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("9735")]),a._v("/tcp\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Enable the firewall")]),a._v("\nufw "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("enable")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Verify the configuration")]),a._v("\nufw status\n")])])]),s("h3",{attrs:{id:"btcpay-server-のセットアップ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#btcpay-server-のセットアップ"}},[a._v("#")]),a._v(" BTCPay Server のセットアップ")]),a._v(" "),s("p",[a._v("GitHub から BTCPay Server をダウンロードします。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ensure we are in root home")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" fail2ban "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v(" clone https://github.com/btcpayserver/btcpayserver-docker\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" btcpayserver-docker\n")])])]),s("p",[a._v("いくつかの "),s("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker#environment-variables",target:"_blank",rel:"noopener noreferrer"}},[a._v("environment variables"),s("OutboundLink")],1),a._v(" を設定して BTCPay を構成します。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("BTCPAY_HOST")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"btcpay.local"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("REVERSEPROXY_DEFAULT_HOST")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$BTCPAY_HOST")]),a._v('"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("NBITCOIN_NETWORK")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"mainnet"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("BTCPAYGEN_CRYPTO1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"btc"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("BTCPAYGEN_LIGHTNING")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"clightning"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("BTCPAYGEN_REVERSEPROXY")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"nginx"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("BTCPAYGEN_ADDITIONAL_FRAGMENTS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"opt-more-memory"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("BTCPAY_ENABLE_SSH")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true\n")])])]),s("p",[a._v("複数のホスト名を使いたい場合は、任意の "),s("code",[a._v("BTCPAY_ADDITIONAL_HOSTS")]),a._v(" 変数で追加します。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("BTCPAY_ADDITIONAL_HOSTS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"btcpay.YourDomain.com"')]),a._v("\n")])])]),s("p",[a._v("ローカルネットワークのみにアクセスを制限したい場合は、"),s("code",[a._v(".local")]),a._v(" ドメインを使う必要がある点に注意してください。")]),a._v(" "),s("p",[a._v("BTCPay のインストールを実行します。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v(" ./btcpay-setup.sh "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v("\n")])])]),s("p",[a._v("数分以内に起動するはずです。ブラウザーで http://btcpay.local を開いてみてください。すべて正しく設定されていれば、BTCPay Server のトップページが表示されます。")]),a._v(" "),s("p",[a._v("あとは Bitcoin ブロックチェーンが "),s("RouterLink",{attrs:{to:"/FAQ/Synchronization/"}},[a._v("sync and full verify")]),a._v(" されるまで、1日程度待つだけです。BTCPay Server の Web GUI 下部に進捗確認用のポップアップが表示されます。")],1),a._v(" "),s("h3",{attrs:{id:"fastsync（任意）"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fastsync（任意）"}},[a._v("#")]),a._v(" FastSync（任意）")]),a._v(" "),s("p",[s("RouterLink",{attrs:{to:"/Docker/fastsync/"}},[a._v("FastSync")]),a._v(" が何か、また UTXO セットを自分で検証することがなぜ重要かを、注意深く読んで理解してください。")],1),a._v(" "),s("p",[a._v("FastSync を利用すると、"),s("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker/blob/master/contrib/FastSync/README.md#what-are-the-downsides-of-fast-sync",target:"_blank",rel:"noopener noreferrer"}},[a._v("悪意ある UTXO set snapshot"),s("OutboundLink")],1),a._v(" を受け取った場合に攻撃へさらされます。\n別の場所に信頼できるノードがある場合は、"),s("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker/blob/master/contrib/FastSync/README.md#dont-trust-verify",target:"_blank",rel:"noopener noreferrer"}},[a._v("these instructions"),s("OutboundLink")],1),a._v(" に従って FastSync で取得した UTXO セットの妥当性を確認できます。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Stop BTCPay Server")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /root/btcpayserver/btcpayserver-docker\n./btcpay-down.sh\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Import FastSync UTXO set")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" contrib/FastSync\n./load-utxo-set.sh\n")])])]),s("p",[a._v("FastSync は高速回線で現在およそ 30 分かかります。\nFastSync 完了後、次のコマンドで BTCPay Server を再起動します。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("\n./btcpay-up.sh\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);