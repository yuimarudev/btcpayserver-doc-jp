(window.webpackJsonp=window.webpackJsonp||[]).push([[132],{942:function(e,r,t){"use strict";t.r(r);var o=t(17),a=Object(o.a)({},(function(){var e=this,r=e._self._c;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"altcoin-の追加方法"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#altcoin-の追加方法"}},[e._v("#")]),e._v(" Altcoin の追加方法")]),e._v(" "),r("p",[e._v("BTCPay Server プロジェクトとそのコア開発者は Bitcoin のみに注力しています。ただし、任意で有効化できる altcoin 統合がいくつか存在します。詳細は "),r("RouterLink",{attrs:{to:"/FAQ/Altcoin/"}},[e._v("Altcoin FAQ page")]),e._v(" を確認してください。")],1),e._v(" "),r("h2",{attrs:{id:"概要"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#概要"}},[e._v("#")]),e._v(" 概要")]),e._v(" "),r("p",[e._v("Altcoin 統合には次の2点が必要です。")]),e._v(" "),r("ol",[r("li",[r("strong",[e._v("BTCPay Server plugin")]),e._v(" - 決済ロジック、ウォレット管理、UI を担当")]),e._v(" "),r("li",[r("strong",[e._v("Docker Compose fragment")]),e._v(" - 他のユーザーが BTCPay Server と並行して対象コインのノード基盤を実行できるようにする")])]),e._v(" "),r("p",[e._v("BTCPay Server のコアを変更してはいけません。新しいコインはすべてプラグインとして統合する必要があります。")]),e._v(" "),r("h2",{attrs:{id:"btcpay-server-プラグインを作成する"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#btcpay-server-プラグインを作成する"}},[e._v("#")]),e._v(" BTCPay Server プラグインを作成する")]),e._v(" "),r("p",[r("code",[e._v("BaseBTCPayServerPlugin")]),e._v(" を拡張するプラグインを作成します。プラグインでは、コインのネットワーク、支払いハンドラ、UI 拡張を BTCPay Server に登録します。")]),e._v(" "),r("p",[e._v("参考として "),r("a",{attrs:{href:"https://github.com/btcpay-monero/btcpayserver-monero-plugin",target:"_blank",rel:"noopener noreferrer"}},[e._v("Monero plugin"),r("OutboundLink")],1),e._v(" を使用してください。確認すべき主要ファイルは次のとおりです。")]),e._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://github.com/btcpay-monero/btcpayserver-monero-plugin/blob/master/Plugins/Monero/MoneroPlugin.cs",target:"_blank",rel:"noopener noreferrer"}},[e._v("MoneroPlugin.cs"),r("OutboundLink")],1),e._v(" - プラグインのエントリポイントとサービス登録")]),e._v(" "),r("li",[r("a",{attrs:{href:"https://github.com/btcpay-monero/btcpayserver-monero-plugin/tree/master/Plugins/Monero/Payments",target:"_blank",rel:"noopener noreferrer"}},[e._v("MoneroLikePaymentMethodHandler.cs"),r("OutboundLink")],1),e._v(" - 支払い処理")]),e._v(" "),r("li",[r("a",{attrs:{href:"https://github.com/btcpay-monero/btcpayserver-monero-plugin/tree/master/Plugins/Monero/Services",target:"_blank",rel:"noopener noreferrer"}},[e._v("MoneroListener.cs"),r("OutboundLink")],1),e._v(" - トランザクションとブロックの監視")]),e._v(" "),r("li",[r("a",{attrs:{href:"https://github.com/btcpay-monero/btcpayserver-monero-plugin/tree/master/Plugins/Monero/Services",target:"_blank",rel:"noopener noreferrer"}},[e._v("MoneroLoadUpService.cs"),r("OutboundLink")],1),e._v(" - RPC 経由でのウォレット作成と読み込み")])]),e._v(" "),r("p",[e._v("一般的なプラグイン開発手順（プロジェクト設定、UI 拡張、データベース、公開方法）については "),r("RouterLink",{attrs:{to:"/Development/Plugins/"}},[e._v("Plugin Development docs")]),e._v(" を参照してください。")],1),e._v(" "),r("h2",{attrs:{id:"docker-compose-fragment-を作成する"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-fragment-を作成する"}},[e._v("#")]),e._v(" Docker Compose Fragment を作成する")]),e._v(" "),r("p",[e._v("ユーザーが BTCPay Server と一緒に対象コインのノードをデプロイできるようにするには、次の構成要素を含む PR を "),r("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker",target:"_blank",rel:"noopener noreferrer"}},[e._v("btcpayserver-docker"),r("OutboundLink")],1),e._v(" リポジトリへ提出してください。完全な例は "),r("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker/pull/1042",target:"_blank",rel:"noopener noreferrer"}},[e._v("Beldex PR #1042"),r("OutboundLink")],1),e._v(" を参照してください。")]),e._v(" "),r("h3",{attrs:{id:"docker-image"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#docker-image"}},[e._v("#")]),e._v(" Docker image")]),e._v(" "),r("p",[e._v("対象コインの daemon と wallet RPC 用の Docker イメージをビルドして公開します。公開先は自身の Docker Hub またはコンテナレジストリにし、BTCPay のイメージビルドパイプラインへは追加しないでください。")]),e._v(" "),r("h3",{attrs:{id:"docker-compose-fragment"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-fragment"}},[e._v("#")]),e._v(" Docker Compose fragment")]),e._v(" "),r("p",[r("code",[e._v("docker-compose-generator/docker-fragments/")]),e._v(" に YAML ファイルを追加し、対象コインの daemon と wallet RPC サービスを定義します。プラグインが接続できるよう、この fragment で RPC URI を環境変数経由で BTCPay Server に渡す必要があります。")]),e._v(" "),r("p",[e._v("例: "),r("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker/blob/master/docker-compose-generator/docker-fragments/monero.yml",target:"_blank",rel:"noopener noreferrer"}},[e._v("monero.yml"),r("OutboundLink")],1)]),e._v(" "),r("h3",{attrs:{id:"crypto-definitionsjson"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#crypto-definitionsjson"}},[e._v("#")]),e._v(" crypto-definitions.json")]),e._v(" "),r("p",[e._v("docker-compose generator に取り込まれるよう、"),r("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker/blob/master/docker-compose-generator/crypto-definitions.json",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("docker-compose-generator/crypto-definitions.json")]),r("OutboundLink")],1),e._v(" に対象コインのエントリを追加します。")]),e._v(" "),r("h3",{attrs:{id:"任意の追加要素"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#任意の追加要素"}},[e._v("#")]),e._v(" 任意の追加要素")]),e._v(" "),r("p",[e._v("必要に応じて次も追加できます。")]),e._v(" "),r("ul",[r("li",[r("strong",[e._v("Expose fragment")]),e._v("（例: "),r("code",[e._v("opt-yourcoin-expose.yml")]),e._v("）- デバッグ用に localhost で RPC ポートを公開")]),e._v(" "),r("li",[r("strong",[e._v("Wallet CLI scripts")]),e._v("（例: "),r("code",[e._v("yourcoin-wallet-cli.sh")]),e._v("）- コンテナ内の wallet CLI へアクセスするための補助ラッパー")]),e._v(" "),r("li",[r("strong",[e._v("Backup script changes")]),e._v(" - "),r("code",[e._v("btcpay-backup.sh")]),e._v(" に対象コインのボリュームを追加")])]),e._v(" "),r("h2",{attrs:{id:"公開と掲載"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#公開と掲載"}},[e._v("#")]),e._v(" 公開と掲載")]),e._v(" "),r("p",[e._v("統合の準備ができたら、次を実施します。")]),e._v(" "),r("ol",[r("li",[e._v("テストユーザーが BTCPay Server UI からインストールできるよう、"),r("a",{attrs:{href:"https://plugin-builder.btcpayserver.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("BTCPay Plugin Builder"),r("OutboundLink")],1),e._v(" に "),r("strong",[e._v("プラグインを公開")]),e._v(" します（ユーザーは、あなたがプラグインを開発した BTCPay Server リポジトリの fork を実行している必要があります）。")]),e._v(" "),r("li",[e._v("ユーザーが対象コインのノードをデプロイできるよう、"),r("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker",target:"_blank",rel:"noopener noreferrer"}},[e._v("btcpayserver-docker"),r("OutboundLink")],1),e._v(" への "),r("strong",[e._v("Docker PR をマージ")]),e._v(" してもらいます。")]),e._v(" "),r("li",[e._v("前ステップの Docker PR がマージされた後にのみ、BTCPay Plugin Builder への "),r("strong",[e._v("掲載申請")]),e._v(" を行います。")])]),e._v(" "),r("h2",{attrs:{id:"faq"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#faq"}},[e._v("#")]),e._v(" FAQ")]),e._v(" "),r("h3",{attrs:{id:"ローカルでプラグインをテストするには？"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#ローカルでプラグインをテストするには？"}},[e._v("#")]),e._v(" ローカルでプラグインをテストするには？")]),e._v(" "),r("p",[e._v("プラグインのリポジトリには、対象コインの daemon（regtest モード）、wallet RPC、BTCPay の基本依存関係（bitcoind、nbxplorer、postgres）を起動する専用の "),r("code",[e._v("docker-compose.yml")]),e._v(" を含めるべきです。そのうえで、"),r("code",[e._v("DEBUG_PLUGINS")]),e._v(" 経由でプラグインを読み込んだ状態で、IDE から BTCPay Server を実行します。")]),e._v(" "),r("p",[e._v("完全なワークフローは "),r("a",{attrs:{href:"https://github.com/btcpay-monero/btcpayserver-monero-plugin/blob/master/BTCPayServer.Plugins.IntegrationTests/docker-compose.yml",target:"_blank",rel:"noopener noreferrer"}},[e._v("Monero plugin's docker-compose.yml"),r("OutboundLink")],1),e._v(" と "),r("a",{attrs:{href:"https://github.com/btcpay-monero/btcpayserver-monero-plugin#local-development-setup",target:"_blank",rel:"noopener noreferrer"}},[e._v("Local Development Setup"),r("OutboundLink")],1),e._v(" を参照してください。")]),e._v(" "),r("h3",{attrs:{id:"本番向けに-docker-fragment-をテストするには？"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#本番向けに-docker-fragment-をテストするには？"}},[e._v("#")]),e._v(" 本番向けに Docker fragment をテストするには？")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://dotnet.microsoft.com/en-us/download/dotnet/8.0",target:"_blank",rel:"noopener noreferrer"}},[e._v(".NET 8.0 SDK"),r("OutboundLink")],1),e._v(" をインストールして次を実行します。")]),e._v(" "),r("div",{staticClass:"language-bash extra-class"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[r("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("BTCPAYGEN_CRYPTO1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[e._v("'YOUR-COIN'")]),e._v("\n"),r("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("BTCPAYGEN_SUBNAME")]),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[e._v("'test'")]),e._v("\n"),r("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" docker-compose-generator/src\ndotnet run\n")])])]),r("p",[e._v("これで "),r("code",[e._v("Generated")]),e._v(" フォルダに docker-compose が生成されます。fragment が正しく含まれていることを確認してください。")]),e._v(" "),r("h2",{attrs:{id:"メンテナンス"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#メンテナンス"}},[e._v("#")]),e._v(" メンテナンス")]),e._v(" "),r("p",[e._v("BTCPay 開発者は、依頼ベースで代替コインの実装は行いません。新しいコインの追加は、そのコインのコミュニティと開発者に完全に依存します。BTCPay 開発者は altcoin のテストや保守に多くの工数を割きません。PR を提出する場合は、統合が正しく動作することを必ず確認してください。アクティブに保守されない場合は削除されます。")])])}),[],!1,null,null,null);r.default=a.exports}}]);