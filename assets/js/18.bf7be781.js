(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{1047:function(e,t,a){"use strict";a.r(t);var r=a(17),s=Object(r.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("p",[t("span",{attrs:{id:"41-global-settings"}}),e._v(" "),t("span",{attrs:{id:"btcpay-order-statuses"}})]),e._v(" "),t("h1",{attrs:{id:"woocommerce-連携"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#woocommerce-連携"}},[e._v("#")]),e._v(" WooCommerce 連携")]),e._v(" "),t("p",[e._v("このドキュメントでは、"),t("strong",[e._v("WooCommerce ストアに BTCPay Server を統合する方法")]),e._v("を説明します。\nまだストアがない場合は、"),t("a",{attrs:{href:"https://web.archive.org/web/20221003083329/https://bitcoinshirt.co/how-to-create-store-accept-bitcoin/5/",target:"_blank",rel:"noopener noreferrer"}},[e._v("このステップバイステップの記事"),t("OutboundLink")],1),e._v("を参考に、ゼロから作成してください。")]),e._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[e._v("注記")]),e._v(" "),t("p",[e._v("このガイドは BTCPay for WooCommerce V2 プラグインを対象としています。現在メンテナンスされていない旧プラグイン（BitPay API ベース）の手順は"),t("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-doc/blob/cba96292ceea9483711ab53c479a98357383f857/docs/WooCommerce.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("こちら"),t("OutboundLink")],1),e._v("で確認できます。")])]),e._v(" "),t("p"),t("div",{staticClass:"table-of-contents"},[t("ul",[t("li",[t("a",{attrs:{href:"#要件"}},[e._v("要件")])]),t("li",[t("a",{attrs:{href:"#1-btcpay-プラグインのインストール"}},[e._v("1. BTCPay プラグインのインストール")]),t("ul",[t("li",[t("a",{attrs:{href:"#11-wordpress-管理ダッシュボードからプラグインをインストール（推奨）"}},[e._v("1.1 WordPress 管理ダッシュボードからプラグインをインストール（推奨）")])]),t("li",[t("a",{attrs:{href:"#12-github-からプラグインをダウンロードしてインストール"}},[e._v("1.2 GitHub からプラグインをダウンロードしてインストール")])])])]),t("li",[t("a",{attrs:{href:"#2-woocommerce-と-btcpay-server-の接続"}},[e._v("2. WooCommerce と BTCPay Server の接続")]),t("ul",[t("li",[t("a",{attrs:{href:"#21-api-キーウィザードを使って接続（推奨）"}},[e._v("2.1 API キーウィザードを使って接続（推奨）")])]),t("li",[t("a",{attrs:{href:"#22-api-キーと権限を手動作成して接続"}},[e._v("2.2 API キーと権限を手動作成して接続")])])])]),t("li",[t("a",{attrs:{href:"#3-チェックアウトのテスト"}},[e._v("3. チェックアウトのテスト")])]),t("li",[t("a",{attrs:{href:"#4-btcpay-woocommerce-v2-のカスタマイズ"}},[e._v("4. BTCPay WooCommerce V2 のカスタマイズ")]),t("ul",[t("li",[t("a",{attrs:{href:"#41-グローバル設定"}},[e._v("4.1 グローバル設定")])]),t("li",[t("a",{attrs:{href:"#42-決済ゲートウェイ固有設定"}},[e._v("4.2 決済ゲートウェイ固有設定")])])])]),t("li",[t("a",{attrs:{href:"#トラブルシューティング"}},[e._v("トラブルシューティング")]),t("ul",[t("li",[t("a",{attrs:{href:"#エラー-call-to-undefined-function-btcpayserver-http-curl-init"}},[e._v("エラー: Call to undefined function BTCPayServer\\Http\\curl_init()")])]),t("li",[t("a",{attrs:{href:"#請求書が支払い済みなのに注文ステータスが更新されない"}},[e._v("請求書が支払い済みなのに注文ステータスが更新されない")])]),t("li",[t("a",{attrs:{href:"#チェックアウト時にエラーが出るが原因がわからない"}},[e._v("チェックアウト時にエラーが出るが原因がわからない")])]),t("li",[t("a",{attrs:{href:"#プラグイン利用時の問題やその他の質問"}},[e._v("プラグイン利用時の問題やその他の質問")])]),t("li",[t("a",{attrs:{href:"#新しい-api-キーを作成する"}},[e._v("新しい API キーを作成する")])]),t("li",[t("a",{attrs:{href:"#webhook-を触って壊してしまった場合の修復方法"}},[e._v("webhook を触って壊してしまった場合の修復方法")])])])]),t("li",[t("a",{attrs:{href:"#btcpay-server-から-woocommerce-をデプロイ"}},[e._v("BTCPay Server から WooCommerce をデプロイ")])])])]),t("p"),e._v(" "),t("figure",[t("img",{attrs:{src:a(864),alt:"BTCPay - WooCommerce インフォグラフィック",title:"BTCPay - WooCommerce インフォグラフィック"}})]),e._v(" "),t("p",[e._v("既存の WooCommerce ストアに BTCPay Server を統合するには、以下の手順に従うか、次の動画を視聴してください。")]),e._v(" "),t("a",{staticClass:"ytEmbed",staticStyle:{"background-image":"url(https://img.youtube.com/vi/ULcocDKZ1Mw/hqdefault.jpg)"},attrs:{href:"https://www.youtube.com/watch?v=ULcocDKZ1Mw",title:"BTCPay - WooCommerce","data-id":"ULcocDKZ1Mw"}},[t("iframe",{attrs:{title:"BTCPay - WooCommerce","data-src":"https://www.youtube-nocookie.com/embed/ULcocDKZ1Mw?&autoplay=1&autohide=1&modestbranding=1&color=white&rel=0",frameborder:"0",allow:"autoplay;encrypted-media;picture-in-picture",allowfullscreen:""}})]),e._v(" "),t("h2",{attrs:{id:"要件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#要件"}},[e._v("#")]),e._v(" 要件")]),e._v(" "),t("p",[e._v("このプラグインをインストールする前に、以下の要件を満たしていることを確認してください。")]),e._v(" "),t("ul",[t("li",[e._v("PHP バージョン 8.0 以上")]),e._v(" "),t("li",[e._v("cURL、gd、intl、json、mbstring の PHP 拡張が利用可能")]),e._v(" "),t("li",[e._v("WooCommerce サイト（"),t("a",{attrs:{href:"https://woocommerce.com/document/installing-uninstalling-woocommerce/",target:"_blank",rel:"noopener noreferrer"}},[e._v("インストール手順"),t("OutboundLink")],1),e._v(" または "),t("a",{attrs:{href:"#deploying-woocommerce-from-btcpay-server"}},[e._v("BTCPay Server 上で直接デプロイ")]),e._v("）")]),e._v(" "),t("li",[e._v("BTCPay Server バージョン 1.3.0 以上を利用している（"),t("RouterLink",{attrs:{to:"/Deployment/"}},[e._v("セルフホスト")]),e._v(" または "),t("RouterLink",{attrs:{to:"/Deployment/ThirdPartyHosting/"}},[e._v("サードパーティホスト")]),e._v("）")],1),e._v(" "),t("li",[t("RouterLink",{attrs:{to:"/RegisterAccount/"}},[e._v("インスタンスに登録済みアカウントがある")])],1),e._v(" "),t("li",[t("RouterLink",{attrs:{to:"/CreateStore/"}},[e._v("インスタンスに BTCPay ストアがある")])],1),e._v(" "),t("li",[t("RouterLink",{attrs:{to:"/WalletSetup/"}},[e._v("ストアにウォレットが接続されている")])],1)]),e._v(" "),t("h2",{attrs:{id:"1-btcpay-プラグインのインストール"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#1-btcpay-プラグインのインストール"}},[e._v("#")]),e._v(" 1. BTCPay プラグインのインストール")]),e._v(" "),t("p",[t("strong",[e._v("BTCPay for WooCommerce V2 プラグイン")]),e._v("をダウンロードする方法は 3 つあります。")]),e._v(" "),t("ul",[t("li",[e._v("WordPress の管理ダッシュボードから（推奨、以下参照）")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://wordpress.org/plugins/btcpay-greenfield-for-woocommerce/",target:"_blank",rel:"noopener noreferrer"}},[e._v("WordPress Repository"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/btcpayserver/woocommerce-greenfield-plugin/releases",target:"_blank",rel:"noopener noreferrer"}},[e._v("GitHub Repository"),t("OutboundLink")],1)])]),e._v(" "),t("h3",{attrs:{id:"11-wordpress-管理ダッシュボードからプラグインをインストール（推奨）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#11-wordpress-管理ダッシュボードからプラグインをインストール（推奨）"}},[e._v("#")]),e._v(" 1.1 WordPress 管理ダッシュボードからプラグインをインストール（推奨）")]),e._v(" "),t("ol",[t("li",[e._v("WordPress > Plugins > Add New。")]),e._v(" "),t("li",[e._v("検索欄に「BTCPay V2」と入力。")]),e._v(" "),t("li",[e._v("インストールして有効化。")])]),e._v(" "),t("figure",[t("img",{attrs:{src:a(865),alt:"BTCPay WordPress V2: プラグインのインストール",title:"BTCPay WordPress V2: プラグインのインストール"}})]),e._v(" "),t("h3",{attrs:{id:"12-github-からプラグインをダウンロードしてインストール"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#12-github-からプラグインをダウンロードしてインストール"}},[e._v("#")]),e._v(" 1.2 GitHub からプラグインをダウンロードしてインストール")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/btcpayserver/woocommerce-greenfield-plugin/releases",target:"_blank",rel:"noopener noreferrer"}},[e._v("最新の BTCPay プラグインをダウンロード"),t("OutboundLink")],1),e._v("し、"),t("code",[e._v(".zip")]),e._v(" 形式で WordPress サイトにアップロードして有効化します。")]),e._v(" "),t("a",{staticClass:"ytEmbed",staticStyle:{"background-image":"url(https://img.youtube.com/vi/6QcTWHRKZag/hqdefault.jpg)"},attrs:{href:"https://www.youtube.com/watch?v=6QcTWHRKZag",title:"BTCPay Server Woo プラグイン","data-id":"6QcTWHRKZag"}},[t("iframe",{attrs:{title:"BTCPay Server Woo プラグイン","data-src":"https://www.youtube-nocookie.com/embed/6QcTWHRKZag?&autoplay=1&autohide=1&modestbranding=1&color=white&rel=0",frameborder:"0",allow:"autoplay;encrypted-media;picture-in-picture",allowfullscreen:""}})]),e._v(" "),t("h2",{attrs:{id:"2-woocommerce-と-btcpay-server-の接続"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#2-woocommerce-と-btcpay-server-の接続"}},[e._v("#")]),e._v(" 2. WooCommerce と BTCPay Server の接続")]),e._v(" "),t("p",[e._v("BTCPay for WooCommerce V2 プラグインは、"),t("strong",[e._v("BTCPay Server（決済プロセッサ）と e コマースストアをつなぐブリッジ")]),e._v("です。\nセルフホストでもサードパーティホストでも、接続手順は同じです。")]),e._v(" "),t("p",[e._v("通知リンクの「"),t("strong",[e._v("please configure the plugin here")]),e._v("」（以下のスクリーンショット参照）をクリックするか、次の手順で開けます。")]),e._v(" "),t("ul",[t("li",[e._v("ストアのダッシュボードへ移動")]),e._v(" "),t("li",[e._v("WooCommerce > Settings")]),e._v(" "),t("li",[e._v("[BTCPay Settings] タブをクリック")])]),e._v(" "),t("figure",[t("img",{attrs:{src:a(866),alt:"BTCPay WordPress V2: BTCPay Settings へのリンク",title:"BTCPay WordPress V2: BTCPay Settings へのリンク"}})]),e._v(" "),t("p",[t("a",{attrs:{id:"21-connect-using-the-api-key-wizard--recommended-"}})]),e._v(" "),t("h3",{attrs:{id:"21-api-キーウィザードを使って接続（推奨）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#21-api-キーウィザードを使って接続（推奨）"}},[e._v("#")]),e._v(" 2.1 API キーウィザードを使って接続（推奨）")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("「"),t("strong",[e._v("BTCPay Server URL")]),e._v("」欄にホストの完全 URL（https を含む）を入力します。例: https://btcpay.mydomain.com")])]),e._v(" "),t("li",[t("p",[e._v("[Generate API key] ボタンをクリックします（BTCPay Server の「Authorization request」ページにリダイレクトされます）。\n"),t("img",{attrs:{src:a(867),alt:"BTCPay WordPress V2: BTCPay Settings へのリンク",title:"BTCPay WordPress V2: BTCPay Settings へのリンク"}})])]),e._v(" "),t("li",[t("p",[e._v("BTCPay Server インスタンスにログインしていない場合は、ここでログインします（任意）。\n"),t("img",{attrs:{src:a(868),alt:"BTCPay WordPress V2: BTCPay Server へログイン",title:"BTCPay WordPress V2: BTCPay Server へログイン"}})])]),e._v(" "),t("li",[t("p",[e._v("接続したいストアを選択します（ストアが 1 つだけの場合は自動選択されます）。\n"),t("img",{attrs:{src:a(869),alt:"BTCPay WordPress V2: ストアを選択",title:"BTCPay WordPress V2: ストアを選択"}})])]),e._v(" "),t("li",[t("p",[e._v("必要な権限はすでに入力済みなので、[Authorize app] をクリックするだけです。\n"),t("img",{attrs:{src:a(870),alt:"BTCPay WordPress V2: authorize app をクリック",title:"BTCPay WordPress V2: authorize app をクリック"}})])]),e._v(" "),t("li",[t("p",[e._v("WooCommerce ストアに戻ると、API キーと Store ID が自動入力されます。さらに webhook も自動作成されます。「Webhook status」欄に「Webhook setup automatically.」に続いて ID が表示されることを確認してください。\n"),t("img",{attrs:{src:a(871),alt:"BTCPay WordPress V2: プラグイン設定にリダイレクト後",title:"BTCPay WordPress V2: プラグイン設定にリダイレクト後"}})])]),e._v(" "),t("li",[t("p",[e._v("追加設定の前に、すべてが正しく保存されるよう "),t("strong",[e._v("[Save]")]),e._v(" をクリックしてください。\n"),t("img",{attrs:{src:a(872),alt:"BTCPay WordPress V2: Webhook 作成済み",title:"BTCPay WordPress V2: Webhook 作成済み"}})])])]),e._v(" "),t("p",[e._v("これでほぼ完了です。チェックアウトで Bitcoin 決済ゲートウェイを表示するには、サイドバーの「WooCommerce」->「Settings」から「Payments」タブを開き、「BTCPay (default)」決済ゲートウェイを有効化してください。")]),e._v(" "),t("p",[e._v("期待通り動作することを確認するため、以下の「3. チェックアウトのテスト」に進んでください。")]),e._v(" "),t("p",[t("a",{attrs:{id:"22-connect-by-manually-creating-the-api-key-and-permissions"}})]),e._v(" "),t("h3",{attrs:{id:"22-api-キーと権限を手動作成して接続"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#22-api-キーと権限を手動作成して接続"}},[e._v("#")]),e._v(" 2.2 API キーと権限を手動作成して接続")]),e._v(" "),t("p",[e._v("前のセクションで説明したウィザードが使えない場合は、API キーを手動で作成することもできます。")]),e._v(" "),t("ol",[t("li",[e._v("左下の "),t("em",[e._v("[Account]")]),e._v(" -> "),t("em",[e._v("Manage Account")]),e._v(" をクリック\n"),t("img",{attrs:{src:a(873),alt:"BTCPay WordPress V2: Manage Account",title:"BTCPay WordPress V2: Manage Account"}})]),e._v(" "),t("li",[t("em",[e._v('"API Keys"')]),e._v(" タブへ移動")]),e._v(" "),t("li",[e._v("権限を選択するため "),t("em",[e._v("[Generate Key]")]),e._v(" をクリック\n"),t("img",{attrs:{src:a(874),alt:"BTCPay WordPress V2: API Keys overview",title:"BTCPay WordPress V2: API Keys overview"}})]),e._v(" "),t("li",[e._v("次の権限について "),t("em",[e._v('"Select specific stores"')]),e._v(" リンクをクリックします: "),t("code",[e._v("View invoices")]),e._v(", "),t("code",[e._v("Create invoice")]),e._v(", "),t("code",[e._v("Modify invoices")]),e._v(", "),t("code",[e._v("Modify stores webhooks")]),e._v(", "),t("code",[e._v("View your stores")]),e._v(", "),t("code",[e._v("Create non-approved pull payments")]),e._v("（返金で使用）\n"),t("img",{attrs:{src:a(875),alt:"BTCPay WordPress V2: API Keys Permissions",title:"BTCPay WordPress V2: API Keys Permissions"}})]),e._v(" "),t("li",[t("em",[e._v("[Generate API Key]")]),e._v(" をクリック\n"),t("img",{attrs:{src:a(876),alt:"BTCPay WordPress V2: API Keys Save",title:"BTCPay WordPress V2: API Keys Save"}})]),e._v(" "),t("li",[e._v("生成された API Key を WordPress の "),t("em",[e._v("BTCPay Settings")]),e._v(" フォーム（Advanced settings）にコピー\n"),t("img",{attrs:{src:a(877),alt:"BTCPay WordPress V2: API Key をコピー",title:"BTCPay WordPress V2: API Key をコピー"}})]),e._v(" "),t("li",[e._v("store ID を WordPress の "),t("em",[e._v("BTCPay Settings")]),e._v(" フォーム（Advanced settings）にコピー\n"),t("img",{attrs:{src:a(878),alt:"BTCPay WordPress V2: Store ID をコピー",title:"BTCPay WordPress V2: Store ID をコピー"}})]),e._v(" "),t("li",[e._v("BTCPay Settings フォームで以下を設定:")])]),e._v(" "),t("ul",[t("li",[t("em",[e._v("BTCPay Server URL")]),e._v(" を入力（先ほど API キーを作成した BTCPay Server インスタンスの URL）")]),e._v(" "),t("li",[t("em",[e._v("BTCPay Server API Key")]),e._v(" と "),t("em",[e._v("Store ID")]),e._v(" を入力するため「Advanced settings」チェックボックスをオン（"),t("em",[e._v("Webhook secret")]),e._v(" は空のまま）")]),e._v(" "),t("li",[e._v("ページ下部の "),t("em",[e._v("[Save]")]),e._v(" をクリック\n"),t("img",{attrs:{src:a(879),alt:"BTCPay WordPress V2: BTCPay Settings フォームを保存",title:"BTCPay WordPress V2: BTCPay Settings フォームを保存"}})])]),e._v(" "),t("ol",{attrs:{start:"9"}},[t("li",[e._v("通知「"),t("em",[e._v("BTCPay Server: Successfully registered a new webhook on BTCPay Server")]),e._v("」が表示され、"),t("em",[e._v("Setup status")]),e._v(" と "),t("em",[e._v("Webhook status")]),e._v(" が緑色になっていることを確認してください。\n"),t("img",{attrs:{src:a(880),alt:"BTCPay WordPress V2: BTCPay Settings フォーム保存後",title:"BTCPay WordPress V2: BTCPay Settings フォーム保存後"}})])]),e._v(" "),t("p",[e._v("これでほぼ完了です。チェックアウトで Bitcoin 決済ゲートウェイを表示するには、サイドバーの「WooCommerce」->「Settings」から「Payments」タブを開き、「BTCPay (default)」決済ゲートウェイを有効化してください。")]),e._v(" "),t("p",[e._v("期待通り動作することを確認するため、以下の「3. チェックアウトのテスト」に進んでください。")]),e._v(" "),t("h2",{attrs:{id:"3-チェックアウトのテスト"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#3-チェックアウトのテスト"}},[e._v("#")]),e._v(" 3. チェックアウトのテスト")]),e._v(" "),t("p",[e._v("ストアで少額のテスト購入を行うと安心です。\n本番運用前に、すべてが正しく設定されていることを必ず確認してください。\n最後の動画では、Electrum ウォレットでギャップリミットを設定し、チェックアウト処理をテストする手順を案内しています。")]),e._v(" "),t("a",{staticClass:"ytEmbed",staticStyle:{"background-image":"url(https://img.youtube.com/vi/Fi3pYpzGmmo/hqdefault.jpg)"},attrs:{href:"https://www.youtube.com/watch?v=Fi3pYpzGmmo",title:"BTCPay Server Checkout","data-id":"Fi3pYpzGmmo"}},[t("iframe",{attrs:{title:"BTCPay Server Checkout","data-src":"https://www.youtube-nocookie.com/embed/Fi3pYpzGmmo?&autoplay=1&autohide=1&modestbranding=1&color=white&rel=0",frameborder:"0",allow:"autoplay;encrypted-media;picture-in-picture",allowfullscreen:""}})]),e._v(" "),t("h2",{attrs:{id:"4-btcpay-woocommerce-v2-のカスタマイズ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#4-btcpay-woocommerce-v2-のカスタマイズ"}},[e._v("#")]),e._v(" 4. BTCPay WooCommerce V2 のカスタマイズ")]),e._v(" "),t("h3",{attrs:{id:"41-グローバル設定"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#41-グローバル設定"}},[e._v("#")]),e._v(" 4.1 グローバル設定")]),e._v(" "),t("p",[e._v("場所: "),t("em",[e._v("WooCommerce -> Settings -> Tab [BTCPay Settings]")])]),e._v(" "),t("p",[t("strong",[e._v("BTCPay Server URL")])]),e._v(" "),t("p",[e._v("プロトコルを含む BTCPay Server インスタンスの URL。例: "),t("code",[e._v("https://btcpay.yourdomain.com")]),e._v("。")]),e._v(" "),t("p",[t("strong",[e._v("BTCPay API Key")])]),e._v(" "),t("p",[e._v("あなたの API Key（前の手順で自動生成されたもの）。")]),e._v(" "),t("p",[t("strong",[e._v("Store ID")])]),e._v(" "),t("p",[e._v("BTCPay Server ストアの store ID。ストア設定ページで確認できます。")]),e._v(" "),t("p",[t("strong",[e._v("Default Customer Message")])]),e._v(" "),t("p",[e._v("チェックアウトで BTCPay 決済ゲートウェイを選択した後に表示される顧客メッセージをここでカスタマイズできます。「Separate payment gateways」オプションを使う場合は、各ゲートウェイ設定で上書きできます。")]),e._v(" "),t("p",[t("strong",[e._v('Invoice pass to "Settled" state after')])]),e._v(" "),t("p",[e._v("支払いを完全入金（settled）とみなす承認数を設定します。デフォルトでは BTCPay ストア設定の値が使用されます。")]),e._v(" "),t("p",[t("strong",[e._v("BTCPay Order Statuses")])]),e._v(" "),t("p",[e._v("ビジネスモデルやストア設定に応じて、注文ステータスの調整が必要になる場合があります。\nBTCPay が WooCommerce の特定の注文ステータスを自動でトリガーするよう設定できます。")]),e._v(" "),t("ul",[t("li",[t("em",[e._v("New")]),e._v(" - 注文済み、未払い。")]),e._v(" "),t("li",[t("em",[e._v("Paid")]),e._v(" - 支払い済みだが、ブロックチェーン上の承認数がまだ不足。")]),e._v(" "),t("li",[t("em",[e._v("Settled")]),e._v(" - 支払い済みで、ブロックチェーン上で承認済み。")]),e._v(" "),t("li",[t("em",[e._v("Settled (paid over)")]),e._v(" - 支払い済みで、ブロックチェーン上で承認済み、かつ過払い。")]),e._v(" "),t("li",[t("em",[e._v("Invalid")]),e._v(" - 支払い済みだが、BTCPay ストア設定で定義された時間内に十分な承認数に達しなかった、または手動で無効化された。")]),e._v(" "),t("li",[t("em",[e._v("Expired")]),e._v(" - 請求書の期限切れ、未払い。")]),e._v(" "),t("li",[t("em",[e._v("Expired with partial payment")]),e._v(" - 請求書が期限切れで一部のみ支払い。")])]),e._v(" "),t("p",[e._v("これらのステータスをどう自動化したいか、時間をかけて検討してください。\n特定の BTCPay ステータスで WooCommerce 注文ステータスを変更したくない場合は、デフォルトの「- no mapping / defaults -」のままにできます。")]),e._v(" "),t("p",[e._v("注: デジタル商品と物理商品を販売している場合は、「Settled」の注文ステータスを「- no mapping / defaults -」のままにしておくべきです。デジタル商品のみを含む注文では、WooCommerce が「Processing」を自動でスキップし、直接「Completed」に進むためです。")]),e._v(" "),t("p",[e._v("別の例として、加盟店が「支払いは受領したが、処理は承認後に行う」ことを顧客へメール通知したい場合、「Paid」の注文ステータスを「On hold」に設定する必要があります。そのうえで WooCommerce 側で「On hold」ステータス時のメールをカスタマイズしてトリガーする必要があります。")]),e._v(" "),t("p",[e._v("最適な設定を見つけるには時間がかかるため、本番運用前に十分テストすることを推奨します。")]),e._v(" "),t("p",[t("strong",[e._v("Modal checkout")])]),e._v(" "),t("p",[e._v("このオプションを有効にすると、BTCPay Server の請求書がチェックアウトページに直接表示されます（BTCPay Server インスタンスへ顧客をリダイレクトしません）。")]),e._v(" "),t("p",[t("strong",[e._v("Separate Payment Gateways")])]),e._v(" "),t("p",[e._v("このオプションを有効にすると、BTCPay Server でサポートされる決済手段ごとに個別の決済ゲートウェイが生成されます。例えば、BTCPay Server ストアで BTC、LightningNetwork、Liquid Assets が有効なら、それぞれ個別ゲートウェイとして利用できます。これにより、ゲートウェイ別割引や国別制限など多くの新しいユースケースに対応できます。詳細は"),t("RouterLink",{attrs:{to:"/FAQ/Integrations/#how-to-configure-additional-token-support"}},[e._v("こちら")]),e._v("。")],1),e._v(" "),t("p",[t("strong",[e._v("Send customer data to BTCPayServer")])]),e._v(" "),t("p",[e._v("デフォルトでは、メールアドレス以外の顧客データは BTCPay Server に送信されません。顧客住所データも送信したい場合は、ここで有効化できます。")]),e._v(" "),t("p",[t("strong",[e._v("Debug Log")])]),e._v(" "),t("p",[e._v("問題が発生して詳細情報が必要な場合に役立ちます。ログは WooCommerce -> Status -> Log で確認できます。デバッグ後は必ず無効化してください。無効化しないとログが増え続け、ファイルシステムを圧迫します。")]),e._v(" "),t("h3",{attrs:{id:"42-決済ゲートウェイ固有設定"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#42-決済ゲートウェイ固有設定"}},[e._v("#")]),e._v(" 4.2 決済ゲートウェイ固有設定")]),e._v(" "),t("p",[e._v("前述の「Separate Payment Gateways」が有効かどうかに応じて、"),t("em",[e._v("WooCommerce -> Settings -> Tab [Payments]")]),e._v(" の決済ゲートウェイ設定に 1 つ以上のゲートウェイが表示されます。")]),e._v(" "),t("p",[e._v("すべての決済ゲートウェイで以下のオプションを設定できます。")]),e._v(" "),t("p",[t("strong",[e._v("Title")]),e._v("\nチェックアウトページに表示される決済ゲートウェイ名。デフォルトは「BTCPay (Bitcoin, Lightning Network, ...)」。")]),e._v(" "),t("p",[t("strong",[e._v("Customer Message")])]),e._v(" "),t("p",[e._v("BTCPay 決済ゲートウェイ選択後に表示されるメッセージをカスタマイズできます。")]),e._v(" "),t("p",[t("strong",[e._v("Gateway Icon")])]),e._v(" "),t("p",[e._v("チェックアウト中に決済ゲートウェイの横へ表示するカスタムアイコンをアップロードまたは選択できます。デフォルトは BTCPay ロゴです。")]),e._v(" "),t("h4",{attrs:{id:"421-btcpay-default"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#421-btcpay-default"}},[e._v("#")]),e._v(" 4.2.1 BTCPay (default)")]),e._v(" "),t("p",[e._v("デフォルト決済ゲートウェイでのみ使える追加オプション:")]),e._v(" "),t("p",[t("strong",[e._v("Enforce payment tokens")])]),e._v(" "),t("p",[e._v("BTCPay Settings で「Separate Payment Gateways」を有効化している場合、このオプションで payment トークンのみを強制できます。つまり、作成される請求書には「payment」タイプのトークンのみが含まれ、「promotion」タイプは含まれません。トークンタイプの違いは"),t("RouterLink",{attrs:{to:"/FAQ/Integrations/#how-to-configure-additional-token-support#token-types"}},[e._v("こちら")]),e._v("を参照してください。")],1),e._v(" "),t("h4",{attrs:{id:"422-separate-payment-gateways"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#422-separate-payment-gateways"}},[e._v("#")]),e._v(" 4.2.2 Separate Payment Gateways")]),e._v(" "),t("p",[e._v("個別決済ゲートウェイでのみ使える追加オプション（この機能が有効な場合）:")]),e._v(" "),t("p",[t("strong",[e._v("Token Type")])]),e._v(" "),t("p",[e._v("デフォルトでは「payment」タイプが選択されます。ただし、独自発行アセット/トークン（例: バウチャー用途）を含む Liquid Assets を使う場合は、ここで「promotion」を選択できます。これらは通常の payment トークンとは異なる方法で処理されます。詳細は"),t("RouterLink",{attrs:{to:"/FAQ/Integrations/#how-to-configure-additional-token-support#promotional-tokens-100-discount"}},[e._v("こちら")]),e._v("で確認できます。")],1),e._v(" "),t("h2",{attrs:{id:"トラブルシューティング"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#トラブルシューティング"}},[e._v("#")]),e._v(" トラブルシューティング")]),e._v(" "),t("h3",{attrs:{id:"エラー-call-to-undefined-function-btcpayserver-http-curl-init"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#エラー-call-to-undefined-function-btcpayserver-http-curl-init"}},[e._v("#")]),e._v(" エラー: Call to undefined function BTCPayServer\\Http\\curl_init()")]),e._v(" "),t("p",[e._v("PHP バージョンが cURL 拡張に対応していることを確認してください（上記要件のとおり）。Debian/Ubuntu では "),t("code",[e._v("sudo apt install php-curl")]),e._v(" でインストールできます。")]),e._v(" "),t("h3",{attrs:{id:"請求書が支払い済みなのに注文ステータスが更新されない"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#請求書が支払い済みなのに注文ステータスが更新されない"}},[e._v("#")]),e._v(" 請求書が支払い済みなのに注文ステータスが更新されない")]),e._v(" "),t("p",[e._v("まず、BTCPay Server のストア設定で webhook が作成されているか確認してください。webhook がない場合は、WooCommerce ストアの BTCPay Settings タブ（WooCommerce 設定内）で保存ボタンを押してください。webhook が作成されます。")]),e._v(" "),t("p",[e._v("請求書詳細で、webhook リクエスト送信時にエラーが出ていないかも確認してください。ホスティング事業者、ファイアウォール設定、または WordPress セキュリティプラグイン（Wordfence など）が WordPress サイトへの POST リクエストをブロックし、"),t("code",[e._v("403 Forbidden")]),e._v(" や "),t("code",[e._v("503 Service Unavailable")]),e._v(" になる場合があります。")]),e._v(" "),t("p",[e._v("サイトへのリクエストがブロックされているかは、次の 2 つの方法で確認できます。")]),e._v(" "),t("p",[t("strong",[e._v("コマンドライン（Linux または MacOS）で確認:")]),e._v("\n（EXAMPLE.COM を WordPress サイト URL に置き換えてください）")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('curl -vX POST -H "Content-Type: application/json" \\\n    -d \'{"data": "test"}\' https://EXAMPLE.COM/?wc-api=btcpaygf_default\n')])])]),t("p",[e._v("レスポンスで「HTTP/1.1 500」または「HTTP/2 500」と「Webhook request validation failed」が表示される場合、サイトは "),t("code",[e._v("403 Forbidden")]),e._v(" でリクエストをブロックしていないことを意味します。")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('.... snip ....\n* We are completely uploaded and fine\n< HTTP/2 500\n< server: nginx\n< date: Sun, 05 Jun 2022 16:55:08 GMT\n< content-type: application/json; charset=UTF-8\n< x-powered-by: PHP/8.1.6\n< expires: Wed, 11 Jan 1984 05:00:00 GMT\n< cache-control: no-cache, must-revalidate, max-age=0\n<\n* Connection #0 to host example.com left intact\n{"code":"wp_die","message":"Webhook request validation failed.","data":{"status":500},"additional_errors":[]}\n')])])]),t("p",[e._v("一方、「HTTP/1.1 403 Forbidden」または「HTTP/2 403」が表示される場合は、WordPress サイトへの送信データが何かにブロックされています。ホスティング事業者に問い合わせるか、ファイアウォールやプラグインがリクエストを遮断していないか確認してください。")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v(".... snip ....\n* upload completely sent off: 16 out of 16 bytes\n< HTTP/1.1 403 Forbidden\n< access-control-allow-origin: *\n< Content-Type: application/json; charset=UTF-8\n< X-Cloud-Trace-Context: 4f07d5b2e5c2f05949d04421a8e2dd6a\n< Date: Thu, 17 Feb 2022 10:06:50 GMT\n< Server: Google Frontend\n< Content-Length: 26\n")])])]),t("p",[t("strong",[e._v("オンラインサービスを使って確認（コマンドラインが使えない場合）:")])]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://reqbin.com/post-online",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://reqbin.com/post-online"),t("OutboundLink")],1),e._v(" にアクセス")]),e._v(" "),t("li",[e._v("ドメインを入力: "),t("code",[e._v("https://EXAMPLE.COM/?wc-api=btcpaygf_default")]),e._v("\n（EXAMPLE.COM を WordPress サイト URL に置き換えてください）")]),e._v(" "),t("li",[e._v("「POST」が選択されていることを確認")]),e._v(" "),t("li",[e._v("[Send] をクリック")])]),e._v(" "),t("figure",[t("img",{attrs:{src:a(881),alt:"BTCPay WordPress V2: reqbin.com で 403 エラーをデバッグ",title:"BTCPay WordPress V2: reqbin.com で 403 エラーをデバッグ"}})]),e._v(" "),t("p",[e._v("「Status 403 (Forbidden)」が表示される場合、何らかの理由でサイトへの POST リクエストがブロックされています。ホスティング事業者に問い合わせるか、ファイアウォールやプラグインがリクエストを遮断していないか確認してください。")]),e._v(" "),t("h3",{attrs:{id:"チェックアウト時にエラーが出るが原因がわからない"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#チェックアウト時にエラーが出るが原因がわからない"}},[e._v("#")]),e._v(" チェックアウト時にエラーが出るが原因がわからない")]),e._v(" "),t("p",[e._v("管理ダッシュボードの BTCPay Settings（"),t("em",[e._v("WooCommerce -> Settings: Tab [BTCPay Settings]")]),e._v("）で、該当オプションのチェックボックスをオンにするとデバッグモードを有効化できます。")]),e._v(" "),t("p",[e._v("その後、[View Logs] ボタンをクリックするか、"),t("em",[e._v("WooCommerce -> Status: Tab [Logs]")]),e._v(" へ移動して最新の btcpay ログを選択すると、より詳細なログを確認できます。")]),e._v(" "),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[e._v("警告")]),e._v(" "),t("p",[e._v("調査が終わったら必ずデバッグモードを無効化してください。無効化しないとサイトのパフォーマンスに影響し、不要なログデータが大量にファイルシステムへ書き込まれます。")])]),e._v(" "),t("p",[e._v("加えて、BTCPay プラグイン関連エラーがないか Web サーバーのエラーログも確認してください。")]),e._v(" "),t("h3",{attrs:{id:"プラグイン利用時の問題やその他の質問"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#プラグイン利用時の問題やその他の質問"}},[e._v("#")]),e._v(" プラグイン利用時の問題やその他の質問")]),e._v(" "),t("p",[e._v("ヘルプが必要な場合や追加の質問がある場合は、"),t("a",{attrs:{href:"https://chat.btcpayserver.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://chat.btcpayserver.org/"),t("OutboundLink")],1),e._v(" のサポートチャンネルに参加してください。")]),e._v(" "),t("h3",{attrs:{id:"新しい-api-キーを作成する"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#新しい-api-キーを作成する"}},[e._v("#")]),e._v(" 新しい API キーを作成する")]),e._v(" "),t("p",[e._v("WooCommerce V2 プラグインを 2.0.0 より前のバージョンから使っている場合、返金（pull-payment）に必要な権限が API キーに含まれていません。この機能を使いたい場合は、新しい API キーを作成できます（現時点では API キーの編集は未対応）。上記の "),t("a",{attrs:{href:"#21-connect-using-the-api-key-wizard--recommended-"}},[e._v("2.1 API キーウィザードを使って接続")]),e._v(" または "),t("a",{attrs:{href:"#22-connect-by-manually-creating-the-api-key-and-permissions"}},[e._v("API キーの手動作成")]),e._v(" を利用してください。設定済み webhook は引き続き動作するため、変更は不要です。")]),e._v(" "),t("h3",{attrs:{id:"webhook-を触って壊してしまった場合の修復方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#webhook-を触って壊してしまった場合の修復方法"}},[e._v("#")]),e._v(" webhook を触って壊してしまった場合の修復方法")]),e._v(" "),t("p",[e._v("誤って WooCommerce の webhook を変更し、動かなくなった場合は、BTCPay Server 側で API キーを削除したうえで、WordPress サイトの BTCPay Server Settings で再度保存を押してください。webhook が正常に再作成されたというメッセージが表示されるはずです。")]),e._v(" "),t("p",[t("a",{attrs:{id:"deploying-woocommerce-from-btcpay-server"}})]),e._v(" "),t("h2",{attrs:{id:"btcpay-server-から-woocommerce-をデプロイ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#btcpay-server-から-woocommerce-をデプロイ"}},[e._v("#")]),e._v(" BTCPay Server から WooCommerce をデプロイ")]),e._v(" "),t("p",[e._v("すでに BTCPay Server がある場合、既存環境から簡単に WooCommerce を開始できます。")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("BTCPay をホストしている仮想マシンの外部 IP を、ストア用ドメイン（例: store.yourdomain.com）に向けます。")])]),e._v(" "),t("li",[t("p",[e._v("root として BTCPay サーバーにログインします。")])])]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("su")]),e._v(" -\n")])])]),t("ol",{attrs:{start:"3"}},[t("li",[e._v("WooCommerce 用の変数を設定します。"),t("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker/blob/master/docker-compose-generator/docker-fragments/opt-add-woocommerce.yml",target:"_blank",rel:"noopener noreferrer"}},[e._v("オプション変数"),t("OutboundLink")],1),e._v("も追加できます。")])]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("BTCPAYGEN_ADDITIONAL_FRAGMENTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$BTCPAYGEN_ADDITIONAL_FRAGMENTS")]),e._v(';opt-add-woocommerce"')]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("WOOCOMMERCE_HOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"yourstoredomain.com"')]),e._v("\n")])])]),t("ol",{attrs:{start:"4"}},[t("li",[e._v("最後に BTCPay Setup スクリプトを実行して、設定した変数を反映します。")])]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v(" ./btcpay-setup.sh "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-i")]),e._v("\n")])])]),t("ol",{attrs:{start:"5"}},[t("li",[e._v("ストアのドメイン（この例では store.yourdomain.com）にアクセスし、WordPress インストールウィザードを完了してください。")])])])}),[],!1,null,null,null);t.default=s.exports},864:function(e,t,a){e.exports=a.p+"assets/img/BTCPayInfographic.93db91b4.png"},865:function(e,t,a){e.exports=a.p+"assets/img/btcpay-wc-2--01-plugin-search.d542b753.png"},866:function(e,t,a){e.exports=a.p+"assets/img/btcpay-wc-2--02-activated-configure.3054c6da.png"},867:function(e,t,a){e.exports=a.p+"assets/img/btcpay-wc-2--03-settings--api-key-redirect.dee3eb63.png"},868:function(e,t,a){e.exports=a.p+"assets/img/btcpayWooLmode1.30c2a467.jpg"},869:function(e,t,a){e.exports=a.p+"assets/img/btcpay-wc-2--05-api-auth-select-store.8765a27a.png"},870:function(e,t,a){e.exports=a.p+"assets/img/btcpay-wc-2--06-api-auth-authorize-button.7ba04186.png"},871:function(e,t,a){e.exports=a.p+"assets/img/btcpay-wc-2--07-api-auth-after-redirect-prefilled.70d8472c.png"},872:function(e,t,a){e.exports=a.p+"assets/img/btcpay-wc-2--08-api-auth-save-webhook-created.53d476f0.png"},873:function(e,t,a){e.exports=a.p+"assets/img/btcpayWooLmode2.6ceb841e.jpg"},874:function(e,t,a){e.exports=a.p+"assets/img/btcpayWooLmode3.967e4347.jpg"},875:function(e,t,a){e.exports=a.p+"assets/img/btcpayWooLmode4.4cb74b80.jpg"},876:function(e,t,a){e.exports=a.p+"assets/img/btcpayWooLmode5.a35ab95d.jpg"},877:function(e,t,a){e.exports=a.p+"assets/img/btcpayWooLmode6.fa94aa2e.jpg"},878:function(e,t,a){e.exports=a.p+"assets/img/btcpay-wc-2--7-man-api--copy-store-id.6c1943ea.png"},879:function(e,t,a){e.exports=a.p+"assets/img/btcpay-wc-2--15-man-api--btcpay-settings-fill.298e9de1.png"},880:function(e,t,a){e.exports=a.p+"assets/img/btcpay-wc-2--15-man-api--btcpay-settings-save.1f329e19.png"},881:function(e,t,a){e.exports=a.p+"assets/img/btcpay-wc-2--reqbin-403-test.62547f5f.png"}}]);