(window.webpackJsonp=window.webpackJsonp||[]).push([[156],{979:function(a,t,s){"use strict";s.r(t);var e=s(17),r=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("p",[t("span",{attrs:{id:"btcpay-server-keeps-showing-that-my-node-is-always-starting"}}),a._v(" "),t("span",{attrs:{id:"btcpay-server-takes-forever-to-synchronize"}}),a._v(" "),t("span",{attrs:{id:"can-i-skip-the-synchronization"}}),a._v(" "),t("span",{attrs:{id:"how-can-i-check-the-block-height-of-my-bitcoin-node"}}),a._v(" "),t("span",{attrs:{id:"how-do-i-know-that-btcpay-synced-completely"}}),a._v(" "),t("span",{attrs:{id:"how-to-disable-bitcoin-node-pruning"}}),a._v(" "),t("span",{attrs:{id:"how-to-enable-bitcoin-node-pruning"}}),a._v(" "),t("span",{attrs:{id:"im-running-a-full-node-and-have-a-synched-blockchain-can-btcpay-use-it-so-that-it-doesnt-have-to-do-a-full-sync"}}),a._v(" "),t("span",{attrs:{id:"why-does-btcpay-sync"}})]),a._v(" "),t("h1",{attrs:{id:"同期-faq"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#同期-faq"}},[a._v("#")]),a._v(" 同期 FAQ")]),a._v(" "),t("p",[a._v("このドキュメントでは、BTCPay の同期中に発生しうる一般的な質問と問題をまとめています。")]),a._v(" "),t("p"),t("div",{staticClass:"table-of-contents"},[t("ul",[t("li",[t("a",{attrs:{href:"#btcpay-が同期するのはなぜですか？"}},[a._v("BTCPay が同期するのはなぜですか？")])]),t("li",[t("a",{attrs:{href:"#同期をスキップできますか？"}},[a._v("同期をスキップできますか？")])]),t("li",[t("a",{attrs:{href:"#btcpay-が完全に同期されたことを確認する方法は？"}},[a._v("BTCPay が完全に同期されたことを確認する方法は？")])]),t("li",[t("a",{attrs:{href:"#自分の-bitcoin-ノードのブロック高を確認する方法は？"}},[a._v("自分の bitcoin ノードのブロック高を確認する方法は？")])]),t("li",[t("a",{attrs:{href:"#btcpay-server-の同期が非常に遅い"}},[a._v("BTCPay Server の同期が非常に遅い")]),t("ul",[t("li",[t("a",{attrs:{href:"#原因-1-cpu-が不足している"}},[a._v("原因 1: CPU が不足している")])]),t("li",[t("a",{attrs:{href:"#原因-2-スワップメモリを使用している"}},[a._v("原因 2: スワップメモリを使用している")])])])]),t("li",[t("a",{attrs:{href:"#btcpay-server-でノードが常に-starting-と表示される"}},[a._v("BTCPay Server でノードが常に starting と表示される")]),t("ul",[t("li",[t("a",{attrs:{href:"#原因-1-ram-が不足している"}},[a._v("原因 1: RAM が不足している")])]),t("li",[t("a",{attrs:{href:"#原因-2-ストレージが不足している"}},[a._v("原因 2: ストレージが不足している")])]),t("li",[t("a",{attrs:{href:"#原因-3-誤って-pruning-を無効化した"}},[a._v("原因 3: 誤って pruning を無効化した")])]),t("li",[t("a",{attrs:{href:"#原因-4-bitcoin-データディレクトリが破損している"}},[a._v("原因 4: bitcoin データディレクトリが破損している")])]),t("li",[t("a",{attrs:{href:"#原因-5-最後のウォレット同期が-pruned-データ範囲を超えている"}},[a._v("原因 5: 最後のウォレット同期が pruned データ範囲を超えている")])])])]),t("li",[t("a",{attrs:{href:"#フルノードで同期済みブロックチェーンを持っています。フル同期せず-btcpay-で使えますか？"}},[a._v("フルノードで同期済みブロックチェーンを持っています。フル同期せず BTCPay で使えますか？")])]),t("li",[t("a",{attrs:{href:"#bitcoin-ノードの-pruning-を有効化するには？"}},[a._v("Bitcoin ノードの pruning を有効化するには？")])]),t("li",[t("a",{attrs:{href:"#bitcoin-ノードの-pruning-を無効化するには？"}},[a._v("Bitcoin ノードの pruning を無効化するには？")])])])]),t("p"),a._v(" "),t("h2",{attrs:{id:"btcpay-が同期するのはなぜですか？"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#btcpay-が同期するのはなぜですか？"}},[a._v("#")]),a._v(" BTCPay が同期するのはなぜですか？")]),a._v(" "),t("p",[a._v("デプロイ後、BTCPay Server はブロックチェーン全体を同期し、すべてのコンセンサスルールを検証する必要があります。マシンスペック、帯域幅、追加したアルトコイン数によって、このプロセスは 1〜5 日かかることがあります。")]),a._v(" "),t("p",[a._v("手間に感じるかもしれませんが、誰にも依存せず信頼せずに自分のフルノードを運用するうえで重要なステップです。ノードは約 300GB のデータ（pruned node を使う場合はこれより少ない）をダウンロードするだけでなく、コンセンサスルールをすべて検証します。ブロックチェーン同期の重要性は "),t("a",{attrs:{href:"https://www.youtube.com/watch?v=OrYDehC-8TU",target:"_blank",rel:"noopener noreferrer"}},[a._v("この動画"),t("OutboundLink")],1),a._v(" で詳しく説明されています。")]),a._v(" "),t("p",[a._v("BTCPay Server を学ぶことだけが目的で、独自インスタンスをデプロイせず単に "),t("RouterLink",{attrs:{to:"/TryItOut/"}},[a._v("試したい")]),a._v(" 場合は、"),t("RouterLink",{attrs:{to:"/Deployment/ThirdPartyHosting/"}},[a._v("Third-Party host")]),a._v(" を使えば同期を回避できます。")],1),a._v(" "),t("h2",{attrs:{id:"同期をスキップできますか？"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#同期をスキップできますか？"}},[a._v("#")]),a._v(" 同期をスキップできますか？")]),a._v(" "),t("p",[a._v("BTCPay Server をデプロイする場合、同期はスキップできません。ただし、所要時間を大幅に短縮することはできます。コマンドライン操作に慣れているなら、FastSync を使ってノードをより高速に同期できます。この機能には信頼モデル上の注意点があるため、必ず "),t("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker/tree/master/contrib/FastSync",target:"_blank",rel:"noopener noreferrer"}},[a._v("FastSync ドキュメント"),t("OutboundLink")],1),a._v(" を確認してください。")]),a._v(" "),t("p",[a._v("FastSync を使うには、"),t("code",[a._v("opt-save-storage")]),a._v(" 環境変数で "),t("a",{attrs:{href:"#how-to-enable-bitcoin-node-pruning"}},[a._v("pruning を有効化")]),a._v(" している必要があります。そうでないと bitcoind は同期できません。まず BTCPayServer インスタンスに "),t("RouterLink",{attrs:{to:"/FAQ/ServerSettings/#how-to-ssh-into-my-btcpay-running-on-vps"}},[a._v("ssh 接続")]),a._v(" し、次のコマンドを実行します。")],1),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("su")]),a._v(" -\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$BTCPAY_BASE_DIRECTORY")]),a._v("/btcpayserver-docker/\nbtcpay-down.sh\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" contrib/FastSync\n./load-utxo-set.sh\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Once FastSync has completed")]),a._v("\nbtcpay-up.sh\n")])])]),t("p",[a._v("FastSync 完了後にインスタンスを再起動したら、BTCPay ドメインを更新して残りのブロックチェーン同期を待ちます。"),t("a",{attrs:{href:"https://youtube.com/watch?v=VNMnd-dX9Q8?t=1730",target:"_blank",rel:"noopener noreferrer"}},[a._v("この動画"),t("OutboundLink")],1),a._v(" も参考になります。")]),a._v(" "),t("p",[a._v("FastSync 実行後に "),t("code",[a._v("You need to delete your Bitcoin Core wallet")]),a._v(" が表示される場合、または "),t("code",[a._v("Last wallet synchronisation goes beyond pruned data")]),a._v(" エラーが出る場合は、"),t("a",{attrs:{href:"#btcpay-server-keeps-showing-that-my-node-is-always-starting"}},[a._v("BTCPay Server keeps showing that my node is always starting")]),a._v(" の項目を参照してください。")]),a._v(" "),t("h2",{attrs:{id:"btcpay-が完全に同期されたことを確認する方法は？"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#btcpay-が完全に同期されたことを確認する方法は？"}},[a._v("#")]),a._v(" BTCPay が完全に同期されたことを確認する方法は？")]),a._v(" "),t("p",[a._v("右下に同期進捗ポップアップが表示されなくなれば、サーバーは完全同期済みで "),t("RouterLink",{attrs:{to:"/RegisterAccount/"}},[a._v("利用開始")]),a._v(" できます。")],1),a._v(" "),t("p",[a._v("BTCPay Server の Bitcoin ノードが最新ブロックまで同期しているか確認するには、任意のブロックチェーンエクスプローラーで現在のブロック高を確認し、"),t("a",{attrs:{href:"#how-can-i-check-the-block-height-of-my-bitcoin-node"}},[a._v("ノード高")]),a._v(" と一致するか比較してください。")]),a._v(" "),t("h2",{attrs:{id:"自分の-bitcoin-ノードのブロック高を確認する方法は？"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自分の-bitcoin-ノードのブロック高を確認する方法は？"}},[a._v("#")]),a._v(" 自分の bitcoin ノードのブロック高を確認する方法は？")]),a._v(" "),t("p",[a._v("Bitcoin ノードの同期状態を確認するには、サーバーの Bitcoin コンテナ内で bitcoin-cli コマンドを使います。サーバーへ SSH 接続し、"),t("RouterLink",{attrs:{to:"/Troubleshooting/#23-bitcoin-node-logs"}},[a._v("Bitcoin ログを確認する")]),a._v(" ディレクトリに移動したあと、"),t("code",[a._v("bitcoin-cli.sh getblockcount")]),a._v(" を実行してサーバーの Bitcoin ノードの現在ブロック高を確認します。")],1),a._v(" "),t("h2",{attrs:{id:"btcpay-server-の同期が非常に遅い"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#btcpay-server-の同期が非常に遅い"}},[a._v("#")]),a._v(" BTCPay Server の同期が非常に遅い")]),a._v(" "),t("p",[a._v("Bitcoin フルノードの同期には通常 1〜5 日かかります。最初は速く、終盤に近づくほど遅くなるのが一般的です。")]),a._v(" "),t("p",[a._v("同期していないように見える場合は、次を確認してください。")]),a._v(" "),t("ul",[t("li",[a._v("CPU が不足している")]),a._v(" "),t("li",[a._v("スワップメモリを使用している")])]),a._v(" "),t("h3",{attrs:{id:"原因-1-cpu-が不足している"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#原因-1-cpu-が不足している"}},[a._v("#")]),a._v(" 原因 1: CPU が不足している")]),a._v(" "),t("p",[a._v("同期中は 2 CPU を推奨します。ただし、ホスティングプロバイダーによっては CPU 使用量が多いと制限されることがあります。")]),a._v(" "),t("p",[a._v("次で確認します。")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("su")]),a._v(" -\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" stats\n")])])]),t("p",[a._v("同期が非常に遅いのに CPU 使用率が 100% 超の場合:")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("8e7ac41e6e2a        btcpayserver_bitcoind               100%               560.5MiB / 3.853GiB   14.20%              4.17\n")])])]),t("p",[a._v("この場合はマシンスペックを引き上げる必要があります。")]),a._v(" "),t("p",[a._v("同期中の CPU 使用率が非常に低い（10% 未満）場合:")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("8e7ac41e6e2a        btcpayserver_bitcoind               10%               560.5MiB / 3.853GiB   14.20%              4.17\n")])])]),t("p",[a._v("ホスティングプロバイダー側で CPU 制限されている可能性があります。長時間の高 CPU 使用を許容しているか確認してください。")]),a._v(" "),t("p",[a._v("許容されない場合は、制限が解除されるまでサーバーを停止し、その後 docker 側で CPU を制限して再起動します。")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" update btcpayserver_bitcoind "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--cpus")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('".8"')]),a._v("\n")])])]),t("h3",{attrs:{id:"原因-2-スワップメモリを使用している"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#原因-2-スワップメモリを使用している"}},[a._v("#")]),a._v(" 原因 2: スワップメモリを使用している")]),a._v(" "),t("p",[a._v("同期時にメモリ不足だと、サーバーは動作継続のためスワップメモリを使用することがあります。")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("su")]),a._v(" -\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("free")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-h")]),a._v("\n")])])]),t("p",[a._v("スワップ使用が確認できる場合:")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("              total        used        "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("free")]),a._v("      shared  buff/cache   available\nMem:           "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(".0G        "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(".0G        0M         66M        0G        0M\nSwap:          "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(".0G        200M      800M\n")])])]),t("p",[a._v("この場合はメモリを追加してサーバーをスケールアップしてください。")]),a._v(" "),t("h2",{attrs:{id:"btcpay-server-でノードが常に-starting-と表示される"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#btcpay-server-でノードが常に-starting-と表示される"}},[a._v("#")]),a._v(" BTCPay Server でノードが常に starting と表示される")]),a._v(" "),t("p",[a._v("考えられる原因:")]),a._v(" "),t("ul",[t("li",[a._v("RAM が不足している")]),a._v(" "),t("li",[a._v("ストレージが不足している")]),a._v(" "),t("li",[a._v("誤って pruning を無効化した")]),a._v(" "),t("li",[a._v("bitcoin データディレクトリが破損している")]),a._v(" "),t("li",[a._v("最後のウォレット同期が pruned データ範囲を超えている")])]),a._v(" "),t("h3",{attrs:{id:"原因-1-ram-が不足している"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#原因-1-ram-が不足している"}},[a._v("#")]),a._v(" 原因 1: RAM が不足している")]),a._v(" "),t("p",[a._v("RAM を確認します。")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("su")]),a._v(" -\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("free")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-h")]),a._v("\n")])])]),t("p",[t("code",[a._v("free")]),a._v(" がほぼない、または "),t("code",[a._v("available")]),a._v(" が極端に少ない場合:")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("              total        used        "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("free")]),a._v("      shared  buff/cache   available\nMem:           "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(".0G        "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(".0G        0M         66M        0G        0M\nSwap:            0B          0B          0B\n")])])]),t("p",[a._v("メモリ増設が必要です。ノード同期済みであればスワップメモリを追加できます。未同期ならサーバースペックが不足しています。")]),a._v(" "),t("p",[a._v("同期済みの場合、次で 2G のスワップを追加できます。")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("fallocate "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-l")]),a._v(" 2G /mnt/swapfile\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("600")]),a._v(" /mnt/swapfile\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkswap")]),a._v(" /mnt/swapfile\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("swapon")]),a._v(" /mnt/swapfile\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/mnt/swapfile   none    swap    sw    0   0"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">>")]),a._v(" /etc/fstab\n")])])]),t("h3",{attrs:{id:"原因-2-ストレージが不足している"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#原因-2-ストレージが不足している"}},[a._v("#")]),a._v(" 原因 2: ストレージが不足している")]),a._v(" "),t("p",[a._v("マシンのストレージを確認します。")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("su")]),a._v(" -\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("df")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-h")]),a._v("\n")])])]),t("p",[a._v("ストレージ残量がない場合（例では "),t("code",[a._v("/dev/sda1")]),a._v("）:")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("Filesystem      Size  Used Avail Use% Mounted on\nudev            "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(".0G     "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(".0G   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("% /dev\ntmpfs           395M   41M  354M  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("11")]),a._v("% /run\n/dev/sda1       125G  125G  0G   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("100")]),a._v("% /\ntmpfs           "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(".0G     "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(".0G   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("% /dev/shm\ntmpfs           "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v(".0M     "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v(".0M   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("% /run/lock\ntmpfs           "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(".0G     "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(".0G   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("% /sys/fs/cgroup\n/dev/sdb1       "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("7")]),a._v(".8G   18M  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("7")]),a._v(".4G   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("% /mnt\n")])])]),t("p",[a._v("維持したいストレージ量に応じた "),t("RouterLink",{attrs:{to:"/Docker/#generated-docker-compose"}},[a._v("docker fragment")]),a._v(" を選択し、その後 "),t("RouterLink",{attrs:{to:"/Docker/#how-i-can-prune-my-nodes"}},[a._v("ノードを prune")]),a._v(" してください。")],1),a._v(" "),t("h3",{attrs:{id:"原因-3-誤って-pruning-を無効化した"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#原因-3-誤って-pruning-を無効化した"}},[a._v("#")]),a._v(" 原因 3: 誤って pruning を無効化した")]),a._v(" "),t("p",[t("code",[a._v('export BTCPAYGEN_ADDITIONAL_FRAGMENTS="xyz"')]),a._v(" で追加 fragment を設定した際、既存値を含め忘れると pruning を無効化してしまう場合があります。")]),a._v(" "),t("p",[a._v("Bitcoin ブロックチェーン全体を保存できるだけのメモリがなく、かつ実行中オプション一覧に "),t("code",[a._v("opt-save-storage")]),a._v(" がない（"),t("RouterLink",{attrs:{to:"/FAQ/Deployment/#how-can-i-modify-or-deactivate-environment-variables"}},[a._v("実行中オプションの確認")]),a._v("）なら、pruning 無効化の可能性が高いです。")],1),a._v(" "),t("p",[a._v("Bitcoind ログで確認できます。")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("su")]),a._v(" -\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" btcpayserver-docker\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" logs "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--tail")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("100")]),a._v(" btcpayserver_bitcoind\n")])])]),t("p",[a._v("以下が表示される場合:")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("Block files have previously been pruned.\nYou need to rebuild the database using "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-reindex")]),a._v(" to go back to unpruned mode.\nThis will redownload the entire blockchain.\nPlease restart with "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-reindex")]),a._v(" or -reindex-chainstate to recover.\n")])])]),t("p",[a._v("この場合は "),t("a",{attrs:{href:"#how-to-enable-bitcoin-node-pruning"}},[a._v("pruning を再有効化")]),a._v(" すれば解決できます。")]),a._v(" "),t("h3",{attrs:{id:"原因-4-bitcoin-データディレクトリが破損している"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#原因-4-bitcoin-データディレクトリが破損している"}},[a._v("#")]),a._v(" 原因 4: bitcoin データディレクトリが破損している")]),a._v(" "),t("p",[a._v("ノードログを確認します。")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("su")]),a._v(" -\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" logs "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--tail")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v(" btcpayserver_bitcoind\n")])])]),t("p",[a._v("以下が表示される場合:")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("Please restart with "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-reindex")]),a._v(" or -reindex-chainstate to recover.\n")])])]),t("p",[a._v("bitcoin データディレクトリが破損しています。物理的なディスク損傷や故障の可能性があります。\nノードを再インデックスするには:")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("btcpay-down.sh\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Delete 'blocks' and 'chainstate' folders")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-rf")]),a._v(" /var/lib/docker/volumes/generated_bitcoin_datadir/_data/blocks\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-rf")]),a._v(" /var/lib/docker/volumes/generated_bitcoin_datadir/_data/chainstate\nbtcpay-up.sh\n")])])]),t("h3",{attrs:{id:"原因-5-最後のウォレット同期が-pruned-データ範囲を超えている"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#原因-5-最後のウォレット同期が-pruned-データ範囲を超えている"}},[a._v("#")]),a._v(" 原因 5: 最後のウォレット同期が pruned データ範囲を超えている")]),a._v(" "),t("p",[a._v("FastSync を使った場合や、すでに同期済みのブロックチェーンを取り込んだ場合に発生することがあります。これは Bitcoin Core ウォレットを削除する必要がある状態で、原因は多くの場合、初回起動時に BTCPay Server が utxoset なしで起動し、ウォレットが utxoset より前に作成されたためです。該当ケースかどうかは "),t("RouterLink",{attrs:{to:"/Troubleshooting/#21-btcpay-logs"}},[a._v("bitcoind ログ")]),a._v(" で次を確認します。")],1),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("Error: Prune: last wallet synchronisation goes beyond pruned data. You need to "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-reindex")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("download the whole blockchain again "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" of pruned "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("node")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),t("p",[a._v("このエラーが表示され、同期完了のためにウォレット削除に同意する場合は、"),t("code",[a._v("btcpay-down.sh")]),a._v(" 実行後、"),t("code",[a._v("btcpay-up.sh")]),a._v(" 実行前に "),t("code",[a._v("docker volume rm generated_bitcoin_wallet_datadir")]),a._v(" を実行してください。\nWARNING: このウォレットに資金がある場合は削除しないでください。")]),a._v(" "),t("h2",{attrs:{id:"フルノードで同期済みブロックチェーンを持っています。フル同期せず-btcpay-で使えますか？"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#フルノードで同期済みブロックチェーンを持っています。フル同期せず-btcpay-で使えますか？"}},[a._v("#")]),a._v(" フルノードで同期済みブロックチェーンを持っています。フル同期せず BTCPay で使えますか？")]),a._v(" "),t("p",[a._v("可能です。ただし先に、docker volume を更新している既存の bitcoind を停止してください。その役割は BTCPay Server が引き継ぎます。")]),a._v(" "),t("p",[a._v("BTCPay Server を docker-compose で実行し、docker host 側に完全同期済みノードのデータディレクトリ（"),t("code",[a._v(".bitcoin")]),a._v("）がある場合、それを BTCPay Server で再利用できます。")]),a._v(" "),t("p",[a._v("手順は次のとおりです。")]),a._v(" "),t("ul",[t("li",[t("RouterLink",{attrs:{to:"/Docker/"}},[a._v("この手順")]),a._v(" に従って通常セットアップを行います。"),t("code",[a._v("opt-save-storage")]),a._v(" 環境変数は pruning レベル有効化に使われます。既存データディレクトリを prune したくない場合は、BTCPay docker デプロイで "),t("code",[a._v('export BTCPAYGEN_ADDITIONAL_FRAGMENTS="opt-save-storage-s"')]),a._v(" を設定しないでください。")],1),a._v(" "),t("li",[t("code",[a._v("btcpay-setup.sh")]),a._v(" 完了後、"),t("code",[a._v("btcpay-down.sh")]),a._v(" で docker compose を停止します。")]),a._v(" "),t("li",[t("code",[a._v("sudo su -")]),a._v(" で root ログインします。")]),a._v(" "),t("li",[a._v("bitcoind の docker volume を開きます: "),t("code",[a._v("cd /var/lib/docker/volumes/generated_bitcoin_datadir/")]),a._v("。"),t("code",[a._v("ls -la")]),a._v(" で内容を確認すると "),t("code",[a._v("_data")]),a._v(" ディレクトリのみのはずです。")]),a._v(" "),t("li",[t("code",[a._v("_data")]),a._v(" ディレクトリを削除します: "),t("code",[a._v("rm -r _data")]),a._v("。保持したい場合は "),t("code",[a._v("mv _data/ _data.old/")]),a._v(" でリネームします。")]),a._v(" "),t("li",[t("code",[a._v("/var/lib/docker/volumes/generated_bitcoin_datadir/_data")]),a._v(" と host 上のデータディレクトリ（"),t("code",[a._v(".bitcoin")]),a._v("）の間に "),t("a",{attrs:{href:"https://www.cyberciti.biz/faq/creating-soft-link-or-symbolic-link/",target:"_blank",rel:"noopener noreferrer"}},[a._v("シンボリックリンク"),t("OutboundLink")],1),a._v(" を作成します: "),t("code",[a._v("ln -s path/to/.bitcoin /var/lib/docker/volumes/generated_bitcoin_datadir/_data")])]),a._v(" "),t("li",[t("code",[a._v("ls -la")]),a._v(" でリンク作成を確認します。")]),a._v(" "),t("li",[t("code",[a._v("btcpay-up.sh")]),a._v(" で docker-compose を再起動します。")])]),a._v(" "),t("p",[a._v("これで BTCPay Server は完全同期済みになるはずです。")]),a._v(" "),t("p",[a._v("この後も BTCPay Server がノードを常に starting と表示する場合は、"),t("a",{attrs:{href:"#btcpay-server-keeps-showing-that-my-node-is-always-starting"}},[a._v("BTCPay Server keeps showing that my node is always starting")]),a._v(" の原因を参照してください。")]),a._v(" "),t("h2",{attrs:{id:"bitcoin-ノードの-pruning-を有効化するには？"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#bitcoin-ノードの-pruning-を有効化するには？"}},[a._v("#")]),a._v(" Bitcoin ノードの pruning を有効化するには？")]),a._v(" "),t("p",[a._v("これにより Bitcoin フルノードを最大 100GB（blocks）まで pruning できます。")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("su")]),a._v(" -\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" btcpayserver-docker\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("BTCPAYGEN_ADDITIONAL_FRAGMENTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"opt-save-storage"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v(" ./btcpay-setup.sh "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v("\n")])])]),t("p",[a._v("他の pruning オプションは "),t("RouterLink",{attrs:{to:"/Docker/#generated-docker-compose"}},[a._v("こちら")]),a._v(" を参照してください。他の additional fragments と併用する場合は "),t("RouterLink",{attrs:{to:"/FAQ/Deployment/#how-can-i-modify-or-deactivate-environment-variables"}},[a._v("この例")]),a._v(" を参照してください。")],1),a._v(" "),t("h2",{attrs:{id:"bitcoin-ノードの-pruning-を無効化するには？"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#bitcoin-ノードの-pruning-を無効化するには？"}},[a._v("#")]),a._v(" Bitcoin ノードの pruning を無効化するには？")]),a._v(" "),t("p",[a._v("BTCPay で Bitcoin ノードの pruning を無効化する前に、システムにブロックチェーン全体と BTCPayServer を保存できるだけのメモリがあることを確認してください。そのうえで "),t("code",[a._v("opt-save-storage")]),a._v(" 環境変数を無効化します。fragment 一覧の確認と 1 つだけ削除する方法は "),t("RouterLink",{attrs:{to:"/FAQ/Deployment/#how-can-i-modify-or-deactivate-environment-variables"}},[a._v("この例")]),a._v(" を参照してください。次の例は additional fragments を "),t("strong",[a._v("すべて")]),a._v(" 削除します。")],1),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("BTCPAYGEN_ADDITIONAL_FRAGMENTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('""')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v(" ./btcpay-setup.sh "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v("\n")])])]),t("p",[a._v("その後、pruning なし Bitcoin ノードを再作成するため次のコマンドを実行します。")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("btcpay-down.sh\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Delete 'blocks' and 'chainstate' folders")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-rf")]),a._v(" /var/lib/docker/volumes/generated_bitcoin_datadir/_data/blocks\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-rf")]),a._v(" /var/lib/docker/volumes/generated_bitcoin_datadir/_data/chainstate\nbtcpay-up.sh\n")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);