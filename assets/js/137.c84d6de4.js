(window.webpackJsonp=window.webpackJsonp||[]).push([[137],{948:function(e,t,a){"use strict";a.r(t);var r=a(17),s=Object(r.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"ローカル開発"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ローカル開発"}},[e._v("#")]),e._v(" ローカル開発")]),e._v(" "),t("h2",{attrs:{id:"前提条件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前提条件"}},[e._v("#")]),e._v(" 前提条件")]),e._v(" "),t("p",[t("strong",[e._v("開発環境")]),e._v(" では次のツールをインストールする必要があります。")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://dotnet.microsoft.com/en-us/download/dotnet/8.0",target:"_blank",rel:"noopener noreferrer"}},[e._v(".NET 8.0 SDK"),t("OutboundLink")],1)]),e._v(" "),t("li",[e._v("Docker: "),t("a",{attrs:{href:"https://docs.docker.com/docker-for-windows/install/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Windows"),t("OutboundLink")],1),e._v(" | "),t("a",{attrs:{href:"https://docs.docker.com/docker-for-mac/install/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Mac OS"),t("OutboundLink")],1),e._v(" | "),t("a",{attrs:{href:"https://docs.docker.com/install/linux/docker-ce/ubuntu/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Linux"),t("OutboundLink")],1)])]),e._v(" "),t("h2",{attrs:{id:"依存関係"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#依存関係"}},[e._v("#")]),e._v(" 依存関係")]),e._v(" "),t("p",[e._v("テスト実行やデバッグ実行のために、いくつかの "),t("strong",[e._v("依存サービス")]),e._v(" を起動する必要があります。")]),e._v(" "),t("p",[e._v("依存関係はすべて docker-compose ファイルにまとめてあり、これを使って開発環境を立ち上げられます。\n"),t("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver/blob/master/BTCPayServer.Tests/docker-compose.yml",target:"_blank",rel:"noopener noreferrer"}},[e._v("BTCPayServer.Tests/docker-compose.yml"),t("OutboundLink")],1),e._v(" を使うと一式を起動できます。")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" clone https://github.com/btcpayserver/btcpayserver.git\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" btcpayserver/BTCPayServer.Tests\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("docker-compose")]),e._v(" up dev\n")])])]),t("h2",{attrs:{id:"どの-ide-を使うべきか？"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#どの-ide-を使うべきか？"}},[e._v("#")]),e._v(" どの IDE を使うべきか？")]),e._v(" "),t("p",[e._v("Visual Studio 2022（Windows のみ）または Rider（クロスプラットフォーム）を推奨します。Visual Studio Code（クロスプラットフォーム）でも可能ですが、快適な開発環境の構築はやや複雑です。\nもちろん VIM も使えます。.NET Core はコマンドラインでも扱いやすいです。")]),e._v(" "),t("p",[e._v("Visual Studio Code、Visual Studio、Rider は launch profile "),t("code",[e._v("Bitcoin")]),e._v(" を実行します。\nこれにより "),t("strong",[e._v("Docker サービス内の依存関係へ接続する BTCPay Server インスタンス")]),e._v(" が起動し、デバッグやステップ実行が簡単になります。")]),e._v(" "),t("h2",{attrs:{id:"ビルド構成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ビルド構成"}},[e._v("#")]),e._v(" ビルド構成")]),e._v(" "),t("p",[e._v("build configuration は "),t("strong",[e._v("BTCPay Server のビルド方法")]),e._v(" を定義します。たとえば、特定のソースを含めるかどうか、デバッグ最適化か性能最適化かなどです。")]),e._v(" "),t("p",[e._v("利用可能な build configuration は次のとおりです。")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("Debug")])]),e._v(" "),t("li",[t("code",[e._v("Release")])]),e._v(" "),t("li",[t("code",[e._v("Altcoins-Debug")])]),e._v(" "),t("li",[t("code",[e._v("Altcoins-Release")])])]),e._v(" "),t("p",[e._v("ローカル開発中に別構成を使う方法は IDE によって異なります。\nデフォルトは "),t("code",[e._v("Debug")]),e._v(" で、これは altcoin 依存関係を含まない Bitcoin 専用ビルドです。別構成の使い方は IDE に依存します。")]),e._v(" "),t("p",[t("code",[e._v("dotnet")]),e._v(" コマンドラインでは "),t("code",[e._v("-c")]),e._v(" スイッチでビルド構成を選択できます。コマンドラインで Release ビルドを実行する場合は次のとおりです。")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("dotnet run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-c")]),e._v(" Release\n")])])]),t("h2",{attrs:{id:"launch-profiles"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#launch-profiles"}},[e._v("#")]),e._v(" Launch profiles")]),e._v(" "),t("p",[t("strong",[e._v("ローカル開発のために BTCPay Server をローカル起動")]),e._v(" する際は、docker-compose の開発用依存関係へ接続するための適切なパラメータが必要です。")]),e._v(" "),t("p",[e._v("これらのパラメータは dotnet の "),t("code",[e._v("launch profile")]),e._v(" という仕組みにまとめられています。")]),e._v(" "),t("p",[e._v("launch profile は "),t("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver/blob/master/BTCPayServer/Properties/launchSettings.json",target:"_blank",rel:"noopener noreferrer"}},[e._v("launchSettings.json"),t("OutboundLink")],1),e._v(" で定義されています。")]),e._v(" "),t("p",[e._v("現在は次の3つがあります。")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("Bitcoin")])]),e._v(" "),t("li",[t("code",[e._v("Bitcoin-HTTPS")])]),e._v(" "),t("li",[t("code",[e._v("Altcoins-HTTPS")])])]),e._v(" "),t("p",[e._v("デフォルトは "),t("code",[e._v("Bitcoin")]),e._v(" です。別の profile を使う方法は IDE によって異なります。")]),e._v(" "),t("p",[e._v("コマンドラインを使う場合、"),t("code",[e._v("dotnet run")]),e._v(" で任意の launch profile を選択できます。")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("dotnet run --launch-profile Bitcoin\n")])])]),t("h2",{attrs:{id:"テスト実行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#テスト実行"}},[e._v("#")]),e._v(" テスト実行")]),e._v(" "),t("p",[e._v("テスト実行は、開発時の BTCPay Server 実行とほぼ同じ仕組みで動作します。")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" BTCPayServer.Tests\ndotnet "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("test")]),e._v("\n")])])]),t("p",[e._v("テストでは "),t("code",[e._v("launch profile")]),e._v(" の概念は適用されませんが、build configuration は適用されます。たとえば Release ビルドでテストしたい場合は次のとおりです。")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("dotnet "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("test")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-c")]),e._v(" Release\n")])])]),t("p",[e._v("テストは、先ほど示した docker-compose の開発用依存関係を使うよう、すでに設定済みです。")]),e._v(" "),t("p",[e._v("特定のテストだけを実行するには "),t("code",[e._v("--f")]),e._v("（filter）スイッチを使えます。")]),e._v(" "),t("p",[e._v("IDE を使う場合は、テスト実行や構成切り替えについて IDE のドキュメントを参照してください。")]),e._v(" "),t("h2",{attrs:{id:"altcoin-サポート開発"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#altcoin-サポート開発"}},[e._v("#")]),e._v(" Altcoin サポート開発")]),e._v(" "),t("p",[e._v("デフォルトでは、IDE または単純な "),t("code",[e._v("dotnet run")]),e._v(" は "),t("code",[e._v("Debug")]),e._v(" ビルド上の "),t("code",[e._v("Bitcoin")]),e._v(" launch profile を使用します。")]),e._v(" "),t("ul",[t("li",[e._v("これは、BTCPay Server がローカル HTTP ポートで起動し、altcoin サポートなしでビルドされることを意味します。")]),e._v(" "),t("li",[e._v("また、"),t("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver/blob/master/BTCPayServer.Tests/docker-compose.yml",target:"_blank",rel:"noopener noreferrer"}},[e._v("BTCPayServer.Tests/docker-compose.yml"),t("OutboundLink")],1),e._v(" に定義された Bitcoin 専用依存関係へ接続します。")])]),e._v(" "),t("p",[t("strong",[e._v("altcoins サポート付きで開発")]),e._v(" したい場合は、"),t("code",[e._v("Altcoins-Debug")]),e._v(" ビルドで "),t("code",[e._v("Altcoins-HTTPS")]),e._v(" launch profile を使い、"),t("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver/blob/master/BTCPayServer.Tests/docker-compose.altcoins.yml",target:"_blank",rel:"noopener noreferrer"}},[e._v("BTCPayServer.Tests/docker-compose.altcoins.yml"),t("OutboundLink")],1),e._v(" を実行してください。")]),e._v(" "),t("p",[e._v("コマンドラインを使う場合:")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" BTCPayServer.Tests\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("docker-compose")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-f")]),e._v(" docker-compose.altcoins.yml up dev\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v("/BTCPayServer\ndotnet run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-c")]),e._v(" Altcoins-Debug --launch-profile Altcoins-HTTPS\n")])])]),t("p",[e._v("テストの場合:")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" BTCPayServer.Tests\ndotnet "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("test")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-c")]),e._v(" Altcoins-Debug\n")])])]),t("h2",{attrs:{id:"ローカル開発での-https-サポート"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ローカル開発での-https-サポート"}},[e._v("#")]),e._v(" ローカル開発での HTTPS サポート")]),e._v(" "),t("p",[e._v("一部ブラウザのセキュリティ機能を正しく検証するには "),t("strong",[e._v("HTTPS")]),e._v(" が必要な場合があります。")]),e._v(" "),t("p",[e._v("その場合は "),t("code",[e._v("Bitcoin-HTTPS")]),e._v("（または "),t("code",[e._v("Altcoin-HTTPS")]),e._v("）launch profile を使用します。開発用の自己署名証明書が作成されます。")]),e._v(" "),t("p",[e._v("ただし、ブラウザはこの証明書を信頼しないため、デバッグしづらくなることがあります。")]),e._v(" "),t("p",[e._v("次を実行すると、OS にこの開発用証明書を信頼させることができます。")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("dotnet dev-certs https "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--trust")]),e._v("\n")])])]),t("h2",{attrs:{id:"動画"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#動画"}},[e._v("#")]),e._v(" 動画")]),e._v(" "),t("p",[e._v("詳細は次の動画を参照してください。")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://youtube.com/watch?v=ZePbMPSIvHM",target:"_blank",rel:"noopener noreferrer"}},[e._v("How to contribute to BTCPay Server Development (Windows)"),t("OutboundLink")],1),e._v(" by Nicolas Dorier")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://youtube.com/watch?v=j486T_Rk-yw",target:"_blank",rel:"noopener noreferrer"}},[e._v("Setting up BTCPayServer development environment on Linux (Ubuntu)"),t("OutboundLink")],1),e._v(" by RockStarDev")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://youtube.com/watch?v=GWR_CcMsEV0",target:"_blank",rel:"noopener noreferrer"}},[e._v("BTCPay Server Development - Testing pull request, payments (MacOS)"),t("OutboundLink")],1),e._v(" by Pavlenex")])]),e._v(" "),t("p",[e._v("あわせて次のノートも参照してください。")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver/blob/master/BTCPayServer.Tests/README.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("How to get started with development"),t("OutboundLink")],1),e._v(" by Nicolas Dorier (covering relevant docker commands, paying regtest invoices)")])])])}),[],!1,null,null,null);t.default=s.exports}}]);