(window.webpackJsonp=window.webpackJsonp||[]).push([[153],{976:function(e,t,r){"use strict";r.r(t);var a=r(17),s=Object(a.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"electrumx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#electrumx"}},[e._v("#")]),e._v(" ElectrumX")]),e._v(" "),t("p",[e._v("このドキュメントでは、"),t("strong",[e._v("Electrum Wallet を ElectrumX Server に接続する方法")]),e._v("を説明します。")]),e._v(" "),t("p",[t("strong",[e._v("注:")]),e._v(" "),t("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker",target:"_blank",rel:"noopener noreferrer"}},[e._v("BTCPay Server の Docker 版"),t("OutboundLink")],1),e._v("（2019年11月7日以降、version 1.0.3.137）は "),t("a",{attrs:{href:"https://electrumx.readthedocs.io/en/latest/features.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("ElectrumX"),t("OutboundLink")],1),e._v(" との完全統合をサポートしています。ElectrumX は、ローカルの Electrum ウォレットが Bitcoin ブロックチェーンの詳細取得やトランザクションのブロードキャストに使う公開 Electrum サーバーで最も広く利用される実装です。意味とセットアップ方法は以下の Section 2 を参照してください。")]),e._v(" "),t("h2",{attrs:{id:"electrumx-を-btcpay-server-に統合し、electrum-wallet-を接続してプライバシーを高める"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#electrumx-を-btcpay-server-に統合し、electrum-wallet-を接続してプライバシーを高める"}},[e._v("#")]),e._v(" ElectrumX を BTCPay Server に統合し、Electrum Wallet を接続してプライバシーを高める")]),e._v(" "),t("h3",{attrs:{id:"（btcpay-の-docker-版のみ対応）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#（btcpay-の-docker-版のみ対応）"}},[e._v("#")]),e._v(" （BTCPay の Docker 版のみ対応）")]),e._v(" "),t("p",[e._v("進める前に、PC/Mac 上の Electrum ウォレットが、独自の Bitcoin フルノードなしで高速に動作する仕組みを理解しておくことが重要です。実際には、Electrum Wallet は世界中のコミュニティ運営サーバー（Bitcoin フルノード付き）に依存しています。これらは Electrum Servers と呼ばれます。あなたもそのネットワークを強化する側に回れます。")]),e._v(" "),t("p",[e._v("Electrum Wallet の下部にある小さな信号アイコンをクリックすると:")]),e._v(" "),t("figure",[t("img",{attrs:{src:"https://user-images.githubusercontent.com/1388507/68437133-5636c500-01c0-11ea-822c-6e72bd6d60ea.png",alt:"ElectrumWalletMainScreenLight",title:"ElectrumWalletMainScreenLight"}})]),e._v(" "),t("p",[e._v("通常は "),t("code",[e._v("Select Server Automatically")]),e._v(" が有効になっており、接続可能な Electrum サーバー一覧が表示されます:")]),e._v(" "),t("figure",[t("img",{attrs:{src:"https://user-images.githubusercontent.com/1388507/68437521-8a5eb580-01c1-11ea-9ece-0666353a6742.png",alt:"ElectrumWalletServerList",title:"ElectrumWalletServerList"}})]),e._v(" "),t("p",[t("code",[e._v("Select Server Automatically")]),e._v(" を有効にしたまま使うのが最も簡単ですが、Electrum Wallet で行う取引の閲覧やブロードキャストは他者のサーバー経由になります。これはプライバシー上のリスクであり、独自の ElectrumX Server を運用することで軽減できます。")]),e._v(" "),t("h2",{attrs:{id:"section-21-独自-electrumx-server-を有効化する（btcpay-server-の-bitcoin-フルノードと完全統合）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#section-21-独自-electrumx-server-を有効化する（btcpay-server-の-bitcoin-フルノードと完全統合）"}},[e._v("#")]),e._v(" Section 2.1 独自 ElectrumX Server を有効化する（BTCPay Server の Bitcoin フルノードと完全統合）")]),e._v(" "),t("h3",{attrs:{id:"前提条件（必須）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前提条件（必須）"}},[e._v("#")]),e._v(" 前提条件（必須）")]),e._v(" "),t("ol",[t("li",[e._v("Docker のみ: 対応するのは "),t("RouterLink",{attrs:{to:"/Docker/"}},[e._v("BTCPay Server の Docker 版")]),e._v("のみです。")],1),e._v(" "),t("li",[e._v("非プルーニングの BTCPay ノード: BTCPay 実装が "),t("RouterLink",{attrs:{to:"/FAQ/Synchronization/#can-i-skip-the-synchronization"}},[e._v("pruned")]),e._v(" でないことを確認してください（つまり genesis block から同期・保存されていること）。"),t("code",[e._v("opt-save-storage")]),e._v(" の "),t("RouterLink",{attrs:{to:"/Docker/#generated-docker-compose"}},[e._v("Environment Variable")]),e._v(" を使っていないことを確認してください。")],1),e._v(" "),t("li",[e._v("ディスク容量: Docker ボリューム保存先のデバイスに最低 400GB が必要です（このドキュメント執筆時点の2019年11月9日で、フルノード + ElectrumX 有効時に 333GB 使用。今後さらに増加します）。")]),e._v(" "),t("li",[e._v("Additional Fragments: 環境変数設定で使う BTCPay の "),t("RouterLink",{attrs:{to:"/Docker/#environment-variables"}},[e._v("Additional Fragment")]),e._v(" 機能を理解していること。")],1),e._v(" "),t("li",[e._v("サーバーアーキテクチャ: ここで使用する（公式）"),t("a",{attrs:{href:"https://github.com/lukechilds/docker-electrumx",target:"_blank",rel:"noopener noreferrer"}},[e._v("ElectrumX docker"),t("OutboundLink")],1),e._v(" は、x86_64 で動作する BTCPay Server でのみテストされています。現時点では Ubuntu 18.04 と Debian Buster で広く検証済みです。Raspberry Pi（および他アーキテクチャ）向けには十分な検証が行われるまで動作しない可能性があります。")]),e._v(" "),t("li",[e._v("Linux コマンドラインの基本知識があること。")])]),e._v(" "),t("h3",{attrs:{id:"electrumx-server-の有効化は既存の-btcpay-実装にどう影響するか"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#electrumx-server-の有効化は既存の-btcpay-実装にどう影響するか"}},[e._v("#")]),e._v(" ElectrumX Server の有効化は既存の BTCPay 実装にどう影響するか")]),e._v(" "),t("p",[e._v("基本的に、BTCPay Server で ElectrumX を設定する作業はシンプルで、他の実装部分には影響しません。必要条件は上記のみです。"),t("a",{attrs:{href:"https://github.com/lukechilds/docker-electrumx",target:"_blank",rel:"noopener noreferrer"}},[e._v("ElectrumX 公式 docker リリース"),t("OutboundLink")],1),e._v(" は、"),t("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker/blob/master/docker-compose-generator/docker-fragments/opt-add-electrumx.yml",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("opt-add-electumx")]),t("OutboundLink")],1),e._v(" という "),t("RouterLink",{attrs:{to:"/Docker/#generated-docker-compose"}},[e._v("additional fragment")]),e._v(" を有効化することで BTCPay で動作します。この fragment は ElectrumX サーバーを有効化・起動するだけでなく、Bitcoin フルノードで "),t("code",[e._v("txindex=1")]),e._v(" も有効化します。"),t("code",[e._v("txindex=1")]),e._v("（Transaction Index=ON）は、ElectrumX が任意の取引の詳細データをサードパーティ経由なしでブロックチェーンから直接提供するために必要な Bitcoin Core の機能です。")],1),e._v(" "),t("p",[e._v("すでに BTCPay Server を運用していて、これまで "),t("code",[e._v("txindex=1")]),e._v(" を有効にしていなかった場合、インデックス構築に数時間かかることがあります。通常これは問題なく、ダウンタイムも数時間以内で済むはずですが、ノード利用者が少ない夜間に実行することを推奨します。注: インデックスを最初から再構築したい場合は、"),t("code",[e._v("reindex=1")]),e._v(" オプション付きで bitcoind を一度起動してください（警告: "),t("code",[e._v("reindex")]),e._v(" は非常に長時間かかる可能性があり、通常は不要なためデフォルトでは有効化されておらず、このドキュメントの対象外です）。")]),e._v(" "),t("h3",{attrs:{id:"btcpay-で-electrumx-server-を有効化する手順"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#btcpay-で-electrumx-server-を有効化する手順"}},[e._v("#")]),e._v(" BTCPay で ElectrumX Server を有効化する手順")]),e._v(" "),t("p",[e._v("以下は "),t("strong",[e._v("BTCPay ノードで ElectrumX Server を有効化する手順")]),e._v('です。特に、他のカスタムまたは競合する "fragments"（pruning、less-memory など）を使っている場合は、環境に合わせて調整が必要です。繰り返しになりますが、pruned な BTCPay ノードを使用している場合はこの先に進まないでください。')]),e._v(" "),t("ol",[t("li",[t("p",[e._v("ElectrumX Server は TCP ポート 50002 経由で Electrum Wallet からアクセスされます。少なくともローカルネットワーク内の Electrum Wallet（PC または Android）から利用できるよう、このポートを開放してください。必要であればインターネット/WAN 側からの 50002 ポートフォワーディングも設定できます（外部ユーザーがあなたのサーバーを参照可能になります）。")])]),e._v(" "),t("li",[t("p",[e._v("次のコマンドで BTCPay ノードの Docker Additional Fragment を有効化します（以下は LND と ElectrumX を含む新規 BTCPay インストールを想定。必要に応じて "),t("RouterLink",{attrs:{to:"/Docker/#generated-docker-compose"}},[e._v("関連ドキュメント")]),e._v(" を参照して調整してください）。")],1)]),e._v(" "),t("li",[t("p",[e._v("まず "),t("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker#full-installation-for-technical-users",target:"_blank",rel:"noopener noreferrer"}},[e._v("通常の BTCPay Server セットアップ手順"),t("OutboundLink")],1),e._v(" に従って進め、"),t("code",[e._v("cd btcpayserver-docker")]),e._v(" 実行後はリンク先の続きではなく以下の手順を実施してください。すでに BTCPay Server を運用中なら次のステップからで構いません。")])]),e._v(" "),t("li",[t("p",[e._v("環境変数を設定します:")])])]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("BTCPAY_HOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"YOURHOST.com"')]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("NBITCOIN_NETWORK")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"mainnet"')]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("BTCPAYGEN_CRYPTO1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"btc"')]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("BTCPAYGEN_REVERSEPROXY")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"nginx"')]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("BTCPAYGEN_LIGHTNING")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"lnd"')]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("LIGHTNING_ALIAS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"MY_LN"')]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("LETSENCRYPT_EMAIL")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"you@example.com"')]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("BTCPAYGEN_ADDITIONAL_FRAGMENTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"opt-add-electrumx;opt-more-memory"')]),e._v("\n")])])]),t("p",[e._v("必要に合わせて調整すれば、上記は1コマンドとしてまとめて実行できます。このガイドで最重要なのは "),t("code",[e._v('BTCPAYGEN_ADDITIONAL_FRAGMENTS="opt-add-electrumx"')]),e._v(" です。注: "),t("code",[e._v("opt-more-memory")]),e._v(" は削除可能ですが、BTCPay Server に 1GB 超の RAM を割り当てられる環境なら有効化を強く推奨します。ノード同期と ElectrumX の全体パフォーマンスが大きく向上します。")]),e._v(" "),t("ol",{attrs:{start:"5"}},[t("li",[t("p",[e._v("ElectrumX 付きで BTCPay Server をセットアップまたは再設定します:")]),e._v(" "),t("p",[t("code",[e._v("cd ~/BTCPayServer/btcpayserver-docker && . ./btcpay-setup.sh -i")])]),e._v(" "),t("p",[e._v("これで ElectrumX を含む必要な構成がセットアップ（または再セットアップ）され、通常はそのまま動作します。ただし "),t("code",[e._v("txindex")]),e._v(" の同期に最低でも数時間かかります。新規サーバーの場合はハードウェア次第で数日かかることもあります。")])]),e._v(" "),t("li",[t("p",[e._v("ノードの完全同期を待ちます:\nBitcoin Core 同期状態は BTCPay のドメイン先フロントページで確認できます。コマンドラインでは次を使います。")]),e._v(" "),t("p",[t("code",[e._v("docker logs btcpayserver_bitcoind")]),e._v(" - Bitcoin Core のブロックチェーン同期状態（およびエラーを含むノード情報全体）を表示します。")]),e._v(" "),t("p",[t("code",[e._v("docker logs generated_electrumx_1")]),e._v(" - ElectrumX の同期状態を表示します。注: ElectrumX は Bitcoin フルノードの同期完了まで同期を開始しません。完了前のエラー表示は無視できます。")])])]),e._v(" "),t("p",[e._v("Bitcoin と ElectrumX の双方の同期が完了したら次のステップへ進みます。（注: 同期未完了の Electrum サーバーには Electrum Wallet は接続できません）")]),e._v(" "),t("h2",{attrs:{id:"section-22-electrum-wallet（desktop-または-android）を-electrumx-server-に接続する"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#section-22-electrum-wallet（desktop-または-android）を-electrumx-server-に接続する"}},[e._v("#")]),e._v(" Section 2.2 Electrum Wallet（Desktop または Android）を ElectrumX Server に接続する")]),e._v(" "),t("h3",{attrs:{id:"macpclinux-の-electrum-wallet-から-electrumx-に接続する"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#macpclinux-の-electrum-wallet-から-electrumx-に接続する"}},[e._v("#")]),e._v(" Mac/PC/Linux の Electrum Wallet から ElectrumX に接続する")]),e._v(" "),t("p",[e._v('先に全体を読んでから進めてください。Electrum Wallet GUI で手動設定する代わりに、以下の "Protip" だけ実施しても構いません。')]),e._v(" "),t("p",[e._v("Electrum Wallet を開き、下部の信号アイコンをクリックします:")]),e._v(" "),t("figure",[t("img",{attrs:{src:"https://user-images.githubusercontent.com/1388507/68437133-5636c500-01c0-11ea-822c-6e72bd6d60ea.png",alt:"ElectrumWalletMainScreenLight",title:"ElectrumWalletMainScreenLight"}})]),e._v(" "),t("p",[e._v("通常は "),t("code",[e._v("Select Server Automatically")]),e._v(" が有効になっており、接続可能な Electrum サーバー一覧が表示されます:")]),e._v(" "),t("figure",[t("img",{attrs:{src:"https://user-images.githubusercontent.com/1388507/68437521-8a5eb580-01c1-11ea-9ece-0666353a6742.png",alt:"ElectrumWalletServerList",title:"ElectrumWalletServerList"}})]),e._v(" "),t("p",[e._v("ここで "),t("code",[e._v("Select Server Automatically")]),e._v(" をオフにすると、ElectrumX Server の IP アドレス、ドメイン、またはホスト名を入力できるようになります。以下の例ではローカルネットワーク上の ElectrumX サーバー "),t("code",[e._v("192.168.1.3")]),e._v(" を手動入力し（ポートは 50002 のまま）、"),t("code",[e._v("close")]),e._v(" を押します。")]),e._v(" "),t("figure",[t("img",{attrs:{src:"https://user-images.githubusercontent.com/1388507/68496320-4e276580-0252-11ea-8caf-facc8a246d70.png",alt:"EnterElectrumXServerIP",title:"EnterElectrumXServerIP"}})]),e._v(" "),t("p",[e._v("上記が正しく完了し、ノード状態が正常であれば、画像のようにウォレット画面右下の信号が緑になります。これで成功です。")]),e._v(" "),t("figure",[t("img",{attrs:{src:"https://user-images.githubusercontent.com/1388507/68437133-5636c500-01c0-11ea-822c-6e72bd6d60ea.png",alt:"ElectrumWalletMainScreenLight",title:"ElectrumWalletMainScreenLight"}})]),e._v(" "),t("h4",{attrs:{id:"protip-wallet-gui-を開く前に-electrum-wallet-の-config-ファイルを直接設定する方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#protip-wallet-gui-を開く前に-electrum-wallet-の-config-ファイルを直接設定する方法"}},[e._v("#")]),e._v(" Protip - Wallet GUI を開く前に Electrum Wallet の config ファイルを直接設定する方法")]),e._v(" "),t("p",[e._v("Electrum Wallet 起動直後に他サーバーへ接続したくない場合は、GUI を開く前に次を実施してください。")]),e._v(" "),t("p",[e._v("Electrum Wallet フォルダ（場所が不明な場合は"),t("a",{attrs:{href:"https://electrum.readthedocs.io/en/latest/faq.html#where-is-my-wallet-file-located",target:"_blank",rel:"noopener noreferrer"}},[e._v("こちら"),t("OutboundLink")],1),e._v("）で、"),t("code",[e._v("config")]),e._v(" ファイルを開いて以下のように編集します。")]),e._v(" "),t("ol",[t("li",[t("p",[t("code",[e._v('"auto_connect": true,')]),e._v(" を "),t("code",[e._v('"auto_connect": false,')]),e._v(" に変更します。これにより起動時にサードパーティの Electrum サーバーへ自動接続しなくなります（ブロックヘッダーや取引情報取得のための接続を防止）。")])]),e._v(" "),t("li",[t("p",[t("code",[e._v('"oneserver": false,')]),e._v(" を "),t("code",[e._v('"oneserver": true,')]),e._v(" に変更します。すべてのデータ取得を単一サーバーに固定できます。")])]),e._v(" "),t("li",[t("p",[t("code",[e._v('"server": "SOMEIPADDRESS:50002:s",')]),e._v(" を探すか追加し、自分の ElectrumX Server の IP に変更します。上記例なら "),t("code",[e._v('"server": "192.168.1.3:50002:s",')]),e._v(" です。Wallet 起動時のデフォルト接続先として固定されます。")])])]),e._v(" "),t("p",[e._v("この3ステップは任意ですが、Electrum Wallet の接続先を自分のプライベートサーバー1台に固定して完全なプライバシーを得るために推奨されます（"),t("a",{attrs:{href:"https://github.com/chris-belcher/electrum-personal-server#how-to",target:"_blank",rel:"noopener noreferrer"}},[e._v("Reference"),t("OutboundLink")],1),e._v("）。")]),e._v(" "),t("h3",{attrs:{id:"達成できたこと"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#達成できたこと"}},[e._v("#")]),e._v(" 達成できたこと")]),e._v(" "),t("p",[e._v("これで "),t("strong",[e._v("自分専用のプライベート ElectrumX Server")]),e._v(" を運用しています。Electrum Wallet 関連のデータ転送は、他のサードパーティサーバーを経由せず、ElectrumX Server と Bitcoin ブロックチェーンの間で直接行われます。少なくともブロックチェーンクエリ、取引、受取/支払アドレスの観点で、Bitcoin トランザクションのプライバシーを高いレベルで確保できます。")]),e._v(" "),t("h3",{attrs:{id:"トラブルシューティング"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#トラブルシューティング"}},[e._v("#")]),e._v(" トラブルシューティング")]),e._v(" "),t("p",[e._v("手順どおりに設定しても、上記ステップで赤信号（どのサーバーにも未接続）になる場合があります。ほかの有用なトラブルシュート情報があれば、このドキュメントに PR を出す形で追加してください。")]),e._v(" "),t("ul",[t("li",[e._v("赤信号のままの場合は Electrum Wallet を完全終了し、Electrum Wallet フォルダへ移動します（場所が不明な場合は"),t("a",{attrs:{href:"https://electrum.readthedocs.io/en/latest/faq.html#where-is-my-wallet-file-located",target:"_blank",rel:"noopener noreferrer"}},[e._v("こちら"),t("OutboundLink")],1),e._v("）。")])]),e._v(" "),t("p",[e._v("Electrum Wallet フォルダ内（以下は Mac の例）で "),t("code",[e._v("certs")]),e._v(" ディレクトリを開き、接続先サーバーの証明書（この例では "),t("code",[e._v("192.168.1.3")]),e._v("）を見つけてゴミ箱へ移動し削除します。")]),e._v(" "),t("figure",[t("img",{attrs:{src:"https://user-images.githubusercontent.com/1388507/68497330-9a73a500-0254-11ea-9349-71bdb3bd9511.png",alt:"Certs",title:"Certs"}})]),e._v(" "),t("p",[e._v("Electrum Wallet を再起動して ElectrumX サーバーに接続します。サーバー同期が完了していれば、信号は緑になり利用可能です。")])])}),[],!1,null,null,null);t.default=s.exports}}]);