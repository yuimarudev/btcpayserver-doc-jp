(window.webpackJsonp=window.webpackJsonp||[]).push([[127],{933:function(s,t,a){"use strict";a.r(t);var n=a(17),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"拡張手動セットアップ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#拡張手動セットアップ"}},[s._v("#")]),s._v(" 拡張手動セットアップ")]),s._v(" "),t("p",[s._v("このドキュメントでは、"),t("strong",[s._v("BTCPay Server を手動でデプロイ")]),s._v("する手順と、関連する追加コンポーネントを説明します。これらの手順には長時間かかる可能性があります。より短く実践的な方法として、"),t("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker ベースのデプロイ"),t("OutboundLink")],1),s._v("を利用できます。")]),s._v(" "),t("p",[s._v("この手順では、アプリケーションの全コンポーネントをソースからビルドします。これは、特定の監査やセキュリティ要件の場面で利点になることがあります。")]),s._v(" "),t("div",{staticClass:"custom-block danger"},[t("p",{staticClass:"custom-block-title"},[s._v("DANGER")]),s._v(" "),t("h4",{attrs:{id:"本番利用には非推奨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#本番利用には非推奨"}},[s._v("#")]),s._v(" 本番利用には非推奨")]),s._v(" "),t("p",[s._v("手動インストールは、OS 運用と Bitcoin セキュリティに関する十分な知識と経験がない限り、本番利用には推奨されません。不安がある場合は、Docker デプロイ、または他の"),t("RouterLink",{attrs:{to:"/Deployment/"}},[s._v("デプロイオプション")]),s._v("を利用してください。")],1),s._v(" "),t("h4",{attrs:{id:"技術的な素養があり、問題を自力で解決できることが必要です。このデプロイ方法に対してコミュニティから手厚いサポートは提供されません。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#技術的な素養があり、問題を自力で解決できることが必要です。このデプロイ方法に対してコミュニティから手厚いサポートは提供されません。"}},[s._v("#")]),s._v(" 技術的な素養があり、問題を自力で解決できることが必要です。このデプロイ方法に対してコミュニティから手厚いサポートは提供されません。")])]),s._v(" "),t("h2",{attrs:{id:"インストール手順の概要"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#インストール手順の概要"}},[s._v("#")]),s._v(" インストール手順の概要")]),s._v(" "),t("p",[s._v("このページの手順は Ubuntu 20.04 で検証されています。他の Linux ディストリビューションにも適用できるはずです。また、すべてのコンポーネントを同一ホストまたは仮想マシン上に配置する前提になっています。コンポーネントを複数ホストに分離することも可能ですが、この手順では扱いません。")]),s._v(" "),t("p",[s._v("ここではホスト名の例として "),t("code",[s._v("mainnet.demo.btcpayserver.org")]),s._v(" を使用しています。実際には、あなたの BTCPay Server で使用するホスト名に置き換えてください。")]),s._v(" "),t("h3",{attrs:{id:"セキュリティ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#セキュリティ"}},[s._v("#")]),s._v(" セキュリティ")]),s._v(" "),t("p",[s._v("この手順で Bitcoin メインネットに接続する BTCPay Server を構築する場合、最低限ウォレットの仕組みを理解しておく必要があります。以下の 2 つの記事を読み、不明点があれば質問することを強く推奨します。")]),s._v(" "),t("ul",[t("li",[t("RouterLink",{attrs:{to:"/FAQ/Wallet/"}},[s._v("BTCPay ウォレット FAQ")])],1),s._v(" "),t("li",[t("RouterLink",{attrs:{to:"/LightningNetwork/"}},[s._v("Lightning Network と BTCPay（最初のセクション）")])],1)]),s._v(" "),t("p",[s._v("補足として、開放が必要なすべてのポートを含む想定の "),t("code",[s._v("iptables")]),s._v(" ルールと手順を以下に示します。"),t("strong",[s._v("無保証")]),s._v("です。"),t("strong",[s._v("自身を締め出してしまうリスクを含め")]),s._v("、自己責任で利用してください。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" iptables.txt\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# Generated by iptables-save v1.6.1 on Mon May 27 18:48:11 2019\n*filter\n:INPUT ACCEPT [0:0]\n:FORWARD ACCEPT [0:0]\n:OUTPUT ACCEPT [0:0]\n-A INPUT -i lo -j ACCEPT\n-A INPUT -p tcp -m tcp --dport 22 -j ACCEPT     # SSH\n-A INPUT -p tcp -m tcp --dport 80 -j ACCEPT     # BTCPay HTTP\n-A INPUT -p tcp -m tcp --dport 443 -j ACCEPT    # BTCPay HTTPS\n-A INPUT -p tcp -m tcp --dport 8333 -j ACCEPT   # Bitcoind P2P\n-A INPUT -p tcp -m tcp --dport 9735 -j ACCEPT   # Lightning P2P\n-A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT\nCOMMIT\n# Completed on Mon May 27 18:48:11 2019\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" iptables-restore "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" iptables.txt\n")])])]),t("p",[s._v("この時点で SSH セッションが維持されていれば良い兆候です。もし切断されても、ルールは一時的なため、利用可能な手段でサーバーをリモート再起動して再試行できます。")]),s._v(" "),t("p",[s._v("ルールはここまでで一時適用されています。サーバー起動時に毎回自動適用するには "),t("code",[s._v("iptables-persistent")]),s._v(" パッケージを使用します。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" iptables-persistent\n")])])]),t("p",[s._v("後で "),t("code",[s._v("iptables")]),s._v(" ルールを変更し、再起動後も保持したい場合は次のコマンドを使います。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" netfilter-persistent save\n")])])]),t("h2",{attrs:{id:"非特権ユーザー"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#非特権ユーザー"}},[s._v("#")]),s._v(" 非特権ユーザー")]),s._v(" "),t("p",[s._v("この手順では、すべてを "),t("code",[s._v("admin")]),s._v(" という"),t("strong",[s._v("非特権ユーザー")]),s._v("で実行するように構成します。先にこのユーザーを作成してください。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-M")]),s._v(" admin "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("usermod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v(" admin\n")])])]),t("h3",{attrs:{id:"前提条件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前提条件"}},[s._v("#")]),s._v(" 前提条件")]),s._v(" "),t("ul",[t("li",[s._v("Postgresql")]),s._v(" "),t("li",[s._v("Tor")]),s._v(" "),t("li",[s._v("NGINX と Let's Encrypt")])]),s._v(" "),t("h3",{attrs:{id:"アプリケーションコンポーネント"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#アプリケーションコンポーネント"}},[s._v("#")]),s._v(" アプリケーションコンポーネント")]),s._v(" "),t("ul",[t("li",[s._v("Bitcoin Core"),t("sup",[s._v("1,2")])]),s._v(" "),t("li",[s._v("NBXplorer"),t("sup",[s._v("1,2")])]),s._v(" "),t("li",[s._v("BTCPay Server"),t("sup",[s._v("1,2")])]),s._v(" "),t("li",[s._v("Lightning Network Daemon (LND)"),t("sup",[s._v("2")])]),s._v(" "),t("li",[s._v("Ride The Lightning (RTL)"),t("sup",[s._v("2")])])]),s._v(" "),t("p",[t("sup",[s._v("1")]),s._v(" BTCPay Server の最小構成インストールでは、これらだけが必要です。最小構成では機能が制限されます: Lightning 支払い不可、TLS 証明書の自動更新なし、データストアの信頼性低下、NAT 対応力の低下など。")]),s._v(" "),t("p",[t("sup",[s._v("2")]),s._v(" ソースコードからビルド。")]),s._v(" "),t("h2",{attrs:{id:"postgresql"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#postgresql"}},[s._v("#")]),s._v(" Postgresql")]),s._v(" "),t("p",[s._v("BTCPay Server では、既定の SQLite ファイルベースストレージの代わりに "),t("strong",[s._v("Postgresql")]),s._v(" を使用できます。MySQL を使用することも可能です。")]),s._v(" "),t("h5",{attrs:{id:"インストール"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#インストール"}},[s._v("#")]),s._v(" インストール")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" postgresql postgresql-contrib\n")])])]),t("h5",{attrs:{id:"設定"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#設定"}},[s._v("#")]),s._v(" 設定")]),s._v(" "),t("p",[s._v("BTCPay Server の設定セクションで扱います。")]),s._v(" "),t("h5",{attrs:{id:"確認"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#確認"}},[s._v("#")]),s._v(" 確認")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ psql "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--version")]),s._v("\npsql "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("PostgreSQL"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12.2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Ubuntu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12.2")]),s._v("-4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl status postgresql\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" postgres psql\npsql "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12.2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Ubuntu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12.2")]),s._v("-4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v("\nType "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"help"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" help.\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("postgres")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# \\q")]),s._v("\n")])])]),t("h2",{attrs:{id:"tor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tor"}},[s._v("#")]),s._v(" Tor")]),s._v(" "),t("p",[t("strong",[s._v("Tor")]),s._v(" は、プライバシー強化や NAT 越えの補助のために、以下のコンポーネントで利用できます。")]),s._v(" "),t("ul",[t("li",[s._v("Bitcoin Core デーモン")]),s._v(" "),t("li",[s._v("Lightning Network Daemon (LND)")])]),s._v(" "),t("p",[s._v("Bitcoin Core を Tor サポート付きで実行するための追加情報は"),t("a",{attrs:{href:"https://github.com/bitcoin/bitcoin/blob/master/doc/tor.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("こちら"),t("OutboundLink")],1),s._v("です。")]),s._v(" "),t("h5",{attrs:{id:"インストール-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#インストール-2"}},[s._v("#")]),s._v(" インストール")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" tor\n")])])]),t("h5",{attrs:{id:"設定-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#設定-2"}},[s._v("#")]),s._v(" 設定")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/tor/torrc  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# (and uncomment two lines below)")]),s._v("\nControlPort "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9051")]),s._v("\nCookieAuthentication "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart tor\n")])])]),t("p",[s._v("詳細は Bitcoin セクションおよび Lightning Network Daemon セクションで説明します。")]),s._v(" "),t("h5",{attrs:{id:"確認-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#確認-2"}},[s._v("#")]),s._v(" 確認")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ tor "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--version")]),s._v("\nTor version "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.4")]),s._v(".2.7\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-tlnp")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" tor "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# (lines below correspond to the tor control port and SOCKS proxy)")]),s._v("\ntcp        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:9050          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1376")]),s._v("/tor\ntcp        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:9051          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1376")]),s._v("/tor\n")])])]),t("h2",{attrs:{id:"nginx-と-lets-encrypt"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx-と-lets-encrypt"}},[s._v("#")]),s._v(" NGINX と Let's Encrypt")]),s._v(" "),t("p",[t("strong",[s._v("NGINX")]),s._v(" は、BTCPay Server と Ride The Lightning への HTTP リクエストを処理する Web サーバーとして使用します。"),t("strong",[s._v("Let's Encrypt")]),s._v(" と組み合わせることで、BTCPay Server インスタンス向け TLS 証明書の取得と更新をシームレスに行えます。")]),s._v(" "),t("p",[s._v("Let's Encrypt は TLS 証明書の取得と更新を行う無料サービスです。処理全体を自動管理するためのスクリプトも提供されています。")]),s._v(" "),t("h5",{attrs:{id:"インストール-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#インストール-3"}},[s._v("#")]),s._v(" インストール")]),s._v(" "),t("h5",{attrs:{id:"1-nginx-をインストール"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#1-nginx-をインストール"}},[s._v("#")]),s._v(" 1. NGINX をインストール")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nginx\n")])])]),t("h5",{attrs:{id:"2-lets-encrypt-をインストール"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#2-lets-encrypt-をインストール"}},[s._v("#")]),s._v(" 2. Let's Encrypt をインストール")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" certbot python3-certbot-nginx\n")])])]),t("h5",{attrs:{id:"設定-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#設定-3"}},[s._v("#")]),s._v(" 設定")]),s._v(" "),t("h5",{attrs:{id:"1-lets-encrypt-tls-証明書"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#1-lets-encrypt-tls-証明書"}},[s._v("#")]),s._v(" 1. Let's Encrypt TLS 証明書")]),s._v(" "),t("p",[t("strong",[s._v("<your domain name>")]),s._v(" について、サーバーインスタンスの IP アドレスを指す A または AAAA レコードを作成する必要があります。\nサーバーが NAT 配下にある場合は、ポート 80 をインスタンスへフォワードする必要があります。")]),s._v(" "),t("p",[t("strong",[s._v("certbot")]),s._v(" スクリプトは、要求したドメインをホストしている Web サーバー上に特定のファイルが存在するかを確認して動作します。ファイルを取得できない場合、TLS 証明書は発行されません。初回の試行に失敗した場合は定期的に再試行されるか、手動でコマンドを再実行できます。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" certbot "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--nginx")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("your domain name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# (e.g: sudo certbot --nginx -d mainnet.demo.btcpayserver.org)")]),s._v("\n")])])]),t("h5",{attrs:{id:"2-nginx-設定ファイルを追加"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#2-nginx-設定ファイルを追加"}},[s._v("#")]),s._v(" 2. NGINX 設定ファイルを追加")]),s._v(" "),t("p",[s._v("以下の設定ファイルは、BTCPay Server の Docker インストールからコピーしたものです。")]),s._v(" "),t("p",[t("code",[s._v("mainnet.demo.btcpayserver.org")]),s._v(" を検索し、あなた自身のドメイン名に置き換えてください。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/nginx/conf.d/default.conf\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# If we receive X-Forwarded-Proto, pass it through; otherwise, pass along the\n# scheme used to connect to this server\nmap $http_x_forwarded_proto $proxy_x_forwarded_proto {\n  default $http_x_forwarded_proto;\n  ''      $scheme;\n}\n# If we receive X-Forwarded-Port, pass it through; otherwise, pass along the\n# server port the client connected to\nmap $http_x_forwarded_port $proxy_x_forwarded_port {\n  default $http_x_forwarded_port;\n  ''      $server_port;\n}\n# If we receive Upgrade, set Connection to \"upgrade\"; otherwise, delete any\n# Connection header that may have been passed to this server\nmap $http_upgrade $proxy_connection {\n  default upgrade;\n  '' close;\n}\n# Apply fix for very long server names\nserver_names_hash_bucket_size 128;\n# Prevent Nginx Information Disclosure\nserver_tokens off;\n# Default dhparam\n# Set appropriate X-Forwarded-Ssl header\nmap $scheme $proxy_x_forwarded_ssl {\n  default off;\n  https on;\n}\n\ngzip_types text/plain text/css application/javascript application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript;\nlog_format vhost '$host $remote_addr - $remote_user [$time_local] '\n                 '\"$request\" $status $body_bytes_sent '\n                 '\"$http_referer\" \"$http_user_agent\"';\naccess_log off;\n# HTTP 1.1 support\nproxy_http_version 1.1;\nproxy_buffering off;\nproxy_set_header Host $http_host;\nproxy_set_header Upgrade $http_upgrade;\nproxy_set_header Connection $proxy_connection;\nproxy_set_header X-Real-IP $remote_addr;\nproxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\nproxy_set_header X-Forwarded-Proto $proxy_x_forwarded_proto;\nproxy_set_header X-Forwarded-Ssl $proxy_x_forwarded_ssl;\nproxy_set_header X-Forwarded-Port $proxy_x_forwarded_port;\nproxy_buffer_size          128k;\nproxy_buffers              4 256k;\nproxy_busy_buffers_size    256k;\nclient_header_buffer_size 500k;\nlarge_client_header_buffers 4 500k;\n# Mitigate httpoxy attack (see README for details)\nproxy_set_header Proxy \"\";\n\nserver {\n        server_name mainnet.demo.btcpayserver.org;\n        listen 80;\n        access_log /var/log/nginx/access.log vhost;\n        return 301 https://$host$request_uri;\n}\nserver {\n        client_max_body_size 100M;\n        server_name mainnet.demo.btcpayserver.org;\n        listen 443 ssl http2 ;\n        access_log /var/log/nginx/access.log vhost;\n        ssl_protocols TLSv1.2;\n        ssl_ciphers 'ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256';\n        ssl_prefer_server_ciphers on;\n        ssl_session_timeout 5m;\n        ssl_session_cache shared:SSL:50m;\n        ssl_session_tickets off;\n        ssl_certificate /etc/letsencrypt/live/mainnet.demo.btcpayserver.org/fullchain.pem;\n        ssl_certificate_key /etc/letsencrypt/live/mainnet.demo.btcpayserver.org/privkey.pem;\n        ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;\n        ssl_stapling on;\n        ssl_stapling_verify on;\n                ssl_trusted_certificate /etc/letsencrypt/live/mainnet.demo.btcpayserver.org/fullchain.pem;\n        add_header Strict-Transport-Security \"max-age=31536000\" always;\n        #include /etc/nginx/vhost.d/default;\n\n        # Here is the main BTCPay Server application\n        location / {\n                proxy_pass http://127.0.0.1:23000;\n        }\n\n        # Include the next two stanzas if and only if you want to expose your lightning gRPC & RPC interfaces to the internet\n        location /lnrpc.Lightning {\n                grpc_pass grpcs://127.0.0.1:10009;\n        }\n\n        location /lnd-rest/btc/ {\n                rewrite ^/lnd-rest/btc/(.*) /$1 break;\n                proxy_pass https://127.0.0.1:8080/;\n        }\n\n        # Include this stanza if you are planning to set up Ride The Lightning (RTL)\n        location /rtl/ {\n                proxy_pass http://127.0.0.1:3000/rtl/;\n        }\n}\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart nginx\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl status nginx\n")])])]),t("p",[t("code",[s._v("nginx")]),s._v(" の再起動でエラーが出る場合は、次を試してください。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" journalctl "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-xe")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--unit")]),s._v(" nginx\n")])])]),t("h5",{attrs:{id:"確認-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#確認-3"}},[s._v("#")]),s._v(" 確認")]),s._v(" "),t("h5",{attrs:{id:"1-lets-encrypt-を確認"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#1-lets-encrypt-を確認"}},[s._v("#")]),s._v(" 1. Let's Encrypt を確認")]),s._v(" "),t("p",[s._v("Let's Encrypt のスクリプトが正しく動作するように設定を整えるのは少し難しい場合があります。トラブルシューティングに役立つ追加コマンドを以下に示します。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" certbot certificates\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nFound the following certs:\n  Certificate Name: mainnet.demo.btcpayserver.org\n    Domains: mainnet.demo.btcpayserver.org\n    Expiry Date: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("-08-10 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":00:31+00:00 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("VALID: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("79")]),s._v(" days"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    Certificate Path: /etc/letsencrypt/live/mainnet.demo.btcpayserver.org/fullchain.pem\n    Private Key Path: /etc/letsencrypt/live/mainnet.demo.btcpayserver.org/privkey.pem\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/cron.d/certbot "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# (check the cron job exists)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" */12 * * * root "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-x")]),s._v(" /usr/bin/certbot "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" /run/systemd/system "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" perl "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sleep int(rand(43200))'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" certbot "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-q")]),s._v(" renew\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" /var/log/letsencrypt/letsencrypt.log "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# (check for problems)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("-05-22 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":36:36,062:DEBUG:certbot.main:certbot version: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.31")]),s._v(".0\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" certbot renew --dry-run "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# (test renewal)")]),s._v("\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n** DRY RUN: simulating "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'certbot renew'")]),s._v(" close to cert expiry\n**          "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("The "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" certificates below have not been saved."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nCongratulations, all renewals succeeded. The following certs have been renewed:\n  /etc/letsencrypt/live/mainnet.demo.btcpayserver.org/fullchain.pem "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("success"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n** DRY RUN: simulating "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'certbot renew'")]),s._v(" close to cert expiry\n**          "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("The "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" certificates above have not been saved."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n")])])]),t("h5",{attrs:{id:"2-nginx-を確認"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#2-nginx-を確認"}},[s._v("#")]),s._v(" 2. NGINX を確認")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" nginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v("\nnginx version: nginx/1.18.0 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Ubuntu"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-tlnp")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" nginx\ntcp        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:443             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("266275")]),s._v("/nginx: maste\ntcp        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:80              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("266275")]),s._v("/nginx: maste\ntcp6       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" :::443                  :::*                    LISTEN      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("266275")]),s._v("/nginx: maste\ntcp6       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" :::80                   :::*                    LISTEN      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("266275")]),s._v("/nginx: maste\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" journalctl "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-xe")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--unit")]),s._v(" nginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--follow")]),s._v("\n--\n-- A start job "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" unit nginx.service has finished successfully.\n--\n-- The job identifier is "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19471")]),s._v(".\n")])])]),t("p",[s._v("ブラウザで Web サイトを開いてみてください。この時点では "),t("code",[s._v("502 Bad Gateway")]),s._v(" エラーが発生する想定です。接続試行を受信したかどうかは "),t("code",[s._v("nginx")]),s._v(" ログで確認できます。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" /var/log/nginx/access.log\nmainnet.demo.btcpayserver.org "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 - - "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v("/Jul/2020:12:19:57 +0100"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET / HTTP/2.0"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("502")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("552")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.89 Safari/537.36"')]),s._v("\n")])])]),t("p",[s._v("問題がある場合は、"),t("code",[s._v("nginx")]),s._v(" のエラーログも確認してください。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" /var/log/nginx/error.log\n")])])]),t("h2",{attrs:{id:"bitcoin-core"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#bitcoin-core"}},[s._v("#")]),s._v(" Bitcoin Core")]),s._v(" "),t("p",[s._v("BTCPay Server の各コンポーネントが Bitcoin ネットワークに接続するためのゲートウェイです。")]),s._v(" "),t("h5",{attrs:{id:"インストール-4"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#インストール-4"}},[s._v("#")]),s._v(" インストール")]),s._v(" "),t("p",[t("strong",[s._v("Bitcoin Core をソースからビルド")]),s._v("する完全な手順は"),t("a",{attrs:{href:"https://github.com/bitcoin/bitcoin/blob/master/doc/build-unix.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("こちら"),t("OutboundLink")],1),s._v("です。")]),s._v(" "),t("p",[s._v("ソースからビルドしない場合は、署名済みバイナリ配布物を "),t("a",{attrs:{href:"https://bitcoincore.org/en/download/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://bitcoincore.org/en/download/"),t("OutboundLink")],1),s._v(" からダウンロードできます。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://bitcoincore.org/bin/bitcoin-core-0.20.0/bitcoin-0.20.0-x86_64-linux-gnu.tar.gz\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://bitcoincore.org/bin/bitcoin-core-0.20.0/SHA256SUMS.asc\n")])])]),t("h5",{attrs:{id:"1-前提パッケージと依存関係をインストール"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#1-前提パッケージと依存関係をインストール"}},[s._v("#")]),s._v(" 1. 前提パッケージと依存関係をインストール")]),s._v(" "),t("p",[s._v("この手順では、"),t("code",[s._v("BTCPay Server")]),s._v(" に不要なため Bitcoin Core の GUI コンポーネントはビルドしません。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" build-essential libtool autotools-dev automake pkg-config bsdmainutils python3\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" libevent-dev libboost-system-dev libboost-filesystem-dev libboost-test-dev libboost-thread-dev libminiupnpc-dev libzmq3-dev\n")])])]),t("h5",{attrs:{id:"2-ソースを取得してビルド"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#2-ソースを取得してビルド"}},[s._v("#")]),s._v(" 2. ソースを取得してビルド")]),s._v(" "),t("p",[t("code",[s._v("Bitcoin Core")]),s._v(" リポジトリをクローンする前に、最新の安定版を確認してください。簡単な方法は、GitHub リポジトリの「Releases」欄で最新版を確認することです。執筆時点の安定版は "),t("code",[s._v("0.20.0")]),s._v(" です。下記 "),t("code",[s._v("git clone")]),s._v(" コマンドのタグを、ビルドしたい安定版に合わせて調整してください。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" src\n~/src$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--depth")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--branch")]),s._v(" v0.20.0 https://github.com/bitcoin/bitcoin.git\n~/src$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" bitcoin\n")])])]),t("p",[s._v("Berkeley DB 依存関係の特定バージョンをインストールする必要があります。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~/src/bitcoin$ ./contrib/install_db4.sh "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n")])])]),t("p",[t("code",[s._v("autoconf")]),s._v(" スクリプトで make ファイルを生成し、その後ビルドします。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~/src/bitcoin$ ./autogen.sh\n~/src/bitcoin$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("BDB_PREFIX")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/home/admin/src/bitcoin/db4'")]),s._v("\n~/src/bitcoin$ ./configure "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("BDB_LIBS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-L'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BDB_PREFIX}")]),s._v('/lib -ldb_cxx-4.8"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("BDB_CFLAGS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-I'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BDB_PREFIX}")]),s._v('/include"')]),s._v("\n~/src/bitcoin$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\n~/src/bitcoin$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n~/src/bitcoin$ bitcoind "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-version")]),s._v("\nBitcoin Core version v0.20.0\n")])])]),t("h5",{attrs:{id:"3-設定ファイルを作成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#3-設定ファイルを作成"}},[s._v("#")]),s._v(" 3. 設定ファイルを作成")]),s._v(" "),t("p",[t("strong",[s._v("設定ファイル")]),s._v("の例は、Bitcoin Core リポジトリの https://github.com/bitcoin/bitcoin/blob/master/share/examples/bitcoin.conf で参照できます。")]),s._v(" "),t("p",[s._v("用途に合わせて "),t("strong",[s._v("bitcoin.conf ファイル")]),s._v("を作成してください。BTCPay Server に適した例を以下に示します。この設定ではブロックの pruned を行わないため、2019 年 5 月時点で Bitcoin ブロックチェーン用に 235 GB が必要です。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" bitcoin.conf\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("server=1                              # need RPC for btcpay.\nrpcbind=127.0.0.1                     # loopback is default for 0.18.0 but no harm making sure.\nwhitelist=127.0.0.1                   # for nbxplorer.\nrpcallowip=127.0.0.1/32               # loopback is default but again no harm.\nzmqpubrawblock=tcp://127.0.0.1:28332  # needed for lightning.\nzmqpubrawtx=tcp://127.0.0.1:28333     # needed for lightning.\n#prune=5000                           # Recommended if not enough disk space for full 600+GB blockchain.\n")])])]),t("p",[s._v("ファイルを systemd サービスファイルで指定したディレクトリにコピーし、すべてのユーザーに読み取り権限を付与します。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /etc/bitcoin\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" bitcoin.conf /etc/bitcoin\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("644")]),s._v(" /etc/bitcoin/bitcoin.conf\n")])])]),t("h5",{attrs:{id:"5-systemd-サービスを作成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#5-systemd-サービスを作成"}},[s._v("#")]),s._v(" 5. systemd サービスを作成")]),s._v(" "),t("p",[t("strong",[s._v("systemd サービス")]),s._v("ファイルの例は、Bitcoin Core リポジトリの https://raw.githubusercontent.com/bitcoin/bitcoin/master/contrib/init/bitcoind.service にあります。")]),s._v(" "),t("p",[s._v("必要に応じてサービスファイルを編集してください。")]),s._v(" "),t("p",[s._v("以下の例では、新しい "),t("code",[s._v("bitcoin")]),s._v(" ユーザーを作成せずに済むよう、"),t("strong",[s._v("User")]),s._v(" と "),t("strong",[s._v("Group")]),s._v(" を "),t("code",[s._v("admin")]),s._v(" ユーザーに変更しています。システム上の "),t("code",[s._v("admin")]),s._v(" ユーザーを "),t("code",[s._v("BTCPayServer")]),s._v(" 実行用として使う想定であれば妥当な選択です。そうでない場合は、専用の "),t("code",[s._v("bitcoin")]),s._v(" ユーザー作成を検討してください。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" bitcoind.service\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[Unit]\nDescription=Bitcoin daemon\nAfter=network.target\n\n[Service]\nExecStart=/usr/bin/bitcoind -daemon \\\n                            -pid=/run/bitcoind/bitcoind.pid \\\n                            -conf=/etc/bitcoin/bitcoin.conf \\\n                            -datadir=/var/lib/bitcoind\n\n# Make sure the config directory is readable by the service user\nPermissionsStartOnly=true\nExecStartPre=/bin/chgrp admin /etc/bitcoin\n\n# Process management\n####################\n\nType=forking\nPIDFile=/run/bitcoind/bitcoind.pid\nRestart=on-failure\nTimeoutStopSec=600\n\n# Run as admin:admin\nUser=admin\nGroup=admin\n\n# /run/bitcoind\nRuntimeDirectory=bitcoind\nRuntimeDirectoryMode=0710\n\n# /etc/bitcoin\nConfigurationDirectory=bitcoin\nConfigurationDirectoryMode=0710\n\n# /var/lib/bitcoind\nStateDirectory=bitcoind\nStateDirectoryMode=0710\n\n# Hardening measures\n####################\n# Provide a private /tmp and /var/tmp.\nPrivateTmp=true\n\n# Deny access to /home, /root and /run/user\nProtectHome=true\n\n# Mount /usr, /boot/ and /etc read-only for the process.\nProtectSystem=full\n\n# Disallow the process and all of its children to gain\n# new privileges through execve().\nNoNewPrivileges=true\n\n# Use a new /dev namespace only populated with API pseudo devices\n# such as /dev/null, /dev/zero and /dev/random.\nPrivateDevices=true\n\n# Deny the creation of writable and executable memory mappings.\nMemoryDenyWriteExecute=true\n\n[Install]\nWantedBy=multi-user.target\n")])])]),t("p",[s._v("サービスファイルの準備ができたら、以下のコマンドを実行します。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" bitcoind.service /etc/systemd/system\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--now")]),s._v(" bitcoind\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl status bitcoind\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nJul "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(":51:52 ubuntu systemd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Started Bitcoin daemon.\n")])])]),t("p",[s._v("起動時にエラーメッセージが表示された場合は、次でログを確認します。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" journalctl "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-xe")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--unit")]),s._v(" bitcoind\n")])])]),t("h5",{attrs:{id:"6-bitcoind-cookie-ファイルへのシンボリックリンクを作成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#6-bitcoind-cookie-ファイルへのシンボリックリンクを作成"}},[s._v("#")]),s._v(" 6. bitcoind cookie ファイルへのシンボリックリンクを作成")]),s._v(" "),t("p",[t("code",[s._v("bitcoin-cli")]),s._v(" クライアントが RPC 呼び出しを行うには "),t("code",[s._v("bitcoind")]),s._v(" への認証が必要です。最も簡単な方法は、cookie ファイルへのシンボリックリンクを作成することです。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" /var/lib/bitcoind/.cookie .bitcoin/.cookie\n")])])]),t("p",[s._v("この手順は必須ではありませんが、実施しない場合は以下のように "),t("code",[s._v("bitcoin-cli")]),s._v(" コマンドごとに cookie ファイルのパス指定が必要になります。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ bitcoin-cli "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rpccookiefile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/bitcoind/.cookie getblockchaininfo\n")])])]),t("h5",{attrs:{id:"確認-4"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#確認-4"}},[s._v("#")]),s._v(" 確認")]),s._v(" "),t("p",[s._v("Bitcoin のブロックチェーン同期には、数時間から数日かかる場合があります。状態確認には以下のコマンドを必要に応じて使用してください。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl status bitcoind\nActive: active "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("running"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" since Sun "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-07-26 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(":51:52 IST"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" 2min 47s ago\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" /var/lib/bitcoind/debug.log "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-07-26T20:55:09Z UpdateTip: new "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("best")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("0000000000000361c37dfb6fa905ef967b95411fa96f7dcb4eca5dd4434d9e59 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("height")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("126732")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("0x00000001 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("log2_work")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("62.952182")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tx")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("560114")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("date")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2011-05-25T21:26:08Z'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("progress")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.001018")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cache")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("43")]),s._v(".6MiB"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("291168txo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ bitcoin-cli getblockchaininfo\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"chain"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"main"')]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"blocks"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("133015")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"headers"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("640929")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bestblockhash"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0000000000000e81b67de8d61eab726f40585bed954b1dd59f86ab10e4e55398"')]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"difficulty"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("876954.4935135372")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mediantime"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1308897947")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"verificationprogress"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.001530462018729556")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[t("code",[s._v("verificationprogress")]),s._v(" が "),t("code",[s._v("0.99..")]),s._v(" または "),t("code",[s._v("1.0")]),s._v(" になれば、ノードの同期は完了しています。念のため、"),t("a",{attrs:{href:"https://blockstream.info/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://blockstream.info/"),t("OutboundLink")],1),s._v(" のような公開ブロックエクスプローラーで最新の "),t("code",[s._v("Bitcoin")]),s._v(" ブロックを確認し、"),t("code",[s._v("bitcoin-cli getblockchaininfo")]),s._v(" の "),t("code",[s._v("blocks")]),s._v(" 値と比較することもできます。")]),s._v(" "),t("h5",{attrs:{id:"tor-と-bitcoin-の確認"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tor-と-bitcoin-の確認"}},[s._v("#")]),s._v(" Tor と Bitcoin の確認")]),s._v(" "),t("p",[s._v("Bitcoin Daemon より先に Tor をインストールしていれば、自動的に登録されて torv2 onion アドレスで待ち受けを開始しているはずです（torv3 onion アドレス対応は"),t("a",{attrs:{href:"https://github.com/bitcoin/bitcoin/issues/18884",target:"_blank",rel:"noopener noreferrer"}},[s._v("進行中"),t("OutboundLink")],1),s._v("です）。")]),s._v(" "),t("p",[s._v("Bitcoin Daemon の torv2 アドレスを確認する最も簡単な方法は "),t("code",[s._v("bitcoin-cli")]),s._v(" を使うことです。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("bitcoin-cli getnetworkinfo\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"version"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200100")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"subversion"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/Satoshi:0.20.1/"')]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"protocolversion"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("70015")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localservices"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0000000000000409"')]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localaddresses"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"address"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.11.4"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"port"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8333")]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"score"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"address"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"v5j6hfz4xafmeckf.onion"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"port"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8333")]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"score"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("156")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"warnings"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("別の方法として、Bitcoin daemon のログファイルを検索することもできます。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /var/lib/bitcoind/debug.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" onion\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("-05-23T18:24:22Z tor: Got "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" ID 4d4al7v4hj5p7bb6, advertising "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" 4d4al7v4hj5p7bb6.onion:8333\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("-05-23T18:24:22Z AddLocal"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("4d4al7v4hj5p7bb6.onion:8333,4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("p",[s._v("問題があり、ログファイル内に onion アドレスが見つからない場合は、Tor 関連のエラーメッセージを確認してください。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /var/lib/bitcoind/debug.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" tor\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-07-27T08:03:28Z torcontrol thread start\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-07-27T08:03:28Z tor: Authentication cookie /run/tor/control.authcookie could not be opened "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("check permissions"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("p",[s._v("上記のエラーメッセージは、Bitcoin サービス実行ユーザーが Tor の認証 cookie ファイルを読み取れない場合に発生することがあります（詳細は"),t("a",{attrs:{href:"https://github.com/bitcoin/bitcoin/blob/master/doc/tor.md#3-automatically-listen-on-tor",target:"_blank",rel:"noopener noreferrer"}},[s._v("こちら"),t("OutboundLink")],1),s._v("）。このエラーを解消するには、対象ユーザーを "),t("code",[s._v("debian-tor")]),s._v(" グループに追加してください。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("usermod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-G")]),s._v(" debian-tor admin\n")])])]),t("p",[s._v("onion アドレスを変更するには:")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" /var/lib/bitcoind/onion_private_key\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart bitcoind\n~$ bitcoin-cli getnetworkinfo "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" onion\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"onion"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"address"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"qud5iwbntqxlfwjv.onion"')]),s._v(",\n")])])]),t("p",[s._v("Tor をインストールしたリモートホストから onion アドレスを確認するには:")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ torsocks "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--shell")]),s._v("\n~$ telnet 4d4al7v4hj5p7bb6.onion "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8333")]),s._v("\n Trying "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.42")]),s._v(".42.0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n Connected to "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.42")]),s._v(".42.0.\n Escape character is "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^]'")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n~$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n")])])]),t("p",[s._v("別の "),t("code",[s._v("bitcoind")]),s._v(" インスタンスを新しいノードへ接続するには:")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ bitcoin-cli addnode "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"4d4al7v4hj5p7bb6.onion"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"add"')]),s._v("\n~$ bitcoin-cli getaddednodeinfo\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"addednode"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"4d4al7v4hj5p7bb6.onion"')]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"connected"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true,\n   "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"addresses"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"address"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"4d4al7v4hj5p7bb6.onion:8333"')]),s._v(",\n       "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"connected"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"outbound"')]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h2",{attrs:{id:"nbxplorer"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nbxplorer"}},[s._v("#")]),s._v(" NBXplorer")]),s._v(" "),t("p",[t("strong",[s._v("NBXplorer")]),s._v(" は、BTCPay Server に関連するトランザクションを Bitcoin ブロックチェーン上で監視する dotnet core アプリケーションです。")]),s._v(" "),t("h5",{attrs:{id:"インストール-5"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#インストール-5"}},[s._v("#")]),s._v(" インストール")]),s._v(" "),t("h5",{attrs:{id:"1-net-80-sdk-をインストール"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#1-net-80-sdk-をインストール"}},[s._v("#")]),s._v(" 1. .NET 8.0 SDK をインストール")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://docs.microsoft.com/en-us/dotnet/core/install/linux-ubuntu#2004-",target:"_blank",rel:"noopener noreferrer"}},[s._v("インストール手順に従ってください"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Add Microsoft package repository")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-O")]),s._v(" packages-microsoft-prod.deb\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" dpkg "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" packages-microsoft-prod.deb\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" packages-microsoft-prod.deb\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Install the SDK")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" apt-transport-https\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" dotnet-sdk-8.0\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Check")]),s._v("\ndotnet "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--version")]),s._v("\n")])])]),t("h5",{attrs:{id:"2-nbxplorer-をビルド"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#2-nbxplorer-をビルド"}},[s._v("#")]),s._v(" 2. NBXplorer をビルド")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" src"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" src\n~/src$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/dgarage/NBXplorer\n~/src$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" NBXplorer\n~/src/NBXplorer$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" checkout "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" tag "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--sort")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-version:refname")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'match($0, /^v[0-9]+\\./)'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("head")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n~/src/NBXplorer$ ./build.sh\n")])])]),t("h5",{attrs:{id:"3-postgresql-データベースを作成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#3-postgresql-データベースを作成"}},[s._v("#")]),s._v(" 3. Postgresql データベースを作成")]),s._v(" "),t("p",[s._v("NBXplorer は "),t("code",[s._v("--dbtrie")]),s._v(" によるローカルデータベース保存にも対応していますが、これは非推奨です。ここでは "),t("strong",[s._v("Postgresql")]),s._v(" で NBXplorer 用のデータベースとユーザーを作成する方法を示します。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" postgres psql\n")])])]),t("p",[s._v("次を実行します。")]),s._v(" "),t("div",{staticClass:"language-SQL extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DATABASE")]),s._v(" nbxplorer TEMPLATE "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'template0'")]),s._v(" LC_CTYPE "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'C'")]),s._v(" LC_COLLATE "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'C'")]),s._v(" ENCODING "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'UTF8'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" nbxplorer "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WITH")]),s._v(" ENCRYPTED PASSWORD "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'urpassword'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIVILEGES")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DATABASE")]),s._v(" nbxplorer "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" nbxplorer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("終了します。")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("postgres=#\\q\n")])])]),t("h5",{attrs:{id:"4-設定ファイルを作成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#4-設定ファイルを作成"}},[s._v("#")]),s._v(" 4. 設定ファイルを作成")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" nbxplorer.config\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("### Database ###\npostgres=User ID=nbxplorer;Password=urpassword;Application Name=nbxplorer;MaxPoolSize=20;Host=localhost;Port=5432;Database=nbxplorer;\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /etc/nbxplorer\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" nbxplorer.config /etc/nbxplorer\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("644")]),s._v(" /etc/nbxplorer/nbxplorer.config\n")])])]),t("p",[s._v("注: 以前 NBXplorer で "),t("code",[s._v("dbtrie")]),s._v(" バックエンドを使っていて postgres に切り替えたい場合は、"),t("a",{attrs:{href:"https://github.com/dgarage/NBXplorer/blob/master/docs/Postgres-Migration.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("このドキュメント"),t("OutboundLink")],1),s._v("を参照してください。")]),s._v(" "),t("h5",{attrs:{id:"5-systemd-サービスを作成-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#5-systemd-サービスを作成-2"}},[s._v("#")]),s._v(" 5. systemd サービスを作成")]),s._v(" "),t("p",[s._v("以下に "),t("strong",[s._v("systemd サービス")]),s._v("ファイルの例を示します。パス、User、Group は環境に合わせて調整してください。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" nbxplorer.service\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[Unit]\nDescription=NBXplorer daemon\nRequires=bitcoind.service\nAfter=bitcoind.service\n\n[Service]\nWorkingDirectory=/home/admin/src/NBXplorer\nExecStart=/home/admin/src/NBXplorer/run.sh --conf=/etc/nbxplorer/nbxplorer.config\nUser=admin\nGroup=admin\nType=simple\nPIDFile=/run/nbxplorer/nbxplorer.pid\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" nbxplorer.service /etc/systemd/system\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--now")]),s._v(" nbxplorer\n")])])]),t("h5",{attrs:{id:"確認-5"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#確認-5"}},[s._v("#")]),s._v(" 確認")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" journalctl "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-xe")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--unit")]),s._v(" nbxplorer "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--follow")]),s._v("\nMay "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":13:35 btc run.sh"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8065")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": info: Configuration:  Data Directory: /home/admin/.nbxplorer/Main\nMay "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":13:35 btc run.sh"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8065")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": info: Configuration:  Configuration File: /home/admin/.nbxplorer/Main/settings.config\nMay "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":13:35 btc run.sh"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8065")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": info: Configuration:  Network: Mainnet\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nMay "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":20:04 btc run.sh"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8065")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": info: Events:         BTC: New block 0000000000000000000c405ba5df5f5533359a4393247a0c52d26c458d4dd989 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("577449")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("p",[s._v("正しく起動しない場合はサービスを停止し、アプリケーションを直接実行してエラーメッセージを確認します。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl stop nbxplorer\n~$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pushd")]),s._v(" ./src/NBXplorer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" ./run.sh"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("popd")]),s._v("\n")])])]),t("h5",{attrs:{id:"更新"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#更新"}},[s._v("#")]),s._v(" 更新")]),s._v(" "),t("p",[s._v("更新によって不具合が起こる可能性があります。本番稼働中のシステムでは注意してください。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Stop the service")]),s._v("\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl stop nbxplorer\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Checkout and build latest tag")]),s._v("\n~$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pushd")]),s._v(" ~/src/NBXplorer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" fetch "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--tags")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" checkout "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" tag "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--sort")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-version:refname")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'match($0, /^v[0-9]+\\./)'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("head")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" ./build.sh"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("popd")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Restart the service")]),s._v("\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl start nbxplorer\n")])])]),t("h2",{attrs:{id:"btcpay-server"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#btcpay-server"}},[s._v("#")]),s._v(" BTCPay Server")]),s._v(" "),t("p",[s._v("NBXplorer と同様に、BTCPay Server も .NET Core アプリケーションです。以下のインストール手順は .NET Core が事前にインストール済みである前提です。")]),s._v(" "),t("h5",{attrs:{id:"インストール-6"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#インストール-6"}},[s._v("#")]),s._v(" インストール")]),s._v(" "),t("h5",{attrs:{id:"1-btcpay-server-をビルド"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#1-btcpay-server-をビルド"}},[s._v("#")]),s._v(" 1. BTCPay Server をビルド")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" src"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" src\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Clone the repository")]),s._v("\n~/src$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/btcpayserver/btcpayserver.git\n~/src$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" btcpayserver\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Checkout latest tag")]),s._v("\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" checkout "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" tag "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--sort")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-version:refname")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'match($0, /^v[0-9]+\\.[0-9]+\\.[0-9]+$/)'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("head")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Build the app")]),s._v("\n~/src/btcpayserver$ ./build.sh\n")])])]),t("h5",{attrs:{id:"2-postgresql-データベースを作成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#2-postgresql-データベースを作成"}},[s._v("#")]),s._v(" 2. Postgresql データベースを作成")]),s._v(" "),t("p",[s._v("BTCPay Server は既定で 1 つの SQLite ファイルにデータを保存します。より堅牢な選択肢として "),t("strong",[s._v("Postgresql")]),s._v(" を使う場合は、対応するデータベースとユーザーを作成する必要があります。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" postgres psql\n")])])]),t("p",[s._v("次を実行します。")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DATABASE")]),s._v(" btcpay TEMPLATE "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'template0'")]),s._v(" LC_CTYPE "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'C'")]),s._v(" LC_COLLATE "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'C'")]),s._v(" ENCODING "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'UTF8'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" btcpay "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WITH")]),s._v(" ENCRYPTED PASSWORD "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'urpassword'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIVILEGES")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DATABASE")]),s._v(" btcpay "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" btcpay"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("終了します。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("postgres")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#\\q")]),s._v("\n")])])]),t("h5",{attrs:{id:"3-設定ファイルを作成-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#3-設定ファイルを作成-2"}},[s._v("#")]),s._v(" 3. 設定ファイルを作成")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" btcpay.config\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("### Database ###\npostgres=User ID=btcpay;Password=urpassword;Application Name=btcpayserver;Host=localhost;Port=5432;Database=btcpay;\nexplorer.postgres=User ID=nbxplorer;Password=urpassword;Application Name=nbxplorer;MaxPoolSize=20;Host=localhost;Port=5432;Database=nbxplorer;\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /etc/btcpay\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" btcpay.config /etc/btcpay\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("644")]),s._v(" /etc/btcpay/btcpay.config\n")])])]),t("p",[s._v("代替として、設定ファイル、環境変数（"),t("code",[s._v("BTCPAY_EXPLORERPOSTGRES")]),s._v(" と "),t("code",[s._v("BTCPAY_POSTGRES")]),s._v("）、またはコマンドライン引数（"),t("code",[s._v("--explorerpostgres")]),s._v(" と "),t("code",[s._v("--postgres")]),s._v("）で BTCPay Server を起動することもできます。")]),s._v(" "),t("h5",{attrs:{id:"4-systemd-サービスを作成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#4-systemd-サービスを作成"}},[s._v("#")]),s._v(" 4. systemd サービスを作成")]),s._v(" "),t("p",[s._v("以下に "),t("strong",[s._v("systemd サービス")]),s._v("ファイルの例を示します。パス、User、Group は環境に合わせて調整してください。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" btcpay.service\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('[Unit]\nDescription=BTCPay Server\nRequires=nbxplorer.service\nAfter=nbxplorer.service\n\n[Service]\nWorkingDirectory=/home/admin/src/btcpayserver\nEnvironment=BTCPAY_BTCEXTERNALRTL="server=https://mainnet.demo.btcpayserver.org/rtl;cookiefile=/var/lib/rtl/.cookie"\nExecStart=/home/admin/src/btcpayserver/run.sh --conf=/etc/btcpay/btcpay.config\nUser=admin\nGroup=admin\nType=simple\nPIDFile=/run/btcpayserver/btcpayserver.pid\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\n')])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" btcpay.service /etc/systemd/system\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--now")]),s._v(" btcpay\n")])])]),t("h5",{attrs:{id:"確認-6"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#確認-6"}},[s._v("#")]),s._v(" 確認")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" journalctl "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-xe")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--unit")]),s._v(" btcpay "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--follow")]),s._v("\n-- The start-up result is RESULT.\nMay "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":01:25 btc run.sh"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10263")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": info: Configuration:  Data Directory: /home/admin/.btcpayserver/Main\nMay "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":01:25 btc run.sh"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10263")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": info: Configuration:  Configuration File: /etc/btcpay/btcpay.config\nMay "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":01:25 btc run.sh"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10263")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": info: Configuration:  Network: Mainnet\n")])])]),t("p",[s._v("正しく起動しない場合はサービスを停止し、アプリケーションを直接実行してエラーメッセージを確認します。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl stop btcpay\n~$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pushd")]),s._v(" ~/src/btcpayserver"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" ./run.sh "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--conf")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/btcpay/btcpay.config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("popd")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("データベース内の情報を確認する例です。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" postgres psql\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("postgres")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# \\connect btcpay;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("btcpay")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# \\dt")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("btcpay")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# select * from "Invoices";')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("btcpay")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# \\q")]),s._v("\n")])])]),t("p",[s._v("この時点でブラウザから BTCPay Server のドメインを開くと、「Welcome to your BTCPay Server」ページが表示されるはずです。\nLightning Node を使用しない場合は、ここでインストール完了です。")]),s._v(" "),t("h5",{attrs:{id:"更新-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#更新-2"}},[s._v("#")]),s._v(" 更新")]),s._v(" "),t("p",[s._v("更新によって不具合が起こる可能性があります。本番稼働中のシステムでは注意してください。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Stop the service")]),s._v("\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl stop btcpay\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Checkout and build latest tag")]),s._v("\n~$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pushd")]),s._v(" ~/src/btcpayserver"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" fetch "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--tags")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" checkout "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" tag "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--sort")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-version:refname")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'match($0, /^v[0-9]+\\.[0-9]+\\.[0-9]+$/)'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("head")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" ./build.sh"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("popd")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Restart the service")]),s._v("\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl start btcpay\n")])])]),t("h2",{attrs:{id:"lightning-network-daemon-lnd"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lightning-network-daemon-lnd"}},[s._v("#")]),s._v(" Lightning Network Daemon (LND)")]),s._v(" "),t("h5",{attrs:{id:"インストール-7"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#インストール-7"}},[s._v("#")]),s._v(" インストール")]),s._v(" "),t("p",[s._v("完全な"),t("a",{attrs:{href:"https://github.com/lightningnetwork/lnd/blob/master/docs/INSTALL.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("手順"),t("OutboundLink")],1),s._v("はリンク先を参照してください。")]),s._v(" "),t("h5",{attrs:{id:"1-go-をインストール"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#1-go-をインストール"}},[s._v("#")]),s._v(" 1. Go をインストール")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://dl.google.com/go/go1.13.linux-amd64.tar.gz\n~$ sha256sum go1.13.linux-amd64.tar.gz\n68a2297eb099d1a76097905a2ce334e3155004ec08cdea85f24527be3c48e856  go1.13.linux-amd64.tar.gz\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-C")]),s._v(" /usr/local "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-xzf")]),s._v(" go1.13.linux-amd64.tar.gz\n~$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v(":/usr/local/go/bin\n~$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOPATH")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=~")]),s._v("/gocode\n~$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$GOPATH")]),s._v("/bin\n~$ go version\ngo version go1.13 linux/amd64\n")])])]),t("h5",{attrs:{id:"2-lnd-をビルドしてインストール"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#2-lnd-をビルドしてインストール"}},[s._v("#")]),s._v(" 2. LND をビルドしてインストール")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" src"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" src\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/lightningnetwork/lnd\n~$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" lnd\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# installs to a directory in $GOPATH/bin")]),s._v("\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$GOPATH")]),s._v("/bin/lnd "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$GOPATH")]),s._v("/bin/lncli /usr/bin\n~$ lnd "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--version")]),s._v("\nlnd version "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.10")]),s._v(".99-beta "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("commit")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("clock/v1.0.0-229-ge64e71d86dc1ac716c30a80f85a22e8fb544697f\n")])])]),t("h5",{attrs:{id:"3-bitcoin-設定ファイルへのシンボリックリンクを作成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#3-bitcoin-設定ファイルへのシンボリックリンクを作成"}},[s._v("#")]),s._v(" 3. Bitcoin 設定ファイルへのシンボリックリンクを作成")]),s._v(" "),t("p",[s._v("lnd は必要な RPC と zeromq の情報を取得するため、特定の場所にある "),t("code",[s._v("bitcoin.conf")]),s._v(" を参照します。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" ~/.bitcoin/bitcoin.conf /etc/bitcoin/bitcoin.conf\n")])])]),t("h5",{attrs:{id:"4-設定ファイルを作成-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#4-設定ファイルを作成-2"}},[s._v("#")]),s._v(" 4. 設定ファイルを作成")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" lnd.conf\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[Application Options]\ndatadir=/var/lib/lnd/data\ntlscertpath=/var/lib/lnd/tls.cert\ntlskeypath=/var/lib/lnd/tls.key\nlogdir=/var/lib/lnd/logs\nmaxlogfiles=3\nmaxlogfilesize=10\n#externalip=1.1.1.1 # change to your public IP address if required.\nalias=i_luv_btcpay\nlisten=0.0.0.0:9735\n\n[Bitcoin]\nbitcoin.active=1\nbitcoin.node=bitcoind\nbitcoin.mainnet=true\n\n[tor]\ntor.active=true\ntor.v3=true\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /etc/lnd\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /var/lib/lnd\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" admin:admin "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-R")]),s._v(" /var/lib/lnd\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" lnd.conf /etc/lnd\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("644")]),s._v(" /etc/lnd/lnd.conf\n")])])]),t("h5",{attrs:{id:"5-systemd-サービスを作成-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#5-systemd-サービスを作成-3"}},[s._v("#")]),s._v(" 5. systemd サービスを作成")]),s._v(" "),t("p",[s._v("以下に "),t("strong",[s._v("systemd サービス")]),s._v("ファイルの例を示します。パス、User、Group は環境に合わせて調整してください。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" lnd.service\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[Unit]\nDescription=LND Lightning Network Daemon\nRequires=bitcoind.service\nAfter=bitcoind.service\n\n[Service]\nExecStart=/usr/bin/lnd --configfile=/etc/lnd/lnd.conf\nExecStop=/usr/bin/lncli --lnddir /var/lib/lnd stop\nPIDFile= /run/lnd/lnd.pid\n\nUser=admin\nGroup=admin\n\nType=simple\nKillMode=process\nTimeoutStartSec=60\nTimeoutStopSec=60\nRestart=always\nRestartSec=60\n\n[Install]\nWantedBy=multi-user.target\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" lnd.service /etc/systemd/system\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--now")]),s._v(" lnd\n")])])]),t("h5",{attrs:{id:"設定-4"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#設定-4"}},[s._v("#")]),s._v(" 設定")]),s._v(" "),t("div",{staticClass:"custom-block danger"},[t("p",{staticClass:"custom-block-title"},[s._v("DANGER")]),s._v(" "),t("p",[t("strong",[s._v("Bitcoin Lightning daemon の実行には、BTCPay Server 上のホットウォレットが必要です。")])])]),s._v(" "),t("p",[s._v("Bitcoin ではプロトコルの進化により、決定的鍵導出によってウォレット鍵を BTCPay Server とは別の場所に保管できます。Lightning daemon にはこの仕組みがありません。Lightning チャネルにコミットまたは受け取った Bitcoin は、BTCPay Server 上にある秘密鍵で管理されます。")]),s._v(" "),t("h5",{attrs:{id:"1-lnd-データディレクトリへのシンボリックリンクを作成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#1-lnd-データディレクトリへのシンボリックリンクを作成"}},[s._v("#")]),s._v(" 1. lnd データディレクトリへのシンボリックリンクを作成")]),s._v(" "),t("p",[s._v("上記のインストール手順では、既定の "),t("code",[s._v("/home/user/.lnd")]),s._v(" ではなく "),t("code",[s._v("/var/lib/lnd")]),s._v(" をデータディレクトリとして使用しています。"),t("code",[s._v("lncli")]),s._v(" クライアント利用時の入力を減らすため、ディレクトリへのシンボリックリンクを作成しておくと便利です。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" /var/lib/lnd .lnd\n")])])]),t("h5",{attrs:{id:"2-lightning-ウォレットを作成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#2-lightning-ウォレットを作成"}},[s._v("#")]),s._v(" 2. Lightning ウォレットを作成")]),s._v(" "),t("p",[s._v("lnd を初めて起動するときは、新しいウォレットを作成し、バックアップ用シードを安全に記録する必要があります（シードを第三者に知られると資金を盗まれる可能性があるため、安全に保管してください）。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ lncli create\nInput wallet password:\nConfirm password:\n\nDo you have an existing cipher seed mnemonic you want to use? "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Enter y/n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": n\n\nYour cipher seed can optionally be encrypted.\nInput your passphrase "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" you wish to encrypt it "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("or press enter to proceed without a cipher seed passphrase"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n\nGenerating fresh cipher seed"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("YOU MUST WRITE DOWN THIS SEED TO BE ABLE TO RESTORE THE WALLET"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n---------------BEGIN LND CIPHER SEED---------------\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". above      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(". catch    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(". start     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(". tape\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(". sound      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(". friend   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(". water     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(". royal\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(". solid     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(". poet    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(". wisdom   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(". match\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(". virtual   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(". zero    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(". slender  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(". thrive\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(". idle      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(". catch   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(". robot    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(". clay\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(". resemble  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(". angry   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(". work     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(". "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("until")]),s._v("\n---------------END LND CIPHER SEED-----------------\n\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("YOU MUST WRITE DOWN THIS SEED TO BE ABLE TO RESTORE THE WALLET"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n\nlnd successfully initialized"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n")])])]),t("p",[s._v("前の手順でシンボリックディレクトリリンクを"),t("strong",[s._v("作成していない")]),s._v("場合は、次のコマンドを使用します。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("lncli "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--lnddir")]),s._v(" /var/lib/lnd create\n")])])]),t("h5",{attrs:{id:"3-ウォレットをアンロック"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#3-ウォレットをアンロック"}},[s._v("#")]),s._v(" 3. ウォレットをアンロック")]),s._v(" "),t("p",[s._v("lnd を再起動するたびに、ウォレットの"),t("strong",[s._v("アンロックが必要")]),s._v("です。無人運用を想定した BTCPay Server には理想的ではありませんが、Lightning はまだ発展途上です。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ lncli unlock\n")])])]),t("h5",{attrs:{id:"確認-7"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#確認-7"}},[s._v("#")]),s._v(" 確認")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ lncli getinfo\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"version"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.10.99-beta commit=clock/v1.0.0-229-ge64e71d86dc1ac716c30a80f85a22e8fb544697f"')]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"commit_hash"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"e64e71d86dc1ac716c30a80f85a22e8fb544697f"')]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("サービスを確認します。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" journalctl "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-xe")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--unit")]),s._v(" lnd "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--follow")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nJul "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":46:29 ubuntu lnd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("654474")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-07-27 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":46:29.909 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INF"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" DISC: Attempting to bootstrap with: BOLT-0010 DNS Seed: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nodes.lightning.directory soa.nodes.lightning.directory"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("lseed.bitcoinstats.com "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nJul "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":49:41 ubuntu lnd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("654474")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-07-27 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":49:41.939 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INF"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" DISC: Attempting to bootstrap with: Authenticated Channel Graph\nJul "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":49:41 ubuntu lnd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("654474")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-07-27 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":49:41.940 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ERR"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" SRVR: Unable to retrieve initial bootstrap peers: no addresses found\n")])])]),t("p",[t("code",[s._v("BTCPay Server")]),s._v(" で使用する "),t("strong",[s._v("Lightning Node 接続文字列")]),s._v(" は次のとおりです。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("lnd-rest"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("server")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://127.0.0.1:8080/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("macaroonfilepath")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/home/admin/.lnd/data/chain/bitcoin/mainnet/admin.macaroon"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("allowinsecure")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n")])])]),t("h5",{attrs:{id:"lnd-を内部ノードとして追加"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lnd-を内部ノードとして追加"}},[s._v("#")]),s._v(" LND を内部ノードとして追加")]),s._v(" "),t("p",[s._v("LND を内部ノードとして追加するには、"),t("code",[s._v("btcpay.config")]),s._v(" ファイルを編集します。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc/btcpay\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" btcpay.config\n")])])]),t("p",[s._v("データベース設定の直下に、"),t("code",[s._v("BTC.lightning")]),s._v(" 設定を追加します。")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("### Lightning ###\nBTC.lightning=type=lnd-rest;server=https://127.0.0.1:8080/;macaroonfilepath=/home/admin/.lnd/data/chain/bitcoin/mainnet/admin.macaroon;allowinsecure=true\n")])])]),t("p",[s._v("接続文字列の詳細は、BTCPay Server の Lightning ノード接続設定画面にある「Use custom node」ビューを参照してください。")]),s._v(" "),t("p",[s._v("設定変更を反映するには、BTCPay Server を再起動する必要があります。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart btcpay\n")])])]),t("h5",{attrs:{id:"tor-と-lnd-の確認"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tor-と-lnd-の確認"}},[s._v("#")]),s._v(" Tor と LND の確認")]),s._v(" "),t("p",[s._v("Bitcoin daemon と同様に、Tor がインストール済みで設定ファイルで有効化されていれば（上記設定では有効）、"),t("code",[s._v("lnd")]),s._v(" は自動的に onion アドレスを登録します。lnd では torv3 アドレスに対応しています。")]),s._v(" "),t("p",[s._v("以下の torv3 onion アドレスは、Bitcoin daemon セクションの torv2 よりかなり長くなります（16 文字に対して 56 文字）。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ lncli getinfo "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" onion\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"029b0e3c05595074afcffdca0fb22fb68a95a9c4698dd20962f647de4891eceabd@liyuvwbbycrvvuzcrsd5rq7svwckabejlsymcxiwzkj3smvlwcsqpjyd.onion:9735"')]),s._v("\n")])])]),t("p",[s._v("lnd が作成した Tor アドレスは、Tor ネットワーク上の他の Lightning ピアへの接続に使用できます。この Tor アドレスは IPv4 または IPv6 アドレスと並行して利用できます。IPv4/IPv6 を登録する場合は、lnd 設定ファイルで "),t("code",[s._v("externalip")]),s._v(" が設定されていることを確認してください。")]),s._v(" "),t("h5",{attrs:{id:"更新-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#更新-3"}},[s._v("#")]),s._v(" 更新")]),s._v(" "),t("p",[s._v("更新によって不具合が起こる可能性があります。本番稼働中のシステムでは注意してください。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl stop lnd\n~$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v(":/usr/local/go/bin\n~$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOPATH")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=~")]),s._v("/gocode\n~$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$GOPATH")]),s._v("/bin\n~$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~/src/lnd\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" pull\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# installs to a directory in $GOPATH/bin")]),s._v("\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$GOPATH")]),s._v("/bin/lnd "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$GOPATH")]),s._v("/bin/lncli /usr/bin\n~$ lnd "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--version")]),s._v("\nlnd version "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.10")]),s._v(".99-beta "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("commit")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("clock/v1.0.0-229-ge64e71d86dc1ac716c30a80f85a22e8fb544697f\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl start lnd\n")])])]),t("p",[s._v("daemon を再起動した後は、ウォレットをアンロックする必要があります。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ lncli unlock\n")])])]),t("p",[t("code",[s._v("Ride The Lightning (RTL)")]),s._v(" をインストールしている場合（次セクション参照）、lnd 停止時に RTL も停止している可能性があるため、あわせて再起動が必要です。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl start rtl\n")])])]),t("h2",{attrs:{id:"ride-the-lightning-rtl"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ride-the-lightning-rtl"}},[s._v("#")]),s._v(" Ride The Lightning (RTL)")]),s._v(" "),t("p",[t("strong",[s._v("Ride the Lightning")]),s._v(" は、Lightning のピア、チャネル、ウォレットなどを管理する Node.js アプリケーションです。")]),s._v(" "),t("p",[s._v("BTCPay Server 側の統合作業により、RTL の Web ページは BTCPay サイトと同じ方法で制御・アクセスできます。")]),s._v(" "),t("h5",{attrs:{id:"インストール-8"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#インストール-8"}},[s._v("#")]),s._v(" インストール")]),s._v(" "),t("h5",{attrs:{id:"1-依存関係をインストール"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#1-依存関係をインストール"}},[s._v("#")]),s._v(" 1. 依存関係をインストール")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nodejs build-essential "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v("\n")])])]),t("h5",{attrs:{id:"2-rtl-をビルド"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#2-rtl-をビルド"}},[s._v("#")]),s._v(" 2. RTL をビルド")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~/src\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/Ride-The-Lightning/RTL.git\n~$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" RTL\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--only")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("prod\n")])])]),t("h5",{attrs:{id:"3-設定ファイルを作成-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#3-設定ファイルを作成-3"}},[s._v("#")]),s._v(" 3. 設定ファイルを作成")]),s._v(" "),t("p",[t("code",[s._v("sample-RTL-Config.json")]),s._v(" からサンプル設定ファイルをコピーし、環境に合わせて調整します。このドキュメント内の他の手順と整合する例を以下に示します。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" src/RTL/sample-RTL-Config.json RTL-Config.json\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" RTL-Config.json\n")])])]),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"port"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3000"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"defaultNodeIndex"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"SSO"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"rtlSSO"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"rtlCookiePath"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/lib/rtl/.cookie"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  # Needs to match the value in BTCPay systemd settings.\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"logoutRedirectLink"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://mainnet.demo.btcpayserver.org/login"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"nodes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"index"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"lnNode"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Node 1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"lnImplementation"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"LND"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Authentication"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"macaroonPath"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/lib/lnd/data/chain/bitcoin/mainnet"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"configPath"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/lnd/lnd.conf"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Settings"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"userPersona"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MERCHANT"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"themeMode"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DAY"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"themeColor"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"PURPLE"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"channelBackupPath"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/home/admin/rtl/backup/node-1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"enableLogging"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"lnServerUrl"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://localhost:8080/v1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"swapServerUrl"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://localhost:8081/v1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"fiatConversion"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("RTL は、この手順で説明している他サービスとは挙動と要件が異なります。主な点は次のとおりです。")]),s._v(" "),t("ol",[t("li",[s._v("設定ファイルは RTL のデータディレクトリに配置する必要があります。")]),s._v(" "),t("li",[s._v("RTL プロセスが設定ファイルを書き換えることがあります。")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /var/lib/rtl\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" ~/RTL-Config.json /var/lib/rtl\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" admin:admin "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-R")]),s._v(" /var/lib/rtl\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("644")]),s._v(" /var/lib/rtl/RTL-Config.json\n")])])]),t("h5",{attrs:{id:"4-systemd-サービスを作成-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#4-systemd-サービスを作成-2"}},[s._v("#")]),s._v(" 4. systemd サービスを作成")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" rtl.service\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('[Unit]\nDescription=Ride The Lightning\nRequires=lnd.service\nAfter=lnd.service\n\n[Service]\nEnvironment="RTL_CONFIG_PATH=/var/lib/rtl"\nWorkingDirectory=/var/lib/rtl\nExecStart=/usr/bin/node /home/admin/src/RTL/rtl\nUser=admin\nGroup=admin\nType=simple\nPIDFile=/run/rtl/rtl.pid\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\n')])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" rtl.service /etc/systemd/system\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--now")]),s._v(" rtl\n")])])]),t("h5",{attrs:{id:"確認-8"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#確認-8"}},[s._v("#")]),s._v(" 確認")]),s._v(" "),t("p",[s._v("サービスを確認します。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" journalctl "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-xe")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--unit")]),s._v(" rtl "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--follow")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nJul "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":27:52 ubuntu node"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("988638")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Server is up and running, please "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" the UI at http://localhost:3000\n")])])]),t("p",[s._v("正しく起動しない場合はサービスを停止し、アプリケーションを直接実行してエラーメッセージを確認します。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl stop rtl\n~$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("RTL_CONFIG_PATH")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/rtl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pushd")]),s._v(" ~/src/RTL"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" rtl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("popd")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nServer is up and running, please "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" the UI at http://localhost:3000\n")])])]),t("p",[t("code",[s._v("BTCPay Server")]),s._v(" の Web ページでは、"),t("code",[s._v("Server Settings->Services")]),s._v(" の「Crypto services exposed by your server」配下から "),t("code",[s._v("RTL")]),s._v(" インターフェースにアクセスできるはずです。")]),s._v(" "),t("h5",{attrs:{id:"更新-4"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#更新-4"}},[s._v("#")]),s._v(" 更新")]),s._v(" "),t("p",[s._v("更新によって不具合が起こる可能性があります。本番稼働中のシステムでは注意してください。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl stop rtl\n~$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pushd")]),s._v(" ~/src/RTL"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" pull"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("popd")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n~$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl start rtl\n")])])]),t("h2",{attrs:{id:"おわりに"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#おわりに"}},[s._v("#")]),s._v(" おわりに")]),s._v(" "),t("h3",{attrs:{id:"質問"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#質問"}},[s._v("#")]),s._v(" 質問")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://mattermost.com/download/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Mattermost アプリ"),t("OutboundLink")],1),s._v("をダウンロードして Mattermost の"),t("a",{attrs:{href:"https://chat.btcpayserver.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("コミュニティチャット"),t("OutboundLink")],1),s._v("に参加するか、"),t("a",{attrs:{href:"https://t.me/btcpayserver",target:"_blank",rel:"noopener noreferrer"}},[s._v("Telegram"),t("OutboundLink")],1),s._v(" に参加してください。追加のサポートが必要な場合や、同じ関心を持つ人たちと交流したい場合に役立ちます。")])])}),[],!1,null,null,null);t.default=e.exports}}]);